<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>6 单随机因子线性混合效应模型 | 学习统计模型——通过R模拟(施工中)</title>
  <meta name="description" content="6 单随机因子线性混合效应模型 | 学习统计模型——通过R模拟(施工中)" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="6 单随机因子线性混合效应模型 | 学习统计模型——通过R模拟(施工中)" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="6 单随机因子线性混合效应模型 | 学习统计模型——通过R模拟(施工中)" />
  
  
  

<meta name="author" content="周博霖" />


<meta name="date" content="2024-06-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="介绍线性混合效应模型.html"/>
<link rel="next" href="交叉随机因子线性混合效应模型.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX","output/SVG"],
  extensions: ["tex2jax.js","MathMenu.js","MathZoom.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
  }
});
</script>
<script type="text/javascript"
   src="../../../MathJax/MathJax.js">
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>概述</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#译者按"><i class="fa fa-check"></i>译者按</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#如何引用本书"><i class="fa fa-check"></i>如何引用本书</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#发现问题"><i class="fa fa-check"></i>发现问题？</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#教育者需知"><i class="fa fa-check"></i>教育者需知</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="前言.html"><a href="前言.html"><i class="fa fa-check"></i><b>1</b> 前言</a>
<ul>
<li class="chapter" data-level="1.1" data-path="前言.html"><a href="前言.html#课程目的"><i class="fa fa-check"></i><b>1.1</b> 课程目的</a></li>
<li class="chapter" data-level="1.2" data-path="前言.html"><a href="前言.html#广义线性混合效应模型generalized-linear-mixed-effects-models-glmms"><i class="fa fa-check"></i><b>1.2</b> 广义线性混合效应模型(Generalized Linear Mixed-Effects Models, GLMMs)</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="前言.html"><a href="前言.html#线性模型"><i class="fa fa-check"></i><b>1.2.1</b> 线性模型</a></li>
<li class="chapter" data-level="1.2.2" data-path="前言.html"><a href="前言.html#混合模型"><i class="fa fa-check"></i><b>1.2.2</b> 混合模型</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="前言.html"><a href="前言.html#关于可重复性的说明"><i class="fa fa-check"></i><b>1.3</b> 关于可重复性的说明</a></li>
<li class="chapter" data-level="1.4" data-path="前言.html"><a href="前言.html#基于模拟的方法"><i class="fa fa-check"></i><b>1.4</b> 基于模拟的方法</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="相关和回归.html"><a href="相关和回归.html"><i class="fa fa-check"></i><b>2</b> 相关和回归</a>
<ul>
<li class="chapter" data-level="2.1" data-path="相关和回归.html"><a href="相关和回归.html#相关矩阵correlation-matrices"><i class="fa fa-check"></i><b>2.1</b> 相关矩阵(Correlation matrices)</a></li>
<li class="chapter" data-level="2.2" data-path="相关和回归.html"><a href="相关和回归.html#模拟二元数据"><i class="fa fa-check"></i><b>2.2</b> 模拟二元数据</a></li>
<li class="chapter" data-level="2.3" data-path="相关和回归.html"><a href="相关和回归.html#相关和回归的关系"><i class="fa fa-check"></i><b>2.3</b> 相关和回归的关系</a></li>
<li class="chapter" data-level="2.4" data-path="相关和回归.html"><a href="相关和回归.html#练习"><i class="fa fa-check"></i><b>2.4</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="多元回归.html"><a href="多元回归.html"><i class="fa fa-check"></i><b>3</b> 多元回归</a>
<ul>
<li class="chapter" data-level="3.1" data-path="多元回归.html"><a href="多元回归.html#一个例子如何在统计学上取得好成绩"><i class="fa fa-check"></i><b>3.1</b> 一个例子：如何在统计学上取得好成绩</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="多元回归.html"><a href="多元回归.html#数据导入和可视化"><i class="fa fa-check"></i><b>3.1.1</b> 数据导入和可视化</a></li>
<li class="chapter" data-level="3.1.2" data-path="多元回归.html"><a href="多元回归.html#估计和解释"><i class="fa fa-check"></i><b>3.1.2</b> 估计和解释</a></li>
<li class="chapter" data-level="3.1.3" data-path="多元回归.html"><a href="多元回归.html#使用predict通过线性模型进行预测"><i class="fa fa-check"></i><b>3.1.3</b> 使用<code>predict()</code>通过线性模型进行预测</a></li>
<li class="chapter" data-level="3.1.4" data-path="多元回归.html"><a href="多元回归.html#偏效应可视化"><i class="fa fa-check"></i><b>3.1.4</b> 偏效应可视化</a></li>
<li class="chapter" data-level="3.1.5" data-path="多元回归.html"><a href="多元回归.html#标准化系数"><i class="fa fa-check"></i><b>3.1.5</b> 标准化系数</a></li>
<li class="chapter" data-level="3.1.6" data-path="多元回归.html"><a href="多元回归.html#模型比较"><i class="fa fa-check"></i><b>3.1.6</b> 模型比较</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="多元回归.html"><a href="多元回归.html#处理分类预测变量"><i class="fa fa-check"></i><b>3.2</b> 处理分类预测变量</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="多元回归.html"><a href="多元回归.html#虚拟编码又称处理编码"><i class="fa fa-check"></i><b>3.2.1</b> 虚拟编码(又称“处理”编码)</a></li>
<li class="chapter" data-level="3.2.2" data-path="多元回归.html"><a href="多元回归.html#当k-2时的虚拟编码"><i class="fa fa-check"></i><b>3.2.2</b> 当<span class="math inline">\(k &gt; 2\)</span>时的虚拟编码</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="多元回归.html"><a href="多元回归.html#多元回归和单因素方差分析one-way-anova的等价性"><i class="fa fa-check"></i><b>3.3</b> 多元回归和单因素方差分析(one-way ANOVA)的等价性</a></li>
<li class="chapter" data-level="3.4" data-path="多元回归.html"><a href="多元回归.html#练习答案"><i class="fa fa-check"></i><b>3.4</b> 练习答案</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="交互效应.html"><a href="交互效应.html"><i class="fa fa-check"></i><b>4</b> 交互效应</a>
<ul>
<li class="chapter" data-level="4.1" data-path="交互效应.html"><a href="交互效应.html#cont-by-cat"><i class="fa fa-check"></i><b>4.1</b> 连续变量-分类变量交互效应</a></li>
<li class="chapter" data-level="4.2" data-path="交互效应.html"><a href="交互效应.html#分类变量-分类变量交互效应"><i class="fa fa-check"></i><b>4.2</b> 分类变量-分类变量交互效应</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="交互效应.html"><a href="交互效应.html#认知治疗与药物治疗对情绪的影响"><i class="fa fa-check"></i><b>4.2.1</b> 认知治疗与药物治疗对情绪的影响</a></li>
<li class="chapter" data-level="4.2.2" data-path="交互效应.html"><a href="交互效应.html#因子设计中的效应"><i class="fa fa-check"></i><b>4.2.2</b> 因子设计中的效应</a></li>
<li class="chapter" data-level="4.2.3" data-path="交互效应.html"><a href="交互效应.html#高阶设计higher-order-designs"><i class="fa fa-check"></i><b>4.2.3</b> 高阶设计(Higher-order designs)</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="交互效应.html"><a href="交互效应.html#用于因子设计的glm"><i class="fa fa-check"></i><b>4.3</b> 用于因子设计的GLM</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="交互效应.html"><a href="交互效应.html#估计方程estimation-equations"><i class="fa fa-check"></i><b>4.3.1</b> 估计方程(estimation equations)</a></li>
<li class="chapter" data-level="4.3.2" data-path="交互效应.html"><a href="交互效应.html#因子设计app"><i class="fa fa-check"></i><b>4.3.2</b> 因子设计App</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="交互效应.html"><a href="交互效应.html#在因子设计中对分类预测因子进行编码"><i class="fa fa-check"></i><b>4.4</b> 在因子设计中对分类预测因子进行编码</a></li>
<li class="chapter" data-level="4.5" data-path="交互效应.html"><a href="交互效应.html#分类变量的编码方案"><i class="fa fa-check"></i><b>4.5</b> 分类变量的编码方案</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="交互效应.html"><a href="交互效应.html#简单效应-vs.-主效应"><i class="fa fa-check"></i><b>4.5.1</b> 简单效应 vs. 主效应</a></li>
<li class="chapter" data-level="4.5.2" data-path="交互效应.html"><a href="交互效应.html#主要编码方案"><i class="fa fa-check"></i><b>4.5.2</b> 主要编码方案</a></li>
<li class="chapter" data-level="4.5.3" data-path="交互效应.html"><a href="交互效应.html#超过2水平的因子呢"><i class="fa fa-check"></i><b>4.5.3</b> 超过2水平的因子呢？</a></li>
<li class="chapter" data-level="4.5.4" data-path="交互效应.html"><a href="交互效应.html#举例3水平因子"><i class="fa fa-check"></i><b>4.5.4</b> 举例：3水平因子</a></li>
<li class="chapter" data-level="4.5.5" data-path="交互效应.html"><a href="交互效应.html#如何创建你自己的数值型预测变量"><i class="fa fa-check"></i><b>4.5.5</b> 如何创建你自己的数值型预测变量</a></li>
<li class="chapter" data-level="4.5.6" data-path="交互效应.html"><a href="交互效应.html#小结"><i class="fa fa-check"></i><b>4.5.6</b> 小结</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html"><i class="fa fa-check"></i><b>5</b> 介绍线性混合效应模型</a>
<ul>
<li class="chapter" data-level="5.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#多层数据建模"><i class="fa fa-check"></i><b>5.1</b> 多层数据建模</a></li>
<li class="chapter" data-level="5.2" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#如何对这些数据进行建模"><i class="fa fa-check"></i><b>5.2</b> 如何对这些数据进行建模</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#完全混合一刀切"><i class="fa fa-check"></i><b>5.2.1</b> 完全混合：一刀切</a></li>
<li class="chapter" data-level="5.2.2" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#不混合"><i class="fa fa-check"></i><b>5.2.2</b> 不混合</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#使用混合效果模型的部分混合"><i class="fa fa-check"></i><b>5.3</b> 使用混合效果模型的部分混合</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#方差-协方差矩阵"><i class="fa fa-check"></i><b>5.3.1</b> 方差-协方差矩阵</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#估计模型参数"><i class="fa fa-check"></i><b>5.4</b> 估计模型参数</a></li>
<li class="chapter" data-level="5.5" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#解释lmer输出结果并提取估计值"><i class="fa fa-check"></i><b>5.5</b> 解释<code>lmer()</code>输出结果并提取估计值</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#固定效应"><i class="fa fa-check"></i><b>5.5.1</b> 固定效应</a></li>
<li class="chapter" data-level="5.5.2" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#随机效应"><i class="fa fa-check"></i><b>5.5.2</b> 随机效应</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#多层app"><i class="fa fa-check"></i><b>5.6</b> 多层app</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html"><i class="fa fa-check"></i><b>6</b> 单随机因子线性混合效应模型</a>
<ul>
<li class="chapter" data-level="6.1" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#什么时候为什么你想用线性混合效应建模取代传统的分析"><i class="fa fa-check"></i><b>6.1</b> 什么时候，为什么，你想用线性混合效应建模取代传统的分析?</a></li>
<li class="chapter" data-level="6.2" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#示例多层数据上的独立样本t检验"><i class="fa fa-check"></i><b>6.2</b> 示例：多层数据上的独立样本<span class="math inline">\(t\)</span>检验</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#什么时候使用随机截距模型是合适的"><i class="fa fa-check"></i><b>6.2.1</b> 什么时候使用随机截距模型是合适的?</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#用回归表达研究设计和进行检验"><i class="fa fa-check"></i><b>6.3</b> 用回归表达研究设计和进行检验</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#水平以上的因子"><i class="fa fa-check"></i><b>6.3.1</b> 2水平以上的因子</a></li>
<li class="chapter" data-level="6.3.2" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#多参数检验"><i class="fa fa-check"></i><b>6.3.2</b> 多参数检验</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html"><i class="fa fa-check"></i><b>7</b> 交叉随机因子线性混合效应模型</a>
<ul>
<li class="chapter" data-level="7.1" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#概括被试和刺激的组合"><i class="fa fa-check"></i><b>7.1</b> 概括被试和刺激的组合</a></li>
<li class="chapter" data-level="7.2" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#lme4语法用于交叉随机因子"><i class="fa fa-check"></i><b>7.2</b> lme4语法用于交叉随机因子</a></li>
<li class="chapter" data-level="7.3" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#指定随机效应"><i class="fa fa-check"></i><b>7.3</b> 指定随机效应</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#为分类因子选择随机效应的规则"><i class="fa fa-check"></i><b>7.3.1</b> 为分类因子选择随机效应的规则</a></li>
<li class="chapter" data-level="7.3.2" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#排除不收敛和畸形拟合singular-fit"><i class="fa fa-check"></i><b>7.3.2</b> 排除不收敛和“畸形拟合(singular fit)”</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#模拟交叉随机因子的数据"><i class="fa fa-check"></i><b>7.4</b> 模拟交叉随机因子的数据</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#设置环境并定义dgp的参数"><i class="fa fa-check"></i><b>7.4.1</b> 设置环境并定义DGP的参数</a></li>
<li class="chapter" data-level="7.4.2" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#生成刺激样本"><i class="fa fa-check"></i><b>7.4.2</b> 生成刺激样本</a></li>
<li class="chapter" data-level="7.4.3" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#生成被试样本"><i class="fa fa-check"></i><b>7.4.3</b> 生成被试样本</a></li>
<li class="chapter" data-level="7.4.4" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#生产试次样本"><i class="fa fa-check"></i><b>7.4.4</b> 生产试次样本</a></li>
<li class="chapter" data-level="7.4.5" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#合并subjectsitems和trials"><i class="fa fa-check"></i><b>7.4.5</b> 合并<code>subjects</code>，<code>items</code>和<code>trials</code></a></li>
<li class="chapter" data-level="7.4.6" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#创建响应变量"><i class="fa fa-check"></i><b>7.4.6</b> 创建响应变量</a></li>
<li class="chapter" data-level="7.4.7" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#拟合模型"><i class="fa fa-check"></i><b>7.4.7</b> 拟合模型</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="参考文献.html"><a href="参考文献.html"><i class="fa fa-check"></i>参考文献</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">学习统计模型——通过R模拟(施工中)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="单随机因子线性混合效应模型" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">6</span> 单随机因子线性混合效应模型<a href="单随机因子线性混合效应模型.html#单随机因子线性混合效应模型" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="什么时候为什么你想用线性混合效应建模取代传统的分析" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> 什么时候，为什么，你想用线性混合效应建模取代传统的分析?<a href="单随机因子线性混合效应模型.html#什么时候为什么你想用线性混合效应建模取代传统的分析" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>我们已经反复强调了，心理学中的许多常用技术可以被视为一般线性模型的特例。这意味着可以用回归来替代这些技术。事实上，你可以使用以下四个函数之一来分析几乎任何在心理学中可以想象得到的数据集。</p>
<table>
<thead>
<tr class="header">
<th align="left">取样设计</th>
<th align="left">数据类型</th>
<th align="left">函数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">单层</td>
<td align="left">连续、正态分布</td>
<td align="left"><code>base::lm()</code></td>
<td align="left">简单线性模型</td>
</tr>
<tr class="even">
<td align="left">单层</td>
<td align="left">计数或分类</td>
<td align="left"><code>base::glm()</code></td>
<td align="left">广义线性模型</td>
</tr>
<tr class="odd">
<td align="left">多层</td>
<td align="left">连续、正态分布</td>
<td align="left"><code>lme4::lmer()</code></td>
<td align="left">线性混合效应模型</td>
</tr>
<tr class="even">
<td align="left">多层</td>
<td align="left">计数或分类</td>
<td align="left"><code>lme4::glmer()</code></td>
<td align="left">广义线性混合效应模型</td>
</tr>
</tbody>
</table>
<p>在本章结束时，你应该:</p>
<ul>
<li>理解如何使用回归来替代标准的ANOVA和t检验分析，适用于具有单一随机因子和连续因变量的数据；</li>
<li>能够进行模型比较(<code>anova()</code>)以测试效果；</li>
<li>能够使用R回归公式语法来表达各种研究设计。</li>
</ul>
<p>要决定使用四个回归函数中的哪一个，你需要回答两个问题。</p>
<ol style="list-style-type: decimal">
<li>因变量代表哪种类型的数据，它是如何分布的？</li>
<li>数据是多层(multilevel)的还是单层(single level)的？</li>
</ol>
<p>这些函数的参数在所有四个版本中都非常相似。我们将在本课程后面部分学习如何分析计数和分类数据。现在，我们将重点放在连续数据上，但原理可以推广到其他类型的数据上。</p>
<p>以下是单层数据(没有重复测量的数据)的对比表：</p>
<table>
<thead>
<tr class="header">
<th align="left">检验类型</th>
<th align="left">传统方法</th>
<th align="left">回归方法</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">单样本t检验</td>
<td align="left"><code>t.test(y, mu = c)</code></td>
<td align="left"><code>lm(y ~ 1, offset = c)</code></td>
</tr>
<tr class="even">
<td align="left">独立样本t检验</td>
<td align="left"><code>t.test(x, y)</code></td>
<td align="left"><code>lm(y ~ x)</code></td>
</tr>
<tr class="odd">
<td align="left">单因素方差分析</td>
<td align="left"><code>aov(y ~ x)</code></td>
<td align="left"><code>lm(y ~ x)</code></td>
</tr>
<tr class="even">
<td align="left">多因素方差分析</td>
<td align="left"><code>aov(y ~ a * b)</code></td>
<td align="left"><code>lm(y ~ a * b)</code></td>
</tr>
</tbody>
</table>
<p>以上所有设计都是<em>被试间</em>设计，没有重复测量(请注意，在多因子情况下，我们可能会将<code>a</code>和<code>b</code>替换为偏差编码的数值型预测变量，原因已在<a href="交互效应.html">交互章节</a>中讨论过)。</p>
<p>混合效应模型在处理多层数据时可以发挥作用。数据通常是多层的，原因有如下三种(多个原因可能同时适用)：</p>
<ol style="list-style-type: decimal">
<li>你有一个被试内因子，和/或</li>
<li>你有<strong>假重复(pseudoreplications)</strong>，和/或</li>
<li>你有多个刺激项目(我们将在<a href="交叉随机因子线性混合效应模型.html">下一章</a>中讨论)。</li>
</ol>
<p>此时，回顾一下被试间因子与被试内因子的意义是个好主意。在<code>sleepstudy</code>数据中，你有被试内因子<code>Day</code>(实际上它更像是一个数值型变量，而不是一个因子；但它在每个被试内有多个变动值)。</p>
<p><strong>假重复</strong>发生在同一条件下进行多次测量的情况下。例如，设想一个研究，你随机分配被试饮用两种饮料中的一种——酒精或水——然后进行一个简单的反应时任务，当灯光闪烁时尽快按下按钮。你可能会对每个被试进行多次反应时测量；假设你在100次试验中测量它。你有一个被试间因子(饮料类型)和每个被试的100次观测，对于每组的20个被试来说。一些新手在分析这些数据时常犯的错误是尝试进行t检验。<strong>当你有假重复(或多个刺激)时，你不能直接使用传统的t检验</strong>。你必须首先为每个被试计算均值，然后对<strong>均值而不是原始数据</strong>进行分析。虽然ANOVA的一些版本可以处理假重复，但使用线性混合效应模型可能更好，它可以更好地处理复杂的依赖结构(dependency structure)。</p>
<p>以下是多层数据的对比表：</p>
<table>
<colgroup>
<col width="26%" />
<col width="30%" />
<col width="42%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">检验类型</th>
<th align="left">传统方法</th>
<th align="left">回归方法</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">有假重复的单样本t检验</td>
<td align="left">计算平均值并使用<code>t.test(x_mean)</code></td>
<td align="left"><code>lmer(y ~ (1 | subject), offset = c)</code></td>
</tr>
<tr class="even">
<td align="left">无假重复的配对样本t检验</td>
<td align="left"><code>t.test(x, y, paired = TRUE)</code></td>
<td align="left"><code>lmer(y ~ x + (1 | subject))</code></td>
</tr>
<tr class="odd">
<td align="left">有假重复的配对样本t检验</td>
<td align="left">计算平均值并使用<code>t.test(x_mean, y_mean)</code></td>
<td align="left"><code>lmer(y ~ x + (1 + x | subject))</code></td>
</tr>
<tr class="even">
<td align="left">无假重复的重复测量方差分析</td>
<td align="left"><code>aov(y ~ x + Error(subject))</code></td>
<td align="left"><code>lmer(y ~ x + (1 | subject))</code></td>
</tr>
<tr class="odd">
<td align="left">有假重复的重复测量方差分析</td>
<td align="left"><code>aov(y ~ x + Error(subject/x))</code></td>
<td align="left"><code>lmer(y ~ x + (1 + x | subject))</code></td>
</tr>
<tr class="even">
<td align="left">无假重复的多因子方差分析，包含a和b</td>
<td align="left"><code>aov(y ~ a * b + Error(subject))</code></td>
<td align="left"><code>lmer(y ~ a * b + (1 | subject))</code></td>
</tr>
<tr class="odd">
<td align="left">有假重复的多因子方差分析</td>
<td align="left"><code>aov(y ~ a * b + Error(subject/(a * b))</code></td>
<td align="left"><code>lmer(y ~ a * b + (1 + a * b | subject)</code></td>
</tr>
</tbody>
</table>
<p>广义线性模型/回归框架相比t检验和ANOVA的主要卖点之一就是灵活性。在上一章中，我们使用了<code>sleepstudy</code>数据，发现只有在线性混合效应模型框架才能妥善处理这些数据。尽管回归有许多优点，但如果你的数据是平衡的，且在不违反任何检验假设的情况下可以合理使用t检验或ANOVA，那么这样做是可取的；这些方法在心理学中有悠久的历史，并且更为广泛地被理解。</p>
</div>
<div id="示例多层数据上的独立样本t检验" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> 示例：多层数据上的独立样本<span class="math inline">\(t\)</span>检验<a href="单随机因子线性混合效应模型.html#示例多层数据上的独立样本t检验" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>让我们考虑一种情况，你在测试酒精摄入对简单反应时的影响(例如，灯亮后尽快按下按钮)。为了简化，假设你收集了14个被试的数据，这些被试被随机分配在两种干预后进行10次简单反应时试验：饮用一品脱酒精(处理条件)或饮用安慰剂饮料(安慰剂条件)。你在每组中有7名被试。请注意，实际研究中需要更多的被试。</p>
<p>这个<a href="https://rstudio-connect.psy.gla.ac.uk/icc" target="_blank">网页app</a>展示了这种研究的模拟数据。被试P01到P07属于安慰剂条件，而被试T01到T07属于处理条件。请停下并查看！</p>
<p>如果我们要对这些数据进行t检验，首先需要计算被试的均值，否则观测值不是独立的。你可以按如下方法进行操作。(如果你想运行下面的代码，可以从上面的网页app下载示例数据，并将其保存为<code>independent_samples.csv</code>)。</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="单随机因子线性混合效应模型.html#cb178-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb178-2"><a href="单随机因子线性混合效应模型.html#cb178-2" tabindex="-1"></a></span>
<span id="cb178-3"><a href="单随机因子线性混合效应模型.html#cb178-3" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/independent_samples.csv&quot;</span>, <span class="at">col_types =</span> <span class="st">&quot;cci&quot;</span>)</span>
<span id="cb178-4"><a href="单随机因子线性混合效应模型.html#cb178-4" tabindex="-1"></a></span>
<span id="cb178-5"><a href="单随机因子线性混合效应模型.html#cb178-5" tabindex="-1"></a>subj_means <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb178-6"><a href="单随机因子线性混合效应模型.html#cb178-6" tabindex="-1"></a>  <span class="fu">group_by</span>(subject, cond) <span class="sc">%&gt;%</span></span>
<span id="cb178-7"><a href="单随机因子线性混合效应模型.html#cb178-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_rt =</span> <span class="fu">mean</span>(RT)) <span class="sc">%&gt;%</span></span>
<span id="cb178-8"><a href="单随机因子线性混合效应模型.html#cb178-8" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb178-9"><a href="单随机因子线性混合效应模型.html#cb178-9" tabindex="-1"></a></span>
<span id="cb178-10"><a href="单随机因子线性混合效应模型.html#cb178-10" tabindex="-1"></a>subj_means</span></code></pre></div>
<pre><code>## # A tibble: 14 × 3
##    subject cond  mean_rt
##    &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;
##  1 P01     P        354 
##  2 P02     P        384.
##  3 P03     P        391.
##  4 P04     P        404.
##  5 P05     P        421.
##  6 P06     P        392 
##  7 P07     P        400.
##  8 T08     T        430.
##  9 T09     T        432.
## 10 T10     T        410.
## 11 T11     T        455.
## 12 T12     T        450.
## 13 T13     T        418.
## 14 T14     T        489.</code></pre>
<p>然后可以使用<code>t.test()</code>进行<span class="math inline">\(t\)</span>检验。</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="单随机因子线性混合效应模型.html#cb180-1" tabindex="-1"></a><span class="fu">t.test</span>(mean_rt <span class="sc">~</span> cond, subj_means)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  mean_rt by cond
## t = -3.7985, df = 11.32, p-value = 0.002807
## alternative hypothesis: true difference in means between group P and group T is not equal to 0
## 95 percent confidence interval:
##  -76.32580 -20.44563
## sample estimates:
## mean in group P mean in group T 
##        392.3143        440.7000</code></pre>
<p>虽然这样分析没有问题，但对数据进行聚合会丢失信息。我们可以在上面的网页app中看到，实际上存在两种不同的变异来源：简单反应时的逐试次变异(trial-by-trial variability，用<span class="math inline">\(\sigma\)</span>表示)和被试相对于总体均值(<span class="math inline">\(\gamma_{00}\)</span>)的快慢的变异。被试<span class="math inline">\(s\)</span>在试次<span class="math inline">\(t\)</span>上的反应时(<span class="math inline">\(Y_{st}\)</span>)的数据生成过程如下所示。</p>
<p><em>第1层:</em></p>
<p><span class="math display">\[\begin{equation}
Y_{st} = \beta_{0s} + \beta_{1} X_{s} + e_{st}
\end{equation}\]</span></p>
<p><em>第2层:</em></p>
<p><span class="math display">\[\begin{equation}
\beta_{0s} = \gamma_{00} + S_{0s}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\beta_{1} = \gamma_{10}
\end{equation}\]</span></p>
<p><em>方差成分:</em></p>
<p><span class="math display">\[\begin{equation}
S_{0s} \sim N\left(0, {\tau_{00}}^2\right)
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
e_{st} \sim N\left(0, \sigma^2\right)
\end{equation}\]</span></p>
<p>在上面的方程中，<span class="math inline">\(X_s\)</span>是一个数值型预测变量，用于编码被试<span class="math inline">\(s\)</span>的条件；例如：0表示安慰剂，1表示处理。</p>
<p>相比于一个简单模型，多层方程显得有些繁琐，但是当我们遇到更复杂的设计时，熟悉一下多层格式是值得的；我们可以将第1层和第2层简化为</p>
<p><span class="math display">\[\begin{equation}
Y_{st} = \gamma_{00} + S_{0s} + \gamma_{10} X_s + e_{st},
\end{equation}\]</span></p>
<p>与上章节中的<code>sleepstudy</code>数据不同，现在的数据每个被试只有一个随机效应<span class="math inline">\(S_{0s}\)</span>，没有随机斜率。每个被试只出现在两个处理条件中的一个中，因此不可能估计安慰剂与酒精的效应在被试之间的变化情况。对于这些数据，我们拟合的混合效应模型，具有随机截距但没有随机斜率，被称为<strong>随机截距模型(random intercepts model)</strong>。</p>
<p>随机截距模型可以充分捕捉上述两种变异来源：参数<span class="math inline">\({\tau_{00}}^2\)</span>中的总体平均反应时的被试间变异，以及参数<span class="math inline">\(\sigma^2\)</span>中的逐试次变异。我们可以使用下面的公式计算个体差异在总变异中所占的比例。</p>
<p><span class="math display">\[ICC = \frac{{\tau_{00}}^2}{{\tau_{00}}^2 + \sigma^2}\]</span></p>
<p>这一数值被称为<strong>组内相关系数(intra-class correlation coefficient)</strong>，告诉你数据中的聚类程度。它的范围从0到1，0表示所有变异都归因于残差变异，1表示所有变异都归因于被试间差异。</p>
<p>拟合随机截距模型的lmer语法是<code>lmer(RT ~ cond + (1 | subject), dat, REML=FALSE)</code>。首先让我们创建自己的数值型预测变量，以明确我们在使用虚拟编码。</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="单随机因子线性混合效应模型.html#cb182-1" tabindex="-1"></a>dat2 <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb182-2"><a href="单随机因子线性混合效应模型.html#cb182-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cond_d =</span> <span class="fu">if_else</span>(cond <span class="sc">==</span> <span class="st">&quot;T&quot;</span>, 1L, 0L))</span>
<span id="cb182-3"><a href="单随机因子线性混合效应模型.html#cb182-3" tabindex="-1"></a></span>
<span id="cb182-4"><a href="单随机因子线性混合效应模型.html#cb182-4" tabindex="-1"></a><span class="fu">distinct</span>(dat2, cond, cond_d)  <span class="do">## 再次确认</span></span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   cond  cond_d
##   &lt;chr&gt;  &lt;int&gt;
## 1 P          0
## 2 T          1</code></pre>
<p>现在估计模型。</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="单随机因子线性混合效应模型.html#cb184-1" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb184-2"><a href="单随机因子线性混合效应模型.html#cb184-2" tabindex="-1"></a></span>
<span id="cb184-3"><a href="单随机因子线性混合效应模型.html#cb184-3" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(RT <span class="sc">~</span> cond_d <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> subject), dat2, <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb184-4"><a href="单随机因子线性混合效应模型.html#cb184-4" tabindex="-1"></a></span>
<span id="cb184-5"><a href="单随机因子线性混合效应模型.html#cb184-5" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
## Formula: RT ~ cond_d + (1 | subject)
##    Data: dat2
## 
##      AIC      BIC   logLik deviance df.resid 
##   1451.8   1463.5   -721.9   1443.8      136 
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -2.67117 -0.66677  0.01656  0.75361  2.58447 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev.
##  subject  (Intercept)  329.3   18.15   
##  Residual             1574.7   39.68   
## Number of obs: 140, groups:  subject, 14
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)  392.314      8.339  47.045
## cond_d        48.386     11.793   4.103
## 
## Correlation of Fixed Effects:
##        (Intr)
## cond_d -0.707</code></pre>
<p>使用上面app中的滑块并检查lmer输出面板，直到你了解输出结果如何映射到模型参数中。</p>
<div id="什么时候使用随机截距模型是合适的" class="section level3 hasAnchor" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> 什么时候使用随机截距模型是合适的?<a href="单随机因子线性混合效应模型.html#什么时候使用随机截距模型是合适的" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>当然，混合效应模型仅在你有多层数据时才合适。随机截距模型适用于任何单样本或具有假重复的组间数据(如果在这种情况下你没有假重复，那么你就没有多层数据，可以直接使用普通回归，例如<code>lm()</code>)。</p>
<p>“仅随机截距”模型也适用于设计中有被试内因素的情况，但<strong>只有当你没有假重复数据时</strong>才合适；也就是说，它<strong>只</strong>适用于每个被试在被试内因素的每个水平上只有一个观测值的情况。如果每个被试在每个水平/单元上有多个观测值，那么你需要用随机斜率来丰富你的随机效应结构，在下一节会进行讲述。如果你有多个观测值的原因是每个被试对相同的刺激集合做出反应，那么你可能需要考虑一个对被试和刺激进行交叉随机效应的混合效应模型，在<a href="交叉随机因子线性混合效应模型.html">下一章</a>会进行讲述。</p>
<p>同样的逻辑也适用于有多个被试内因素的因子设计。在因子设计中，如果每个被试在由被试内因素相互组合形成的每个<strong>单元</strong>中只有一个观测值，那么随机截距模型是合适的。例如，如果<span class="math inline">\(A\)</span>和<span class="math inline">\(B\)</span>是2个两水平的被试内因素，你需要检查每个被试在<span class="math inline">\(A_1B_1\)</span>、<span class="math inline">\(A_1B_2\)</span>、<span class="math inline">\(A_2B_1\)</span>和<span class="math inline">\(A_2B_2\)</span>中是否只有1个观测值。如果有多个观测值，你将需要考虑在模型中加入随机斜率。</p>
</div>
</div>
<div id="用回归表达研究设计和进行检验" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> 用回归表达研究设计和进行检验<a href="单随机因子线性混合效应模型.html#用回归表达研究设计和进行检验" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>为了在线性混合效应模型中重现所有的t检验/ANOVA风格的分析，你需要更好地理解两件事：(1)如何在回归公式中表达你的研究设计，以及(2)如何为你进行的任何检验获得p值。在线性混合效应方法中，后者并不是理所应当的，因为在许多情况下，<code>lme4::lmer()</code>的输出默认不会给出p值，这反映了存在多种获取p值的方法<span class="citation">(<a href="#ref-Luke_2017">Luke, 2017</a>)</span>。或者，你可能会为单个回归系数获得p值，但你想进行的检验是一个组合测试，需要同时测试多个参数。</p>
<p>首先，让我们仔细看看R和<strong><code>lme4</code></strong>中的回归公式语法。对于基于被试的随机效应的回归模型<span class="math inline">\(y = \beta_0 + \beta_1 x_1 + \beta_2 x_2 + \ldots + \beta_m x_m + e\)</span>，公式如下：</p>
<p><code>y ~ 1 + x1 + x2 + ... + xm + (1 + x1 + ... | subject)</code></p>
<p>残差项是隐含的，所以没有提及；仅列出预测变量。左边部分(波浪号<code>~</code>前面)指定响应变量，右侧是预测变量。括号中的项<code>(... | ...)</code>特定于<strong><code>lme4</code></strong>。竖线<code>|</code>的右侧指定一个变量名称(在本例中为<code>subject</code>)，用于编码随机因子的水平。左侧指定你希望在这些水平上变化的回归系数。公式开头的<code>1</code>指定你需要一个截距，默认情况下已包括在内，因此可以省略。括号内的<code>1</code>指定一个<strong>随机截距</strong>，这也是默认包含的；括号内提到的预测变量指定<strong>随机斜率</strong>。因此，你可以将上述公式等效写成：</p>
<p><code>y ~ x1 + x2 + ... + xm + (x1 + ... | subject)</code>。</p>
<p>R公式中还有另一种重要的简写方式，我们已经在<a href="交互效应.html#交互效应">交互效应</a>章节中看到过，即被称为“星号语法”用于指定交互的<code>a * b</code>。如果你的设计中有两个因子<code>a</code>和<code>b</code>，并且希望模型中包含所有主效应和交互效应，可以使用：</p>
<p><code>y ~ a * b</code></p>
<p>这等同于<code>y ~ a + b + a:b</code>，其中<code>a</code>和<code>b</code>是编码A和B主效应的预测变量，<code>a:b</code>编码AB交互效应。使用星号语法指定交互比手动拼写它们要节省很多拼写(和错误)。这在下面的例子中更容易看出，该例子编码了一个包括因子A、B和C的2x2x2因子设计：</p>
<p><code>y ~ a * b * c</code></p>
<p>这等同于</p>
<p><code>y ~ a + b + c + a:b + a:c + b:c + a:b:c</code></p>
<p>其中<code>a:b</code>、<code>a:c</code>和<code>b:c</code>是双因子交互，<code>a:b:c</code>是三因子交互。你也可以在括号内的随机效应项中使用星号语法，例如：</p>
<p><code>y ~ a * b * c + (a * b * c | subject)</code></p>
<p>等同于</p>
<p><code>y ~ a + b + c + a:b + a:c + b:c + a:b:c + (a + b + c + a:b + a:c + b:c + a:b:c | subject)</code></p>
<p>尽管很复杂，但这种设计在心理学中并不罕见(例如，所有因子都在被试内，且每个条件有多个刺激)！</p>
<div id="水平以上的因子" class="section level3 hasAnchor" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> 2水平以上的因子<a href="单随机因子线性混合效应模型.html#水平以上的因子" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>如上所述，您可以使用公式<code>lm(y ~ x)</code>在回归中进行单因素ANOVA，对于单层数据，或者对于没有假重复的多层数据，使用公式<code>lmer(y ~ x + (1 | subject))</code>。在公式中，预测变量<code>x</code>应为<code>factor()</code>类型，R(默认情况下)会将其转换为<span class="math inline">\(k-1\)</span>个虚拟编码的数值型预测变量(每个水平1个；有关信息，参见<a href="交互效应.html#交互效应">交互效应</a>)。</p>
<p>自己编码数值预测变量通常是明智的，特别是在你的目标是进行ANOVA风格的主效应和交互效应检验的时候。这时如果你有变量是<code>factor</code>类型，可能会很困难。因此，对于一个名为<code>meal</code>(<code>breakfast</code>，<code>lunch</code>，<code>dinner</code>)的3水平因子，你可以创建两个变量，<code>lunch_v_breakfast</code>和<code>dinner_v_breakfast</code>，如下所示。</p>
<table>
<thead>
<tr class="header">
<th align="left">factor level</th>
<th align="right">lunch_v_breakfast</th>
<th align="right">dinner_v_breakfast</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">breakfast</td>
<td align="right">-1/3</td>
<td align="right">-1/3</td>
</tr>
<tr class="even">
<td align="left">lunch</td>
<td align="right">+2/3</td>
<td align="right">-1/3</td>
</tr>
<tr class="odd">
<td align="left">dinner</td>
<td align="right">-1/3</td>
<td align="right">+2/3</td>
</tr>
</tbody>
</table>
<p>如果你的因变量是<code>calories</code>，模型将会是：</p>
<p><code>calories ~ lunch_v_breakfast + dinner_v_breakfast</code>。</p>
<p>但是如果你想要让<code>meal</code>与另一个两水平因素——<code>time_of_week</code>(分别编码为 -0.5 和 +0.5 的<code>weekday</code>和<code>weekend</code>)进行交互，因为你认为每顿饭消耗的卡路里在这个变量的不同水平上会有所不同。那么你的模型将是：</p>
<p><code>calories ~ (lunch_v_breakfast + dinner_v_breakfast) * time_of_week</code>。</p>
<p><a href="交互效应.html#分类变量的编码方案">包含交互效应是我们选择“偏差”编码方案的原因</a>。我们在与2水平变量相关的预测变量周围加上括号，以便每个预测变量都与<code>time_of_week</code>交互。上面的星形语法是以下形式的简写:</p>
<p><code>calories ~ lunch_v_breakfast + dinner_v_breakfast + time_of_week + lunch_v_breakfast:time_of_week + dinner_v_breakfast:time_of_week</code>.</p>
<p>这是估计3x2因子设计参数的“回归方法”。</p>
</div>
<div id="多参数检验" class="section level3 hasAnchor" number="6.3.2">
<h3><span class="header-section-number">6.3.2</span> 多参数检验<a href="单随机因子线性混合效应模型.html#多参数检验" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>当你处理的设计中所有分类因子的水平都不超过两个时，与给定因子相关的回归系数检验将等同于ANOVA框架中的效应检验，前提是你使用<a href="多元回归.html#处理分类预测变量">求和或偏差编码</a>。但是在上述示例中，我们有一个3x2设计，其中两个预测变量分别编码<code>meal</code>的主效应(<code>lunch_v_breakfast</code>和<code>dinner_v_breakfast</code>)。让我们模拟一些数据并使用<code>aov()</code>运行一个单因素ANOVA，然后我们将使用回归函数<code>lm()</code>复制该分析(请注意，对于多层数据的混合效应模型，使用<code>lme4::lmer()</code>代替<code>base::lm()</code>也能得到相同的结果)。</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="单随机因子线性混合效应模型.html#cb186-1" tabindex="-1"></a><span class="do">## 模拟一些数据</span></span>
<span id="cb186-2"><a href="单随机因子线性混合效应模型.html#cb186-2" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">62</span>)</span>
<span id="cb186-3"><a href="单随机因子线性混合效应模型.html#cb186-3" tabindex="-1"></a>meals <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">meal =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;breakfast&quot;</span>, <span class="st">&quot;lunch&quot;</span>, <span class="st">&quot;dinner&quot;</span>),</span>
<span id="cb186-4"><a href="单随机因子线性混合效应模型.html#cb186-4" tabindex="-1"></a>                                  <span class="at">each =</span> <span class="dv">6</span>)),</span>
<span id="cb186-5"><a href="单随机因子线性混合效应模型.html#cb186-5" tabindex="-1"></a>                <span class="at">time_of_week =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;weekday&quot;</span>, <span class="st">&quot;weekend&quot;</span>),</span>
<span id="cb186-6"><a href="单随机因子线性混合效应模型.html#cb186-6" tabindex="-1"></a>                                              <span class="at">each =</span> <span class="dv">3</span>), <span class="dv">3</span>)),</span>
<span id="cb186-7"><a href="单随机因子线性混合效应模型.html#cb186-7" tabindex="-1"></a>                <span class="at">calories =</span> <span class="fu">rnorm</span>(<span class="dv">18</span>, <span class="dv">450</span>, <span class="dv">50</span>))</span>
<span id="cb186-8"><a href="单随机因子线性混合效应模型.html#cb186-8" tabindex="-1"></a></span>
<span id="cb186-9"><a href="单随机因子线性混合效应模型.html#cb186-9" tabindex="-1"></a><span class="do">## 使用求和编码代替默认的虚拟(处理)编码</span></span>
<span id="cb186-10"><a href="单随机因子线性混合效应模型.html#cb186-10" tabindex="-1"></a><span class="fu">options</span>(<span class="at">contrasts =</span> <span class="fu">c</span>(<span class="at">unordered =</span> <span class="st">&quot;contr.sum&quot;</span>, <span class="at">ordered =</span> <span class="st">&quot;contr.poly&quot;</span>))</span>
<span id="cb186-11"><a href="单随机因子线性混合效应模型.html#cb186-11" tabindex="-1"></a></span>
<span id="cb186-12"><a href="单随机因子线性混合效应模型.html#cb186-12" tabindex="-1"></a><span class="fu">aov</span>(calories <span class="sc">~</span> meal <span class="sc">*</span> time_of_week, <span class="at">data =</span> meals) <span class="sc">%&gt;%</span></span>
<span id="cb186-13"><a href="单随机因子线性混合效应模型.html#cb186-13" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##                   Df Sum Sq Mean Sq F value Pr(&gt;F)
## meal               2   2164    1082   0.380  0.692
## time_of_week       1   5084    5084   1.783  0.207
## meal:time_of_week  2   4767    2384   0.836  0.457
## Residuals         12  34209    2851</code></pre>
<p>我们得到3个<span class="math inline">\(F\)</span>检验，每个主效应各1个(<code>meal</code>和<code>time_of_week</code>)，交互效应1个。如果我们用<code>lm()</code>来拟合模型呢？</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="单随机因子线性混合效应模型.html#cb188-1" tabindex="-1"></a><span class="do">## 添加我们自己的数值型变量</span></span>
<span id="cb188-2"><a href="单随机因子线性混合效应模型.html#cb188-2" tabindex="-1"></a>meals2 <span class="ot">&lt;-</span> meals <span class="sc">%&gt;%</span></span>
<span id="cb188-3"><a href="单随机因子线性混合效应模型.html#cb188-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lunch_v_breakfast =</span> <span class="fu">if_else</span>(meal <span class="sc">==</span> <span class="st">&quot;lunch&quot;</span>, <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>),</span>
<span id="cb188-4"><a href="单随机因子线性混合效应模型.html#cb188-4" tabindex="-1"></a>         <span class="at">dinner_v_breakfast =</span> <span class="fu">if_else</span>(meal <span class="sc">==</span> <span class="st">&quot;dinner&quot;</span>, <span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>),</span>
<span id="cb188-5"><a href="单随机因子线性混合效应模型.html#cb188-5" tabindex="-1"></a>         <span class="at">time_week =</span> <span class="fu">if_else</span>(time_of_week <span class="sc">==</span> <span class="st">&quot;weekend&quot;</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>, <span class="sc">-</span><span class="dv">1</span><span class="sc">/</span><span class="dv">2</span>))</span>
<span id="cb188-6"><a href="单随机因子线性混合效应模型.html#cb188-6" tabindex="-1"></a></span>
<span id="cb188-7"><a href="单随机因子线性混合效应模型.html#cb188-7" tabindex="-1"></a><span class="do">## 再此确认我们的编码</span></span>
<span id="cb188-8"><a href="单随机因子线性混合效应模型.html#cb188-8" tabindex="-1"></a><span class="fu">distinct</span>(meals2, meal, time_of_week,</span>
<span id="cb188-9"><a href="单随机因子线性混合效应模型.html#cb188-9" tabindex="-1"></a>         lunch_v_breakfast, dinner_v_breakfast, time_week)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   meal      time_of_week lunch_v_breakfast dinner_v_breakfast time_week
##   &lt;fct&gt;     &lt;fct&gt;                    &lt;dbl&gt;              &lt;dbl&gt;     &lt;dbl&gt;
## 1 breakfast weekday                 -0.333             -0.333      -0.5
## 2 breakfast weekend                 -0.333             -0.333       0.5
## 3 lunch     weekday                  0.667             -0.333      -0.5
## 4 lunch     weekend                  0.667             -0.333       0.5
## 5 dinner    weekday                 -0.333              0.667      -0.5
## 6 dinner    weekend                 -0.333              0.667       0.5</code></pre>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="单随机因子线性混合效应模型.html#cb190-1" tabindex="-1"></a><span class="do">## 拟合回归模型</span></span>
<span id="cb190-2"><a href="单随机因子线性混合效应模型.html#cb190-2" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(calories <span class="sc">~</span> (lunch_v_breakfast <span class="sc">+</span> dinner_v_breakfast) <span class="sc">*</span></span>
<span id="cb190-3"><a href="单随机因子线性混合效应模型.html#cb190-3" tabindex="-1"></a>            time_week, <span class="at">data =</span> meals2)</span>
<span id="cb190-4"><a href="单随机因子线性混合效应模型.html#cb190-4" tabindex="-1"></a></span>
<span id="cb190-5"><a href="单随机因子线性混合效应模型.html#cb190-5" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = calories ~ (lunch_v_breakfast + dinner_v_breakfast) * 
##     time_week, data = meals2)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -68.522 -35.895  -4.063  42.061  73.081 
## 
## Coefficients:
##                              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                    451.15      12.58  35.848 1.42e-13 ***
## lunch_v_breakfast              -25.23      30.83  -0.818    0.429    
## dinner_v_breakfast             -20.59      30.83  -0.668    0.517    
## time_week                       33.61      25.17   1.335    0.207    
## lunch_v_breakfast:time_week    -58.31      61.65  -0.946    0.363    
## dinner_v_breakfast:time_week    17.93      61.65   0.291    0.776    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 53.39 on 12 degrees of freedom
## Multiple R-squared:  0.2599, Adjusted R-squared:  -0.04843 
## F-statistic: 0.843 on 5 and 12 DF,  p-value: 0.5447</code></pre>
<p>好的，这个输出结果看起来非常不同！在这种情况下，如何执行类似ANOVA的检验呢？你已经得到了<code>lunch_v_breakfast</code>和<code>dinner_v_breakfast</code>的估计值，但如何将其转换为对<code>meal</code>主效应的单一检验呢？同样，你有两个交互项<code>lunch_v_breakfast:tow</code>和<code>dinner_v_breakfast:tow</code>，如何将其转换为对交互效应的单一检验呢？</p>
<p>解决方案是使用模型比较进行<strong>多参数检验</strong>，在R中由<code>anova()</code>函数实现。为了检验<code>meal</code>的主效应，你需要比较包含编码该因素的两个预测变量(<code>lunch_v_breakfast</code>和<code>dinner_v_breakfast</code>)的模型与一个不包含这两个预测变量但其他部分相同的模型。你可以重新写个模型并排除这些项来重新拟合模型，或者使用<code>update()</code>函数并移除这些项(这是一种简写方法)。我们先写出来。</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="单随机因子线性混合效应模型.html#cb192-1" tabindex="-1"></a><span class="do">## 拟合模型</span></span>
<span id="cb192-2"><a href="单随机因子线性混合效应模型.html#cb192-2" tabindex="-1"></a>mod_main_eff <span class="ot">&lt;-</span> <span class="fu">lm</span>(calories <span class="sc">~</span> time_week <span class="sc">+</span></span>
<span id="cb192-3"><a href="单随机因子线性混合效应模型.html#cb192-3" tabindex="-1"></a>                     lunch_v_breakfast<span class="sc">:</span>time_week <span class="sc">+</span> dinner_v_breakfast<span class="sc">:</span>time_week,</span>
<span id="cb192-4"><a href="单随机因子线性混合效应模型.html#cb192-4" tabindex="-1"></a>                   meals2)</span>
<span id="cb192-5"><a href="单随机因子线性混合效应模型.html#cb192-5" tabindex="-1"></a></span>
<span id="cb192-6"><a href="单随机因子线性混合效应模型.html#cb192-6" tabindex="-1"></a><span class="do">## 比较模型</span></span>
<span id="cb192-7"><a href="单随机因子线性混合效应模型.html#cb192-7" tabindex="-1"></a><span class="fu">anova</span>(mod, mod_main_eff)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: calories ~ (lunch_v_breakfast + dinner_v_breakfast) * time_week
## Model 2: calories ~ time_week + lunch_v_breakfast:time_week + dinner_v_breakfast:time_week
##   Res.Df   RSS Df Sum of Sq      F Pr(&gt;F)
## 1     12 34209                           
## 2     14 36373 -2   -2163.9 0.3795 0.6921</code></pre>
<p>好的，现在这里是使用简写方法<code>update()</code>函数的等效版本，它将你想要更新的模型作为第一个参数，然后使用特殊语法来进行你的更改。对于公式，我们使用<code>. ~ . -lunch_v_breakfast -dinner_v_breakfast~</code>。虽然这个公式看起来有些奇怪，但点<code>.</code>表示“在模型公式的这一侧(<code>~</code>左侧)保持原模型中的所有内容不变”。因此，公式<code>. ~ .</code>表示使用与原模型相同的公式；也就是说<code>update(mod, . ~ .)</code>将拟合与上述完全相同的模型。相比之下，<code>. ~ . -x -y</code>意味着“左侧保持不变(相同的因变量)，但从右侧移除变量<code>x</code>和<code>y</code>”。</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb194-1"><a href="单随机因子线性混合效应模型.html#cb194-1" tabindex="-1"></a>mod_main_eff2 <span class="ot">&lt;-</span> <span class="fu">update</span>(mod, . <span class="sc">~</span> . <span class="sc">-</span>lunch_v_breakfast <span class="sc">-</span>dinner_v_breakfast)</span>
<span id="cb194-2"><a href="单随机因子线性混合效应模型.html#cb194-2" tabindex="-1"></a></span>
<span id="cb194-3"><a href="单随机因子线性混合效应模型.html#cb194-3" tabindex="-1"></a><span class="fu">anova</span>(mod, mod_main_eff2)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: calories ~ (lunch_v_breakfast + dinner_v_breakfast) * time_week
## Model 2: calories ~ time_week + lunch_v_breakfast:time_week + dinner_v_breakfast:time_week
##   Res.Df   RSS Df Sum of Sq      F Pr(&gt;F)
## 1     12 34209                           
## 2     14 36373 -2   -2163.9 0.3795 0.6921</code></pre>
<p>如你所见，这给出了和之前相同的结果。</p>
<p>如果你想检验<code>time_of_week</code>的主效应，去掉这个预测因子。</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="单随机因子线性混合效应模型.html#cb196-1" tabindex="-1"></a>mod_tow <span class="ot">&lt;-</span> <span class="fu">update</span>(mod, . <span class="sc">~</span> . <span class="sc">-</span>time_week)</span>
<span id="cb196-2"><a href="单随机因子线性混合效应模型.html#cb196-2" tabindex="-1"></a></span>
<span id="cb196-3"><a href="单随机因子线性混合效应模型.html#cb196-3" tabindex="-1"></a><span class="fu">anova</span>(mod, mod_tow)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: calories ~ (lunch_v_breakfast + dinner_v_breakfast) * time_week
## Model 2: calories ~ lunch_v_breakfast + dinner_v_breakfast + lunch_v_breakfast:time_week + 
##     dinner_v_breakfast:time_week
##   Res.Df   RSS Df Sum of Sq      F Pr(&gt;F)
## 1     12 34209                           
## 2     13 39294 -1   -5084.1 1.7834 0.2065</code></pre>
<p>试着弄清楚如何检验交互效应。</p>
<div class="webex-solution">
<button>
点击查看答案
</button>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="单随机因子线性混合效应模型.html#cb198-1" tabindex="-1"></a>mod_interact <span class="ot">&lt;-</span> <span class="fu">update</span>(mod, . <span class="sc">~</span> . <span class="sc">-</span>lunch_v_breakfast<span class="sc">:</span>time_week</span>
<span id="cb198-2"><a href="单随机因子线性混合效应模型.html#cb198-2" tabindex="-1"></a>                       <span class="sc">-</span>dinner_v_breakfast<span class="sc">:</span>time_week)</span>
<span id="cb198-3"><a href="单随机因子线性混合效应模型.html#cb198-3" tabindex="-1"></a></span>
<span id="cb198-4"><a href="单随机因子线性混合效应模型.html#cb198-4" tabindex="-1"></a><span class="fu">anova</span>(mod, mod_interact)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Model 1: calories ~ (lunch_v_breakfast + dinner_v_breakfast) * time_week
## Model 2: calories ~ lunch_v_breakfast + dinner_v_breakfast + time_week
##   Res.Df   RSS Df Sum of Sq      F Pr(&gt;F)
## 1     12 34209                           
## 2     14 38977 -2   -4767.4 0.8362 0.4571</code></pre>
</div>
<p>我们使用<code>lm()</code>进行模型比较得到了与使用<code>aov()</code>完全相同的结果。尽管这涉及更多的步骤，但学习这种方法是值得的，因为它最终会让你有更多的灵活性。</p>

</div>
</div>
</div>
<h3>参考文献<a href="参考文献.html#参考文献" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Luke_2017" class="csl-entry">
Luke, S. G. (2017). Evaluating significance in linear mixed-effects models in r. <em><span>Behavior Research Methods</span></em>, <em>49</em>, 1494–1502.
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("webex-total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("webex-correct").length + " of " +
      document.getElementsByClassName("webex-solveme").length + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }

  update_total_correct();
}

</script>
<script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );
});
</script>

            </section>

          </div>
        </div>
      </div>
<a href="介绍线性混合效应模型.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="交叉随机因子线性混合效应模型.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CBook.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
