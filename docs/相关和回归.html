<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 相关和回归 | 学习统计模型——通过R模拟(施工中)</title>
  <meta name="description" content="2 相关和回归 | 学习统计模型——通过R模拟(施工中)" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="2 相关和回归 | 学习统计模型——通过R模拟(施工中)" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 相关和回归 | 学习统计模型——通过R模拟(施工中)" />
  
  
  

<meta name="author" content="周博霖" />


<meta name="date" content="2024-06-10" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="前言.html"/>
<link rel="next" href="多元回归.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX","output/SVG"],
  extensions: ["tex2jax.js","MathMenu.js","MathZoom.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
  }
});
</script>
<script type="text/javascript"
   src="../../../MathJax/MathJax.js">
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>概述</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#译者按"><i class="fa fa-check"></i>译者按</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#如何引用本书"><i class="fa fa-check"></i>如何引用本书</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#发现问题"><i class="fa fa-check"></i>发现问题？</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#教育者需知"><i class="fa fa-check"></i>教育者需知</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="前言.html"><a href="前言.html"><i class="fa fa-check"></i><b>1</b> 前言</a>
<ul>
<li class="chapter" data-level="1.1" data-path="前言.html"><a href="前言.html#课程目的"><i class="fa fa-check"></i><b>1.1</b> 课程目的</a></li>
<li class="chapter" data-level="1.2" data-path="前言.html"><a href="前言.html#广义线性混合效应模型generalized-linear-mixed-effects-models-glmms"><i class="fa fa-check"></i><b>1.2</b> 广义线性混合效应模型(Generalized Linear Mixed-Effects Models, GLMMs)</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="前言.html"><a href="前言.html#线性模型"><i class="fa fa-check"></i><b>1.2.1</b> 线性模型</a></li>
<li class="chapter" data-level="1.2.2" data-path="前言.html"><a href="前言.html#混合模型"><i class="fa fa-check"></i><b>1.2.2</b> 混合模型</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="前言.html"><a href="前言.html#关于可重复性的说明"><i class="fa fa-check"></i><b>1.3</b> 关于可重复性的说明</a></li>
<li class="chapter" data-level="1.4" data-path="前言.html"><a href="前言.html#基于模拟的方法"><i class="fa fa-check"></i><b>1.4</b> 基于模拟的方法</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="相关和回归.html"><a href="相关和回归.html"><i class="fa fa-check"></i><b>2</b> 相关和回归</a>
<ul>
<li class="chapter" data-level="2.1" data-path="相关和回归.html"><a href="相关和回归.html#相关矩阵correlation-matrices"><i class="fa fa-check"></i><b>2.1</b> 相关矩阵(Correlation matrices)</a></li>
<li class="chapter" data-level="2.2" data-path="相关和回归.html"><a href="相关和回归.html#模拟二元数据"><i class="fa fa-check"></i><b>2.2</b> 模拟二元数据</a></li>
<li class="chapter" data-level="2.3" data-path="相关和回归.html"><a href="相关和回归.html#相关和回归的关系"><i class="fa fa-check"></i><b>2.3</b> 相关和回归的关系</a></li>
<li class="chapter" data-level="2.4" data-path="相关和回归.html"><a href="相关和回归.html#练习"><i class="fa fa-check"></i><b>2.4</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="多元回归.html"><a href="多元回归.html"><i class="fa fa-check"></i><b>3</b> 多元回归</a>
<ul>
<li class="chapter" data-level="3.1" data-path="多元回归.html"><a href="多元回归.html#一个例子如何在统计学上取得好成绩"><i class="fa fa-check"></i><b>3.1</b> 一个例子：如何在统计学上取得好成绩</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="多元回归.html"><a href="多元回归.html#数据导入和可视化"><i class="fa fa-check"></i><b>3.1.1</b> 数据导入和可视化</a></li>
<li class="chapter" data-level="3.1.2" data-path="多元回归.html"><a href="多元回归.html#估计和解释"><i class="fa fa-check"></i><b>3.1.2</b> 估计和解释</a></li>
<li class="chapter" data-level="3.1.3" data-path="多元回归.html"><a href="多元回归.html#使用predict通过线性模型进行预测"><i class="fa fa-check"></i><b>3.1.3</b> 使用<code>predict()</code>通过线性模型进行预测</a></li>
<li class="chapter" data-level="3.1.4" data-path="多元回归.html"><a href="多元回归.html#偏效应可视化"><i class="fa fa-check"></i><b>3.1.4</b> 偏效应可视化</a></li>
<li class="chapter" data-level="3.1.5" data-path="多元回归.html"><a href="多元回归.html#标准化系数"><i class="fa fa-check"></i><b>3.1.5</b> 标准化系数</a></li>
<li class="chapter" data-level="3.1.6" data-path="多元回归.html"><a href="多元回归.html#模型比较"><i class="fa fa-check"></i><b>3.1.6</b> 模型比较</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="多元回归.html"><a href="多元回归.html#处理分类预测变量"><i class="fa fa-check"></i><b>3.2</b> 处理分类预测变量</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="多元回归.html"><a href="多元回归.html#虚拟编码又称处理编码"><i class="fa fa-check"></i><b>3.2.1</b> 虚拟编码(又称“处理”编码)</a></li>
<li class="chapter" data-level="3.2.2" data-path="多元回归.html"><a href="多元回归.html#当k-2时的虚拟编码"><i class="fa fa-check"></i><b>3.2.2</b> 当<span class="math inline">\(k &gt; 2\)</span>时的虚拟编码</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="多元回归.html"><a href="多元回归.html#多元回归和单因素方差分析one-way-anova的等价性"><i class="fa fa-check"></i><b>3.3</b> 多元回归和单因素方差分析(one-way ANOVA)的等价性</a></li>
<li class="chapter" data-level="3.4" data-path="多元回归.html"><a href="多元回归.html#练习答案"><i class="fa fa-check"></i><b>3.4</b> 练习答案</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="交互效应.html"><a href="交互效应.html"><i class="fa fa-check"></i><b>4</b> 交互效应</a>
<ul>
<li class="chapter" data-level="4.1" data-path="交互效应.html"><a href="交互效应.html#cont-by-cat"><i class="fa fa-check"></i><b>4.1</b> 连续变量-分类变量交互效应</a></li>
<li class="chapter" data-level="4.2" data-path="交互效应.html"><a href="交互效应.html#分类变量-分类变量交互效应"><i class="fa fa-check"></i><b>4.2</b> 分类变量-分类变量交互效应</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="交互效应.html"><a href="交互效应.html#认知治疗与药物治疗对情绪的影响"><i class="fa fa-check"></i><b>4.2.1</b> 认知治疗与药物治疗对情绪的影响</a></li>
<li class="chapter" data-level="4.2.2" data-path="交互效应.html"><a href="交互效应.html#因子设计中的效应"><i class="fa fa-check"></i><b>4.2.2</b> 因子设计中的效应</a></li>
<li class="chapter" data-level="4.2.3" data-path="交互效应.html"><a href="交互效应.html#高阶设计higher-order-designs"><i class="fa fa-check"></i><b>4.2.3</b> 高阶设计(Higher-order designs)</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="交互效应.html"><a href="交互效应.html#用于因子设计的glm"><i class="fa fa-check"></i><b>4.3</b> 用于因子设计的GLM</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="交互效应.html"><a href="交互效应.html#估计方程estimation-equations"><i class="fa fa-check"></i><b>4.3.1</b> 估计方程(estimation equations)</a></li>
<li class="chapter" data-level="4.3.2" data-path="交互效应.html"><a href="交互效应.html#因子设计app"><i class="fa fa-check"></i><b>4.3.2</b> 因子设计App</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="交互效应.html"><a href="交互效应.html#在因子设计中对分类预测因子进行编码"><i class="fa fa-check"></i><b>4.4</b> 在因子设计中对分类预测因子进行编码</a></li>
<li class="chapter" data-level="4.5" data-path="交互效应.html"><a href="交互效应.html#分类变量的编码方案"><i class="fa fa-check"></i><b>4.5</b> 分类变量的编码方案</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="交互效应.html"><a href="交互效应.html#简单效应-vs.-主效应"><i class="fa fa-check"></i><b>4.5.1</b> 简单效应 vs. 主效应</a></li>
<li class="chapter" data-level="4.5.2" data-path="交互效应.html"><a href="交互效应.html#主要编码方案"><i class="fa fa-check"></i><b>4.5.2</b> 主要编码方案</a></li>
<li class="chapter" data-level="4.5.3" data-path="交互效应.html"><a href="交互效应.html#超过2水平的因子呢"><i class="fa fa-check"></i><b>4.5.3</b> 超过2水平的因子呢？</a></li>
<li class="chapter" data-level="4.5.4" data-path="交互效应.html"><a href="交互效应.html#举例3水平因子"><i class="fa fa-check"></i><b>4.5.4</b> 举例：3水平因子</a></li>
<li class="chapter" data-level="4.5.5" data-path="交互效应.html"><a href="交互效应.html#如何创建你自己的数值型预测变量"><i class="fa fa-check"></i><b>4.5.5</b> 如何创建你自己的数值型预测变量</a></li>
<li class="chapter" data-level="4.5.6" data-path="交互效应.html"><a href="交互效应.html#小结"><i class="fa fa-check"></i><b>4.5.6</b> 小结</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html"><i class="fa fa-check"></i><b>5</b> 介绍线性混合效应模型</a>
<ul>
<li class="chapter" data-level="5.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#多层数据建模"><i class="fa fa-check"></i><b>5.1</b> 多层数据建模</a></li>
<li class="chapter" data-level="5.2" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#如何对这些数据进行建模"><i class="fa fa-check"></i><b>5.2</b> 如何对这些数据进行建模</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#完全混合一刀切"><i class="fa fa-check"></i><b>5.2.1</b> 完全混合：一刀切</a></li>
<li class="chapter" data-level="5.2.2" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#不混合"><i class="fa fa-check"></i><b>5.2.2</b> 不混合</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#使用混合效果模型的部分混合"><i class="fa fa-check"></i><b>5.3</b> 使用混合效果模型的部分混合</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#方差-协方差矩阵"><i class="fa fa-check"></i><b>5.3.1</b> 方差-协方差矩阵</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#估计模型参数"><i class="fa fa-check"></i><b>5.4</b> 估计模型参数</a></li>
<li class="chapter" data-level="5.5" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#解释lmer输出结果并提取估计值"><i class="fa fa-check"></i><b>5.5</b> 解释<code>lmer()</code>输出结果并提取估计值</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#固定效应"><i class="fa fa-check"></i><b>5.5.1</b> 固定效应</a></li>
<li class="chapter" data-level="5.5.2" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#随机效应"><i class="fa fa-check"></i><b>5.5.2</b> 随机效应</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#多层app"><i class="fa fa-check"></i><b>5.6</b> 多层app</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html"><i class="fa fa-check"></i><b>6</b> 单随机因子线性混合效应模型</a>
<ul>
<li class="chapter" data-level="6.1" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#什么时候为什么你想用线性混合效应建模取代传统的分析"><i class="fa fa-check"></i><b>6.1</b> 什么时候，为什么，你想用线性混合效应建模取代传统的分析?</a></li>
<li class="chapter" data-level="6.2" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#示例多层数据上的独立样本t检验"><i class="fa fa-check"></i><b>6.2</b> 示例：多层数据上的独立样本<span class="math inline">\(t\)</span>检验</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#什么时候使用随机截距模型是合适的"><i class="fa fa-check"></i><b>6.2.1</b> 什么时候使用随机截距模型是合适的?</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#用回归表达研究设计和进行检验"><i class="fa fa-check"></i><b>6.3</b> 用回归表达研究设计和进行检验</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#水平以上的因子"><i class="fa fa-check"></i><b>6.3.1</b> 2水平以上的因子</a></li>
<li class="chapter" data-level="6.3.2" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#多参数检验"><i class="fa fa-check"></i><b>6.3.2</b> 多参数检验</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html"><i class="fa fa-check"></i><b>7</b> 交叉随机因子线性混合效应模型</a></li>
<li class="chapter" data-level="" data-path="参考文献.html"><a href="参考文献.html"><i class="fa fa-check"></i>参考文献</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">学习统计模型——通过R模拟(施工中)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="相关和回归" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> 相关和回归<a href="相关和回归.html#相关和回归" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="相关矩阵correlation-matrices" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> 相关矩阵(Correlation matrices)<a href="相关和回归.html#相关矩阵correlation-matrices" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>你可能已经通过阅读心理学论文对<strong>相关矩阵</strong>这个概念有所了解。相关矩阵是总结同一个体的多个测量值之间关系的常用方法。</p>
<p>假设你用多个量表测量了心理幸福感。一个问题是这些量表在多大程度上测量了相同的东西。通常，你会查看相关矩阵来探索测量之间所有成对关系。</p>
<p>回忆一下，相关系数量化了两个变量之间关系的<strong>强度</strong>和<strong>方向</strong>。它通常用符号<span class="math inline">\(r\)</span>或<span class="math inline">\(\rho\)</span>(希腊字母”rho”)表示。相关系数的范围在-1到1之间，其中0表示没有关系，正值反映正相关(一个变量增加，另一个也增加)，负值反映负相关(一个变量增加，另一个减少)。</p>
<div class="figure"><span style="display:block;" id="fig:correlation-relationships"></span>
<img src="02-%E7%9B%B8%E5%85%B3%E5%92%8C%E5%9B%9E%E5%BD%92_files/figure-html/correlation-relationships-1.png" alt="不同类型的二元关系" width="576" />
<p class="caption">
图2.1: 不同类型的二元关系
</p>
</div>
<p>如果你有<span class="math inline">\(n\)</span>个测量值，你可以计算多少个成对相关？你可以用下面蓝框中的公式来计算，也可以更简单地通过R中的<code>choose(n, 2)</code>函数直接计算。例如，要获得6个测量值之间可能的成对相关数量，你可以输入<code>choose(6, 2)</code>，这会告诉你有15对组合。</p>
<div class="bluebox">
<p>对于任意<span class="math inline">\(n\)</span>个测量值，你可以计算<span class="math inline">\(\frac{n!}{2(n - 2)!}\)</span>个各值之间的成对相关。符号<span class="math inline">\(!\)</span>称为<strong>阶乘(factorial)</strong>运算符，定义为从1到<span class="math inline">\(n\)</span>所有数字的乘积。因此，如果你有6个测量值，你可以得到</p>
<p><span class="math display">\[
\frac{6!}{2(6-2)!} = \frac{1 \times 2 \times 3 \times 4 \times 5 \times 6}{2\left(1 \times 2 \times 3 \times 4\right)} = \frac{720}{2(24)} = 15
\]</span></p>
</div>
<p>你可以使用R中的<code>base::cor()</code>或<code>corrr::correlate()</code>来创建相关矩阵。我们更喜欢后者函数，因为<code>cor()</code>要求你的数据存储在矩阵中，而我们将处理的大多数数据是存储在数据框中的表格数据。<code>corrr::correlate()</code>函数将数据框作为第一个参数，并提供”整洁”的输出，因此它可以更好地与tidyverse系列函数和管道操作符(<code>%&gt;%</code>)联动。</p>
<p>让我们创建一个相关矩阵来看看它是如何工作的。首先加载我们需要的包。</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="相关和回归.html#cb8-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</span>
<span id="cb8-2"><a href="相关和回归.html#cb8-2" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;corrr&quot;</span>)  <span class="co"># 如缺失(missing)，在控制台(console)中输入install.packages(&quot;corrr&quot;)</span></span></code></pre></div>
<p>我们将使用<code>starwars</code>数据集，这是在加载tidyverse包后可用的内置数据集。该数据集包含了出现在星球大战电影系列中的各种角色的信息。让我们来看看之间的相关性</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="相关和回归.html#cb9-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="相关和回归.html#cb9-2" tabindex="-1"></a>  <span class="fu">select</span>(height, mass, birth_year) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="相关和回归.html#cb9-3" tabindex="-1"></a>  <span class="fu">correlate</span>()</span></code></pre></div>
<pre><code>## Correlation computed with
## • Method: &#39;pearson&#39;
## • Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<pre><code>## # A tibble: 3 × 4
##   term       height   mass birth_year
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 height     NA      0.131     -0.404
## 2 mass        0.131 NA          0.478
## 3 birth_year -0.404  0.478     NA</code></pre>
<p>你可以在任意给定的行或列的交叉处查找任何双变量相关系数。因此，<code>height</code>和<code>mass</code>之间的相关系数是.131，你可以在第1行，第2列或第2行，第1列找到它——它们是相同的。请注意，这里只有<code>choose(3, 2)</code> = 3个唯一的双变量关系，但每个关系在表中出现了两次。我们可能只想显示唯一的组合，这可以通过在管道中附加<code>corrr::shave()</code>来实现。</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="相关和回归.html#cb12-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="相关和回归.html#cb12-2" tabindex="-1"></a>  <span class="fu">select</span>(height, mass, birth_year) <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="相关和回归.html#cb12-3" tabindex="-1"></a>  <span class="fu">correlate</span>() <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="相关和回归.html#cb12-4" tabindex="-1"></a>  <span class="fu">shave</span>()</span></code></pre></div>
<pre><code>## Correlation computed with
## • Method: &#39;pearson&#39;
## • Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<pre><code>## # A tibble: 3 × 4
##   term       height   mass birth_year
##   &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;      &lt;dbl&gt;
## 1 height     NA     NA             NA
## 2 mass        0.131 NA             NA
## 3 birth_year -0.404  0.478         NA</code></pre>
<p>现在我们只有相关矩阵的下三角部分，但<code>NA</code>看起来很难看，前导0也不美观。<strong><code>corrr</code></strong>包还提供了<code>fashion()</code>函数，可以对其进行清理(更多选项请查阅<code>?corrr::fashion</code>)。</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="相关和回归.html#cb15-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="相关和回归.html#cb15-2" tabindex="-1"></a>  <span class="fu">select</span>(height, mass, birth_year) <span class="sc">%&gt;%</span></span>
<span id="cb15-3"><a href="相关和回归.html#cb15-3" tabindex="-1"></a>  <span class="fu">correlate</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="相关和回归.html#cb15-4" tabindex="-1"></a>  <span class="fu">shave</span>() <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="相关和回归.html#cb15-5" tabindex="-1"></a>  <span class="fu">fashion</span>()</span></code></pre></div>
<pre><code>## Correlation computed with
## • Method: &#39;pearson&#39;
## • Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<pre><code>##         term height mass birth_year
## 1     height                       
## 2       mass    .13                
## 3 birth_year   -.40  .48</code></pre>
<p>相关性只有在关系(大致)线性且没有严重的异常值对结果产生过大影响时才能很好地描述关系。因此，可视化相关性通常和量化它们一样是个好主意。<code>base::pairs()</code>函数可以实现这一点。<code>pairs()</code>的第一个参数形式为<code>~ v1 + v2 + v3 + ... + vn</code>，其中<code>v1</code>、<code>v2</code>等是你想要进行相关分析的变量名。</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="相关和回归.html#cb18-1" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span> height <span class="sc">+</span> mass <span class="sc">+</span> birth_year, starwars)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:pairs"></span>
<img src="02-%E7%9B%B8%E5%85%B3%E5%92%8C%E5%9B%9E%E5%BD%92_files/figure-html/pairs-1.png" alt="星球大战数据集相关关系" width="576" />
<p class="caption">
图2.2: 星球大战数据集相关关系
</p>
</div>
<p>我们会发现一个巨大的离群值影响了我们的数据。具体来说是有个体重超过1200kg的生物。让我们找出它并从数据集里面删掉它。</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="相关和回归.html#cb19-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb19-2"><a href="相关和回归.html#cb19-2" tabindex="-1"></a>  <span class="fu">filter</span>(mass <span class="sc">&gt;</span> <span class="dv">1200</span>) <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="相关和回归.html#cb19-3" tabindex="-1"></a>  <span class="fu">select</span>(name, mass, height, birth_year)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   name                   mass height birth_year
##   &lt;chr&gt;                 &lt;dbl&gt;  &lt;int&gt;      &lt;dbl&gt;
## 1 Jabba Desilijic Tiure  1358    175        600</code></pre>
<p>好了，让我们看看没有了这个庞然大物的数据会是什么样子。</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="相关和回归.html#cb21-1" tabindex="-1"></a>starwars2 <span class="ot">&lt;-</span> starwars <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="相关和回归.html#cb21-2" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">&quot;Jabba Desilijic Tiure&quot;</span>)</span>
<span id="cb21-3"><a href="相关和回归.html#cb21-3" tabindex="-1"></a></span>
<span id="cb21-4"><a href="相关和回归.html#cb21-4" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>height <span class="sc">+</span> mass <span class="sc">+</span> birth_year, starwars2)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:massive-creature"></span>
<img src="02-%E7%9B%B8%E5%85%B3%E5%92%8C%E5%9B%9E%E5%BD%92_files/figure-html/massive-creature-1.png" alt="去除体重离群值后星球大战数据集相关关系" width="672" />
<p class="caption">
图2.3: 去除体重离群值后星球大战数据集相关关系
</p>
</div>
<p>好多了，但还有个生物的离群出生年份可能是我们不想要的。</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="相关和回归.html#cb22-1" tabindex="-1"></a>starwars2 <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="相关和回归.html#cb22-2" tabindex="-1"></a>  <span class="fu">filter</span>(birth_year <span class="sc">&gt;</span> <span class="dv">800</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="相关和回归.html#cb22-3" tabindex="-1"></a>  <span class="fu">select</span>(name, height, mass, birth_year)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 4
##   name  height  mass birth_year
##   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;      &lt;dbl&gt;
## 1 Yoda      66    17        896</code></pre>
<p>是尤达大师！他和宇宙一样古老。让我们抛开他看看图会怎么样。</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="相关和回归.html#cb24-1" tabindex="-1"></a>starwars3 <span class="ot">&lt;-</span> starwars2 <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="相关和回归.html#cb24-2" tabindex="-1"></a>  <span class="fu">filter</span>(name <span class="sc">!=</span> <span class="st">&quot;Yoda&quot;</span>)</span>
<span id="cb24-3"><a href="相关和回归.html#cb24-3" tabindex="-1"></a></span>
<span id="cb24-4"><a href="相关和回归.html#cb24-4" tabindex="-1"></a><span class="fu">pairs</span>(<span class="sc">~</span>height <span class="sc">+</span> mass <span class="sc">+</span> birth_year, starwars3)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:bye-yoda"></span>
<img src="02-%E7%9B%B8%E5%85%B3%E5%92%8C%E5%9B%9E%E5%BD%92_files/figure-html/bye-yoda-1.png" alt="去除体重和出生年份离群值后星球大战数据集相关关系" width="576" />
<p class="caption">
图2.4: 去除体重和出生年份离群值后星球大战数据集相关关系
</p>
</div>
<p>看起来更好了。让我们看看它是怎样改变我们的相关矩阵的。</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="相关和回归.html#cb25-1" tabindex="-1"></a>starwars3 <span class="sc">%&gt;%</span></span>
<span id="cb25-2"><a href="相关和回归.html#cb25-2" tabindex="-1"></a>  <span class="fu">select</span>(height, mass, birth_year) <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="相关和回归.html#cb25-3" tabindex="-1"></a>  <span class="fu">correlate</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-4"><a href="相关和回归.html#cb25-4" tabindex="-1"></a>  <span class="fu">shave</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="相关和回归.html#cb25-5" tabindex="-1"></a>  <span class="fu">fashion</span>()</span></code></pre></div>
<pre><code>## Correlation computed with
## • Method: &#39;pearson&#39;
## • Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<pre><code>##         term height mass birth_year
## 1     height                       
## 2       mass    .73                
## 3 birth_year    .44  .24</code></pre>
<p>请注意，这些值与我们开始时的值有很大不同。</p>
<p>有时移除离群值不是一个好办法。处理离群值的另一个办法是使用一种更稳健(robust)的方法。使用<code>corrr::correlate()</code>默认计算的相关系数是Pearson积差相关(Pearson product-moment correlation)系数。我们也能通过改变<code>correlate()</code>的<code>method()</code>参数来计算Spearman相关系数。这将在计算相关性之前用排名替换原始值，因此仍会包括离群值，但影响将大大减小。</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="相关和回归.html#cb28-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="相关和回归.html#cb28-2" tabindex="-1"></a>  <span class="fu">select</span>(height, mass, birth_year) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="相关和回归.html#cb28-3" tabindex="-1"></a>  <span class="fu">correlate</span>(<span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="相关和回归.html#cb28-4" tabindex="-1"></a>  <span class="fu">shave</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-5"><a href="相关和回归.html#cb28-5" tabindex="-1"></a>  <span class="fu">fashion</span>()</span></code></pre></div>
<pre><code>## Correlation computed with
## • Method: &#39;spearman&#39;
## • Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<pre><code>##         term height mass birth_year
## 1     height                       
## 2       mass    .72                
## 3 birth_year    .15  .15</code></pre>
<p>顺便一提，如果你用R Markdown生成报告，并希望你的表格有个好看的格式，可以使用<code>knitr:: able()</code>。</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="相关和回归.html#cb31-1" tabindex="-1"></a>starwars <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="相关和回归.html#cb31-2" tabindex="-1"></a>  <span class="fu">select</span>(height, mass, birth_year) <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="相关和回归.html#cb31-3" tabindex="-1"></a>  <span class="fu">correlate</span>(<span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="相关和回归.html#cb31-4" tabindex="-1"></a>  <span class="fu">shave</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="相关和回归.html#cb31-5" tabindex="-1"></a>  <span class="fu">fashion</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="相关和回归.html#cb31-6" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="left">term</th>
<th align="left">height</th>
<th align="left">mass</th>
<th align="left">birth_year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">height</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">mass</td>
<td align="left">.72</td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">birth_year</td>
<td align="left">.15</td>
<td align="left">.15</td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div id="模拟二元数据" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> 模拟二元数据<a href="相关和回归.html#模拟二元数据" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>你已经学会了使用<code>rnorm()</code>函数从正态分布中模拟数据。回忆一下，<code>rnorm()</code>允许你指定单个变量的均值和标准差。那我们怎么模拟相关变量呢？</p>
<p>应该很明确，你不能仅仅运行两次<code>rnorm()</code>后组合变量就完事。因为这会得到两个不相关的变量，即相关性为零。</p>
<p><strong><code>MASS</code></strong>包提供<code>mvrnorm()</code>函数，这是rnorm的”多元”(multivariate)版(因此函数的名字是’mv’ + ‘rnorm’，这样更容易记住)。</p>
<div class="blueborder">
<p>R预装了<strong><code>MASS</code></strong>包。但<strong><code>MASS</code></strong>包中你唯一可能会用到的函数只是<code>mvrnorm()</code>，因此相比于使用<code>library("MASS")</code>加载包，使用<code>MASS::mvrnorm()</code>是更好的办法，尤其是在<strong><code>MASS</code></strong>和<strong><code>tidyverse</code></strong>里的<strong><code>dplyr</code></strong>包不太合得来的情况下(因为两个包都有<code>select()</code>函数)。因此，如果在加载<strong><code>tidyverse</code></strong>之后加载<strong><code>MASS</code></strong>，那么最终得到的<code>select()</code>是<strong><code>MASS</code></strong>版本，而不是<strong><code>dplyr</code></strong>版本。这会让你绞尽脑汁来找出代码的问题所在，所以总在不加载的情况下使用<code>MASS::mvrnorm()</code>吧。</p>
<p>注：这里作者贴了一则他在Twitter(现X)上吐槽<strong><code>MASS</code></strong>的打油诗，不过现在已经查不到了QwQ，考虑到翻译水平不佳，附上原文！</p>
<blockquote>
<p>MASS before dplyr, clashes not dire; <br> dplyr before MASS, pain in the ass.</p>
<p>—— Dale Barr(September 30, 2014)</p>
</blockquote>
</div>
<p>请查看<code>mvrnorm()</code>函数的文档(在控制台输入<code>?MASS::mvrnorm</code>)。</p>
<p>有3个参数需要注意：</p>
<table>
<thead>
<tr class="header">
<th align="left">参数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">n</td>
<td align="left">所需样本数</td>
</tr>
<tr class="even">
<td align="left">mu</td>
<td align="left">一个给出变量均值的向量</td>
</tr>
<tr class="odd">
<td align="left">Sigma</td>
<td align="left">一个正定对称矩阵，用于指定变量的协方差矩阵</td>
</tr>
</tbody>
</table>
<p>对<code>n</code>和<code>mu</code>的描述可以理解，但“一个正定对称矩阵(positive-definite symmetric matrix)，用于指定变量的协方差矩阵”是什么意思呢？</p>
<p>当你有个多层数据时，<strong>协方差矩阵</strong>(也叫<strong>方差-协方差矩阵</strong>)反映了各个变量的方差及其相互关系。它类似于<strong>标准差</strong>的多维版本。要充分描述单变量正态分布，你只需要知道均值和标准差；要描述双变量正态分布，你需要分别知道两个变量的均值、标准差和他们的相关性；对于包含两个以上变量的多元分布，你需要知道所有变量的均值、它们的标准差以及所有可能的成对相关性。<strong>这些概念在我们开始讨论混合效应模型时会变得非常重要。</strong></p>
<p>你可以将协方差矩阵看作类似于之前见过的相关矩阵；实际上，通过一些计算，你可以将协方差矩阵转换为相关矩阵。</p>
<div class="bluebox">
<p><strong>你在说什么《黑客帝国(Matrix)》？那不是从上世纪90年代开始的科幻电影系列吗？</strong></p>
<p>在数学中，矩阵只是向量概念的推广:向量被认为只有一个维度，而矩阵可以是任意数量的维度。</p>
<p>那么矩阵</p>
<p><span class="math display">\[
\begin{pmatrix}
1 &amp; 4 &amp; 7 \\
2 &amp; 5 &amp; 8 \\
3 &amp; 6 &amp; 9 \\
\end{pmatrix}
\]</span></p>
<p>是一个3(行) x 3(列)矩阵，包括了列向量<span class="math inline">\(\begin{pmatrix} 1 \\ 2 \\ 3 \\ \end{pmatrix}\)</span>，<span class="math inline">\(\begin{pmatrix} 4 \\ 5 \\ 6 \\ \end{pmatrix}\)</span>和<span class="math inline">\(\begin{pmatrix} 7 \\ 8 \\ 9 \\ \end{pmatrix}\)</span>。通常我们用<span class="math inline">\(i\)</span> x <span class="math inline">\(j\)</span>的形式表示矩阵，<span class="math inline">\(i\)</span>是行数，<span class="math inline">\(j\)</span>是列数。因此，一个3x2矩阵有3行2列，像这样：</p>
<p><span class="math display">\[
\begin{pmatrix}
a &amp; d \\
b &amp; e \\
c &amp; f \\
\end{pmatrix}
\]</span></p>
<p><strong>方阵</strong>是行数等于列数的矩阵。</p>
<p>你可以用<code>matrix()</code>函数在R中创建一个方阵，或者使用base R的 <code>cbind()</code>和<code>rbind()</code>将向量连接在一起，它们分别将向量按列和按行连接在一起。在控制台试试<code>cbina(1:3, 4:6, 7:9)</code>吧。</p>
</div>
<p>那么“正定”和“对称”是什么呢？这是对可以表示多元正态分布的这类矩阵的数学要求。换句话说，你提供的协方差矩阵必须表示一个合法的多元正态分布。在这点上，你真的不需要知道再多了。</p>
<iframe src="https://dalejbarr.github.io/bivariate/index.html" width="420" height="620" class="noborder">
</iframe>
<p>让我们从模拟假设的人类身高和体重的数据开始。我们知道这些是相关的。为了能够模拟数据，我们需要这两个变量的均值和标准差以及它们的相关性。</p>
<p>我找到了一些<a href="https://www.geogebra.org/m/RRprACv4">数据</a>并把它转换为CSV文件。如果你想跟上，可以下载这个文件<a href="data/heights_and_weights.csv" download="heights_and_weights.csv">heights_and_weights.csv</a>。这是散点图：</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="相关和回归.html#cb32-1" tabindex="-1"></a>handw <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/heights_and_weights.csv&quot;</span>, <span class="at">col_types =</span> <span class="st">&quot;dd&quot;</span>)</span>
<span id="cb32-2"><a href="相关和回归.html#cb32-2" tabindex="-1"></a></span>
<span id="cb32-3"><a href="相关和回归.html#cb32-3" tabindex="-1"></a><span class="fu">ggplot</span>(handw, <span class="fu">aes</span>(height_in, weight_lbs)) <span class="sc">+</span> </span>
<span id="cb32-4"><a href="相关和回归.html#cb32-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb32-5"><a href="相关和回归.html#cb32-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;height (inches)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;weight (pounds)&quot;</span>) </span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:heights-and-weights"></span>
<img src="02-%E7%9B%B8%E5%85%B3%E5%92%8C%E5%9B%9E%E5%BD%92_files/figure-html/heights-and-weights-1.png" alt="475人的身高和体重(包括婴儿)" width="672" />
<p class="caption">
图2.5: 475人的身高和体重(包括婴儿)
</p>
</div>
<p>这不是一个线性关系。我们可以先对每个变量进行对数(log)变换。</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="相关和回归.html#cb33-1" tabindex="-1"></a>handw_log <span class="ot">&lt;-</span> handw <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="相关和回归.html#cb33-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hlog =</span> <span class="fu">log</span>(height_in),</span>
<span id="cb33-3"><a href="相关和回归.html#cb33-3" tabindex="-1"></a>         <span class="at">wlog =</span> <span class="fu">log</span>(weight_lbs))</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:handw-log"></span>
<img src="02-%E7%9B%B8%E5%85%B3%E5%92%8C%E5%9B%9E%E5%BD%92_files/figure-html/handw-log-1.png" alt="对数变换后的身高和体重" width="672" />
<p class="caption">
图2.6: 对数变换后的身高和体重
</p>
</div>
<p>散点图右上侧尾部有一个大的点簇，这可能表示在这个样本中成年人比儿童更多，因为成年人更高和更重。</p>
<p>对数身高的均值是4.11 (SD = 0.26)，而对数体重的均值是4.74 (SD = 0.65)。对数身高和对数体重之间的相关性我们可以用<code>cor()</code>函数获得，高达0.96。</p>
<p>我们现在有了模拟500人身高和体重所需的所有信息。但我们如何将这些信息输入到<code>MASS::mvrnorm()</code>呢？我们知道函数调用的第一部分是<code>MASS::mvrnorm(500, c(4.11,4.74), ...)</code>，但<code>Sigma</code>——那个协方差矩阵呢？我们从上面知道<span class="math inline">\(\hat{\sigma}_x = 0.26\)</span>和<span class="math inline">\(\hat{\sigma}_y = 0.65\)</span>，以及<span class="math inline">\(\hat{\sigma}_y = 0.65\)</span>, and <span class="math inline">\(\hat{\rho}_{xy} = 0.96\)</span>。</p>
<p>表示二元数据<code>Sigma</code> (<span class="math inline">\(\mathbf{\Sigma}\)</span>)的协方差矩阵如下：</p>
<p><span class="math display">\[
\mathbf{\Sigma} =
\begin{pmatrix}
{\sigma_x}^2                &amp; \rho_{xy} \sigma_x \sigma_y \\
\rho_{yx} \sigma_y \sigma_x &amp; {\sigma_y}^2 \\
\end{pmatrix}
\]</span></p>
<p>方差（标准差的平方，<span class="math inline">\({\sigma_x}^2\)</span>和<span class="math inline">\({\sigma_y}^2\)</span>）位于对角线上，协方差(相关系数乘以两个标准差，<span class="math inline">\(\rho_{xy} \sigma_x \sigma_y\)</span>)位于非对角线上。记住协方差就是相关系数与两个标准差的积，这是很有用的。正如我们在上面的相关矩阵中看到的，表格中存在额外信息；也就是说，协方差同时出现在矩阵的右上角单元格和左下角单元格。</p>
<p>代入之前的值，协方差矩阵应该是：</p>
<p><span class="math display">\[
\begin{pmatrix}
.26^2 &amp; (.96)(.26)(.65) \\
(.96)(.65)(.26) &amp; .65^2 \\
\end{pmatrix} =
\begin{pmatrix}
.067 &amp; .162 \\
.162 &amp; .423 \\
\end{pmatrix}
\]</span></p>
<p>很好，那么我们如何在R中形成<code>Sigma</code>以便我们可以将它传递给<code>mvrnorm()</code>函数呢？我们将使用<code>matrix()</code>函数，如下所示。</p>
<p>首先，让我们定义协方差并将其存储在变量<code>my_cov</code>中。</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="相关和回归.html#cb34-1" tabindex="-1"></a>my_cov <span class="ot">&lt;-</span> .<span class="dv">96</span> <span class="sc">*</span> .<span class="dv">26</span> <span class="sc">*</span> .<span class="dv">65</span></span></code></pre></div>
<p>现在我们将使用<code>matrix()</code>来定义我们的<code>Sigma</code>为<code>my_Sigma</code>。</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="相关和回归.html#cb35-1" tabindex="-1"></a>my_Sigma <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(.<span class="dv">26</span><span class="sc">^</span><span class="dv">2</span>, my_cov, my_cov, .<span class="dv">65</span><span class="sc">^</span><span class="dv">2</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb35-2"><a href="相关和回归.html#cb35-2" tabindex="-1"></a>my_Sigma</span></code></pre></div>
<pre><code>##         [,1]    [,2]
## [1,] 0.06760 0.16224
## [2,] 0.16224 0.42250</code></pre>
<div class="bluebox">
<p><strong>对<code>matrix()</code>函数感到困惑吗?</strong></p>
<p>通过运行下面的代码，你可以发现<code>matrix()</code>是逐列填充矩阵元素，而不是逐行填充:</p>
<p><code>matrix(c("a", "b", "c", "d"), ncol = 2)</code></p>
<p>如果你想改变这种行为，将<code>byrow</code>参数设置为<code>TRUE</code>。</p>
<p><code>matrix(c("a", "b", "c", "d"), ncol = 2, byrow = TRUE)</code></p>
</div>
<p>太好了！现在我们得到了<code>my_Sigma</code>，我们已经准备好使用<code>MASS::mvrnorm()</code>了。让我们通过创建6个模拟的人的数据来测试一下。</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="相关和回归.html#cb37-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">62</span>) <span class="co"># 为了可重复性</span></span>
<span id="cb37-2"><a href="相关和回归.html#cb37-2" tabindex="-1"></a></span>
<span id="cb37-3"><a href="相关和回归.html#cb37-3" tabindex="-1"></a><span class="co"># 传递*命名的*向量c(height = 4.11, weight = 4.74)给mu可以在输出中得到列名</span></span>
<span id="cb37-4"><a href="相关和回归.html#cb37-4" tabindex="-1"></a>log_ht_wt <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="dv">6</span>, </span>
<span id="cb37-5"><a href="相关和回归.html#cb37-5" tabindex="-1"></a>                           <span class="fu">c</span>(<span class="at">height =</span> <span class="fl">4.11</span>, <span class="at">weight =</span> <span class="fl">4.74</span>), </span>
<span id="cb37-6"><a href="相关和回归.html#cb37-6" tabindex="-1"></a>                           my_Sigma)</span>
<span id="cb37-7"><a href="相关和回归.html#cb37-7" tabindex="-1"></a></span>
<span id="cb37-8"><a href="相关和回归.html#cb37-8" tabindex="-1"></a>log_ht_wt</span></code></pre></div>
<pre><code>##        height   weight
## [1,] 4.254209 5.282913
## [2,] 4.257828 4.895222
## [3,] 3.722376 3.759767
## [4,] 4.191287 4.764229
## [5,] 4.739967 6.185191
## [6,] 4.058105 4.806485</code></pre>
<p>那么<code>MASS::mvrnorm()</code>会返回一个矩阵，每个模拟的人对应一行，其中第一列表示对数身高，第二列表示对数体重。但是对数身高和对数体重对我们来说并不是很有用，所以让我们使用<code>exp()</code>函数来进行转换，它是<code>log()</code>转换的逆操作。</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="相关和回归.html#cb39-1" tabindex="-1"></a><span class="fu">exp</span>(log_ht_wt)</span></code></pre></div>
<pre><code>##         height    weight
## [1,]  70.40108 196.94276
## [2,]  70.65632 133.64963
## [3,]  41.36254  42.93844
## [4,]  66.10779 117.24065
## [5,] 114.43045 485.50576
## [6,]  57.86453 122.30092</code></pre>
<p>那么我们第一个模拟的人的身高是70.4英寸(大约是5’5”或者178.816 cm)，体重是196.94磅(约89.32 kg)。听起来感觉不错吧！(还是要注意，它会生成超出我们原始数据范围的观测值：我们会得到超高的人，例如第5个观测值，但至少体重/身高的关系会被保留)。</p>
<p>好的，让我们随机生成一群人的数据，将它们从对数转换为英寸和磅，然后将它们与我们的原始数据进行比较，看看效果如何。</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="相关和回归.html#cb41-1" tabindex="-1"></a><span class="do">## 模拟新的人</span></span>
<span id="cb41-2"><a href="相关和回归.html#cb41-2" tabindex="-1"></a>new_humans <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(<span class="dv">500</span>, </span>
<span id="cb41-3"><a href="相关和回归.html#cb41-3" tabindex="-1"></a>                            <span class="fu">c</span>(<span class="at">height_in =</span> <span class="fl">4.11</span>, <span class="at">weight_lbs =</span> <span class="fl">4.74</span>),</span>
<span id="cb41-4"><a href="相关和回归.html#cb41-4" tabindex="-1"></a>                            my_Sigma) <span class="sc">%&gt;%</span></span>
<span id="cb41-5"><a href="相关和回归.html#cb41-5" tabindex="-1"></a>  <span class="fu">exp</span>() <span class="sc">%&gt;%</span> <span class="co"># 从对数转换回英寸和磅</span></span>
<span id="cb41-6"><a href="相关和回归.html#cb41-6" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> <span class="co"># 为绘图转换为tibble格式</span></span>
<span id="cb41-7"><a href="相关和回归.html#cb41-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;simulated&quot;</span>) <span class="co"># 将他们标记为模拟(simulated)</span></span>
<span id="cb41-8"><a href="相关和回归.html#cb41-8" tabindex="-1"></a></span>
<span id="cb41-9"><a href="相关和回归.html#cb41-9" tabindex="-1"></a><span class="do">## 合并真实和模拟的数据集，其中handw是来自heights_and_weights.csv的变量</span></span>
<span id="cb41-10"><a href="相关和回归.html#cb41-10" tabindex="-1"></a>alldata <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(handw <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">type =</span> <span class="st">&quot;real&quot;</span>), </span>
<span id="cb41-11"><a href="相关和回归.html#cb41-11" tabindex="-1"></a>                     new_humans)</span>
<span id="cb41-12"><a href="相关和回归.html#cb41-12" tabindex="-1"></a></span>
<span id="cb41-13"><a href="相关和回归.html#cb41-13" tabindex="-1"></a><span class="fu">ggplot</span>(alldata, <span class="fu">aes</span>(height_in, weight_lbs)) <span class="sc">+</span></span>
<span id="cb41-14"><a href="相关和回归.html#cb41-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> type), <span class="at">alpha =</span> .<span class="dv">1</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:plot-together"></span>
<img src="02-%E7%9B%B8%E5%85%B3%E5%92%8C%E5%9B%9E%E5%BD%92_files/figure-html/plot-together-1.png" alt="真实和模拟的人" width="672" />
<p class="caption">
图2.7: 真实和模拟的人
</p>
</div>
<p>你可以看到，我们模拟的人与正常的人非常相似，只是我们创建了一些身高和体重超出正常范围的人。</p>
</div>
<div id="相关和回归的关系" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> 相关和回归的关系<a href="相关和回归.html#相关和回归的关系" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>好的，我们知道如何估计相关了，但如果我们想要根据身高来预测体重该怎么办呢？这可能听起来像一个不切实际的问题。但事实上，在使用或进行安全性取决于患者体重的药物或程序，但没时间称量患者体重时，<a href="https://link.springer.com/article/10.1186/s12245-018-0212-9">急救医护人员可以使用这种技术，在紧急情况下迅速估算人们的体重</a>。</p>
<p>回忆一下，简单回归模型的GLM是：</p>
<p><span class="math display">\[Y_i = \beta_0 + \beta_1 X_i + e_i.\]</span></p>
<p>在这里，我们尝试根据他们观测到的身高(<span class="math inline">\(X_i\)</span>)来预测体重(<span class="math inline">\(Y_i\)</span>)。在这个方程里，<span class="math inline">\(\beta_0\)</span>和<span class="math inline">\(\beta_1\)</span>分别是y轴截距和斜率的参数，<span class="math inline">\(e_i\)</span>是残差。传统上假设<span class="math inline">\(e_i\)</span>的值来自均值为0、方差为<span class="math inline">\(\sigma^2\)</span>的正态分布；数学上的表述是<span class="math inline">\(e_i \sim N(0, \sigma^2)\)</span>，其中<span class="math inline">\(\sim\)</span>表示“按照分布”，<span class="math inline">\(N(0, \sigma^2)\)</span>表示“均值为0、方差为<span class="math inline">\(\sigma^2\)</span>的正态分布(<span class="math inline">\(N\)</span>)”。</p>
<p>这表明如果我们有X和Y的均值估计值(分别标记为<span class="math inline">\(\mu_x\)</span>和<span class="math inline">\(\mu_y\)</span>)、标准差估计值(<span class="math inline">\(\hat{\sigma}_x\)</span>和<span class="math inline">\(\hat{\sigma}_y\)</span>)、X和Y之间相关系数的估计值(<span class="math inline">\(\hat{\rho}\)</span>)，我们就有了估计回归方程参数<span class="math inline">\(\beta_0\)</span>和<span class="math inline">\(\beta_1\)</span>所需要的所有信息。下面是具体做法。(译者注：这里的估计值是指根据样本信息来估计总体情况的估计值，是总体的估计值、样本的观测值)</p>
<p>首先，回归线的斜率<span class="math inline">\(\beta_1\)</span>等于相关系数<span class="math inline">\(\rho\)</span>乘以<span class="math inline">\(Y\)</span>和<span class="math inline">\(X\)</span>的标准差之比。</p>
<p><span class="math display">\[\beta_1 = \rho \frac{\sigma_Y}{\sigma_X}\]</span></p>
<p>根据上面对数身高和对数体重的估计值，你能算出<span class="math inline">\(\beta_1\)</span>吗?</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="相关和回归.html#cb42-1" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> .<span class="dv">96</span> <span class="sc">*</span> (.<span class="dv">65</span> <span class="sc">/</span> .<span class="dv">26</span>)</span>
<span id="cb42-2"><a href="相关和回归.html#cb42-2" tabindex="-1"></a>b1</span></code></pre></div>
<pre><code>## [1] 2.4</code></pre>
<p>下一个要注意的点是，基于数学原理，回归线必须通过与<span class="math inline">\(X\)</span>和<span class="math inline">\(Y\)</span>均值对应的点，即点<span class="math inline">\((\mu_x, \mu_y)\)</span>(你可以想象回归线根据斜率围绕该点“旋转”)。你也知道<span class="math inline">\(\beta_0\)</span>是y轴截距，即在<span class="math inline">\(X = 0\)</span>处与纵轴相交的点。根据这些信息和上面的估计值，你能推断出<span class="math inline">\(\beta_0\)</span>的值吗？</p>
<p>下面是你求解<span class="math inline">\(\beta_0\)</span>的推理过程。</p>
<p>想象一下，从<span class="math inline">\(X = \mu_x\)</span>逐步一个一个单位后退到<span class="math inline">\(X = 0\)</span>。在<span class="math inline">\(X = \mu_x\)</span>处，<span class="math inline">\(Y = 4.74\)</span>，每在X轴后退一个单位，<span class="math inline">\(Y\)</span>将下降<span class="math inline">\(\beta_1 = 2.4\)</span>个单位。当你到0时，<span class="math inline">\(Y\)</span>将从<span class="math inline">\(\mu_y\)</span>下降到<span class="math inline">\(\mu_y - \mu_x \beta_1\)</span>。</p>
<p>因此通解是：<span class="math inline">\(\beta_0 = \mu_y - \mu_x\beta_1\)</span>。</p>
<p>因为<span class="math inline">\(\beta_1 = 2.4\)</span>、<span class="math inline">\(\mu_x = 4.11\)</span>、<span class="math inline">\(\mu_y = 4.74\)</span>，所以<span class="math inline">\(\beta_0 = -5.124\)</span>。因此，我们的回归方程是：</p>
<p><span class="math display">\[Y_i =  -5.124 + 2.4X_i + e_i.\]</span></p>
<p>为了验证我们的结果，我们先对对数转换后的数据进行回归，使用<code>lm()</code>函数，它采用最小二乘法(ordinary least squares regression)来估计参数。</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="相关和回归.html#cb44-1" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(wlog <span class="sc">~</span> hlog, handw_log))</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = wlog ~ hlog, data = handw_log)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.63296 -0.09915 -0.01366  0.09285  0.65635 
## 
## Coefficients:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept) -5.26977    0.13169  -40.02   &lt;2e-16 ***
## hlog         2.43304    0.03194   76.17   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.1774 on 473 degrees of freedom
## Multiple R-squared:  0.9246, Adjusted R-squared:  0.9245 
## F-statistic:  5802 on 1 and 473 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>看起来非常接近。不完全匹配的原因仅仅是我们将估计值四舍五入到小数点后两位以方便计算。</p>
<p>作为另一个检查，让我们将手动计算的回归线叠加在对数转换后数据的散点图上。</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="相关和回归.html#cb46-1" tabindex="-1"></a><span class="fu">ggplot</span>(handw_log, <span class="fu">aes</span>(hlog, wlog)) <span class="sc">+</span></span>
<span id="cb46-2"><a href="相关和回归.html#cb46-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> .<span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb46-3"><a href="相关和回归.html#cb46-3" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;log(height)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;log(weight)&quot;</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="相关和回归.html#cb46-4" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="sc">-</span><span class="fl">5.124</span>, <span class="at">slope =</span> <span class="fl">2.4</span>, <span class="at">colour =</span> <span class="st">&#39;blue&#39;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:scatter-with-line"></span>
<img src="02-%E7%9B%B8%E5%85%B3%E5%92%8C%E5%9B%9E%E5%BD%92_files/figure-html/scatter-with-line-1.png" alt="对数值和叠加的回归线" width="672" />
<p class="caption">
图2.8: 对数值和叠加的回归线
</p>
</div>
<p>看起来是对的。</p>
<p>最后，以下是相关性和回归之间关系的一些影响：</p>
<ul>
<li>当<span class="math inline">\(\beta_1 = 0\)</span>时，与<span class="math inline">\(\rho = 0\)</span>相同。</li>
<li>当<span class="math inline">\(\beta_1 &gt; 0\)</span>时， <span class="math inline">\(\rho &gt; 0\)</span>，因为标准差不能为负。</li>
<li>当<span class="math inline">\(\beta_1 &lt; 0\)</span>时， <span class="math inline">\(\rho &lt; 0\)</span>，原因同上。</li>
<li>拒绝零假设<span class="math inline">\(\beta_1 = 0\)</span>与拒绝零假设<span class="math inline">\(\rho = 0\)</span>是相同的。在<code>lm()</code>中得到的<span class="math inline">\(\beta_1\)</span>的p值与使用<code>cor.test()</code>得到的<span class="math inline">\(\rho\)</span>的p值相同。</li>
</ul>
</div>
<div id="练习" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> 练习<a href="相关和回归.html#练习" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<iframe src="https://rstudio-connect.psy.gla.ac.uk/covariance/?showcase=0" width="530px" height="480px" data-external="1">
</iframe>

</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("webex-total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("webex-correct").length + " of " +
      document.getElementsByClassName("webex-solveme").length + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }

  update_total_correct();
}

</script>
<script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );
});
</script>

            </section>

          </div>
        </div>
      </div>
<a href="前言.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="多元回归.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CBook.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
