<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7 交叉随机因子线性混合效应模型 | 学习统计模型——通过R模拟</title>
  <meta name="description" content="7 交叉随机因子线性混合效应模型 | 学习统计模型——通过R模拟" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="7 交叉随机因子线性混合效应模型 | 学习统计模型——通过R模拟" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7 交叉随机因子线性混合效应模型 | 学习统计模型——通过R模拟" />
  
  
  

<meta name="author" content="周博霖" />


<meta name="date" content="2024-06-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="单随机因子线性混合效应模型.html"/>
<link rel="next" href="广义线性混合效应模型.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX","output/SVG"],
  extensions: ["tex2jax.js","MathMenu.js","MathZoom.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
  }
});
</script>
<script type="text/javascript"
   src="../../../MathJax/MathJax.js">
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>概述</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#译者按"><i class="fa fa-check"></i>译者按</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#如何引用本书"><i class="fa fa-check"></i>如何引用本书</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#发现问题"><i class="fa fa-check"></i>发现问题？</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#教育者需知"><i class="fa fa-check"></i>教育者需知</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="前言.html"><a href="前言.html"><i class="fa fa-check"></i><b>1</b> 前言</a>
<ul>
<li class="chapter" data-level="1.1" data-path="前言.html"><a href="前言.html#课程目的"><i class="fa fa-check"></i><b>1.1</b> 课程目的</a></li>
<li class="chapter" data-level="1.2" data-path="前言.html"><a href="前言.html#广义线性混合效应模型generalized-linear-mixed-effects-models-glmms"><i class="fa fa-check"></i><b>1.2</b> 广义线性混合效应模型(Generalized Linear Mixed-Effects Models, GLMMs)</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="前言.html"><a href="前言.html#线性模型"><i class="fa fa-check"></i><b>1.2.1</b> 线性模型</a></li>
<li class="chapter" data-level="1.2.2" data-path="前言.html"><a href="前言.html#混合模型"><i class="fa fa-check"></i><b>1.2.2</b> 混合模型</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="前言.html"><a href="前言.html#关于可重复性的说明"><i class="fa fa-check"></i><b>1.3</b> 关于可重复性的说明</a></li>
<li class="chapter" data-level="1.4" data-path="前言.html"><a href="前言.html#基于模拟的方法"><i class="fa fa-check"></i><b>1.4</b> 基于模拟的方法</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="相关和回归.html"><a href="相关和回归.html"><i class="fa fa-check"></i><b>2</b> 相关和回归</a>
<ul>
<li class="chapter" data-level="2.1" data-path="相关和回归.html"><a href="相关和回归.html#相关矩阵correlation-matrices"><i class="fa fa-check"></i><b>2.1</b> 相关矩阵(Correlation matrices)</a></li>
<li class="chapter" data-level="2.2" data-path="相关和回归.html"><a href="相关和回归.html#模拟二元数据"><i class="fa fa-check"></i><b>2.2</b> 模拟二元数据</a></li>
<li class="chapter" data-level="2.3" data-path="相关和回归.html"><a href="相关和回归.html#相关和回归的关系"><i class="fa fa-check"></i><b>2.3</b> 相关和回归的关系</a></li>
<li class="chapter" data-level="2.4" data-path="相关和回归.html"><a href="相关和回归.html#练习"><i class="fa fa-check"></i><b>2.4</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="多元回归.html"><a href="多元回归.html"><i class="fa fa-check"></i><b>3</b> 多元回归</a>
<ul>
<li class="chapter" data-level="3.1" data-path="多元回归.html"><a href="多元回归.html#一个例子如何在统计学上取得好成绩"><i class="fa fa-check"></i><b>3.1</b> 一个例子：如何在统计学上取得好成绩</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="多元回归.html"><a href="多元回归.html#数据导入和可视化"><i class="fa fa-check"></i><b>3.1.1</b> 数据导入和可视化</a></li>
<li class="chapter" data-level="3.1.2" data-path="多元回归.html"><a href="多元回归.html#估计和解释"><i class="fa fa-check"></i><b>3.1.2</b> 估计和解释</a></li>
<li class="chapter" data-level="3.1.3" data-path="多元回归.html"><a href="多元回归.html#使用predict通过线性模型进行预测"><i class="fa fa-check"></i><b>3.1.3</b> 使用<code>predict()</code>通过线性模型进行预测</a></li>
<li class="chapter" data-level="3.1.4" data-path="多元回归.html"><a href="多元回归.html#偏效应可视化"><i class="fa fa-check"></i><b>3.1.4</b> 偏效应可视化</a></li>
<li class="chapter" data-level="3.1.5" data-path="多元回归.html"><a href="多元回归.html#标准化系数"><i class="fa fa-check"></i><b>3.1.5</b> 标准化系数</a></li>
<li class="chapter" data-level="3.1.6" data-path="多元回归.html"><a href="多元回归.html#模型比较"><i class="fa fa-check"></i><b>3.1.6</b> 模型比较</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="多元回归.html"><a href="多元回归.html#处理分类预测变量"><i class="fa fa-check"></i><b>3.2</b> 处理分类预测变量</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="多元回归.html"><a href="多元回归.html#虚拟编码又称处理编码"><i class="fa fa-check"></i><b>3.2.1</b> 虚拟编码(又称“处理”编码)</a></li>
<li class="chapter" data-level="3.2.2" data-path="多元回归.html"><a href="多元回归.html#当k-2时的虚拟编码"><i class="fa fa-check"></i><b>3.2.2</b> 当<span class="math inline">\(k &gt; 2\)</span>时的虚拟编码</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="多元回归.html"><a href="多元回归.html#多元回归和单因素方差分析one-way-anova的等价性"><i class="fa fa-check"></i><b>3.3</b> 多元回归和单因素方差分析(one-way ANOVA)的等价性</a></li>
<li class="chapter" data-level="3.4" data-path="多元回归.html"><a href="多元回归.html#练习答案"><i class="fa fa-check"></i><b>3.4</b> 练习答案</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="交互效应.html"><a href="交互效应.html"><i class="fa fa-check"></i><b>4</b> 交互效应</a>
<ul>
<li class="chapter" data-level="4.1" data-path="交互效应.html"><a href="交互效应.html#cont-by-cat"><i class="fa fa-check"></i><b>4.1</b> 连续变量-分类变量交互效应</a></li>
<li class="chapter" data-level="4.2" data-path="交互效应.html"><a href="交互效应.html#分类变量-分类变量交互效应"><i class="fa fa-check"></i><b>4.2</b> 分类变量-分类变量交互效应</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="交互效应.html"><a href="交互效应.html#认知治疗与药物治疗对情绪的影响"><i class="fa fa-check"></i><b>4.2.1</b> 认知治疗与药物治疗对情绪的影响</a></li>
<li class="chapter" data-level="4.2.2" data-path="交互效应.html"><a href="交互效应.html#因子设计中的效应"><i class="fa fa-check"></i><b>4.2.2</b> 因子设计中的效应</a></li>
<li class="chapter" data-level="4.2.3" data-path="交互效应.html"><a href="交互效应.html#高阶设计higher-order-designs"><i class="fa fa-check"></i><b>4.2.3</b> 高阶设计(Higher-order designs)</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="交互效应.html"><a href="交互效应.html#用于因子设计的glm"><i class="fa fa-check"></i><b>4.3</b> 用于因子设计的GLM</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="交互效应.html"><a href="交互效应.html#估计方程estimation-equations"><i class="fa fa-check"></i><b>4.3.1</b> 估计方程(estimation equations)</a></li>
<li class="chapter" data-level="4.3.2" data-path="交互效应.html"><a href="交互效应.html#因子设计app"><i class="fa fa-check"></i><b>4.3.2</b> 因子设计App</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="交互效应.html"><a href="交互效应.html#在因子设计中对分类预测因子进行编码"><i class="fa fa-check"></i><b>4.4</b> 在因子设计中对分类预测因子进行编码</a></li>
<li class="chapter" data-level="4.5" data-path="交互效应.html"><a href="交互效应.html#分类变量的编码方案"><i class="fa fa-check"></i><b>4.5</b> 分类变量的编码方案</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="交互效应.html"><a href="交互效应.html#简单效应-vs.-主效应"><i class="fa fa-check"></i><b>4.5.1</b> 简单效应 vs. 主效应</a></li>
<li class="chapter" data-level="4.5.2" data-path="交互效应.html"><a href="交互效应.html#主要编码方案"><i class="fa fa-check"></i><b>4.5.2</b> 主要编码方案</a></li>
<li class="chapter" data-level="4.5.3" data-path="交互效应.html"><a href="交互效应.html#超过2水平的因子呢"><i class="fa fa-check"></i><b>4.5.3</b> 超过2水平的因子呢？</a></li>
<li class="chapter" data-level="4.5.4" data-path="交互效应.html"><a href="交互效应.html#举例3水平因子"><i class="fa fa-check"></i><b>4.5.4</b> 举例：3水平因子</a></li>
<li class="chapter" data-level="4.5.5" data-path="交互效应.html"><a href="交互效应.html#如何创建你自己的数值型预测变量"><i class="fa fa-check"></i><b>4.5.5</b> 如何创建你自己的数值型预测变量</a></li>
<li class="chapter" data-level="4.5.6" data-path="交互效应.html"><a href="交互效应.html#小结"><i class="fa fa-check"></i><b>4.5.6</b> 小结</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html"><i class="fa fa-check"></i><b>5</b> 介绍线性混合效应模型</a>
<ul>
<li class="chapter" data-level="5.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#多层数据建模"><i class="fa fa-check"></i><b>5.1</b> 多层数据建模</a></li>
<li class="chapter" data-level="5.2" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#如何对这些数据进行建模"><i class="fa fa-check"></i><b>5.2</b> 如何对这些数据进行建模</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#完全混合一刀切"><i class="fa fa-check"></i><b>5.2.1</b> 完全混合：一刀切</a></li>
<li class="chapter" data-level="5.2.2" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#不混合"><i class="fa fa-check"></i><b>5.2.2</b> 不混合</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#使用混合效果模型的部分混合"><i class="fa fa-check"></i><b>5.3</b> 使用混合效果模型的部分混合</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#方差-协方差矩阵"><i class="fa fa-check"></i><b>5.3.1</b> 方差-协方差矩阵</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#估计模型参数"><i class="fa fa-check"></i><b>5.4</b> 估计模型参数</a></li>
<li class="chapter" data-level="5.5" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#解释lmer输出结果并提取估计值"><i class="fa fa-check"></i><b>5.5</b> 解释<code>lmer()</code>输出结果并提取估计值</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#固定效应"><i class="fa fa-check"></i><b>5.5.1</b> 固定效应</a></li>
<li class="chapter" data-level="5.5.2" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#随机效应"><i class="fa fa-check"></i><b>5.5.2</b> 随机效应</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="介绍线性混合效应模型.html"><a href="介绍线性混合效应模型.html#多层app"><i class="fa fa-check"></i><b>5.6</b> 多层app</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html"><i class="fa fa-check"></i><b>6</b> 单随机因子线性混合效应模型</a>
<ul>
<li class="chapter" data-level="6.1" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#什么时候为什么你想用线性混合效应建模取代传统的分析"><i class="fa fa-check"></i><b>6.1</b> 什么时候，为什么，你想用线性混合效应建模取代传统的分析?</a></li>
<li class="chapter" data-level="6.2" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#示例多层数据上的独立样本t检验"><i class="fa fa-check"></i><b>6.2</b> 示例：多层数据上的独立样本<span class="math inline">\(t\)</span>检验</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#什么时候使用随机截距模型是合适的"><i class="fa fa-check"></i><b>6.2.1</b> 什么时候使用随机截距模型是合适的?</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#用回归表达研究设计和进行检验"><i class="fa fa-check"></i><b>6.3</b> 用回归表达研究设计和进行检验</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#水平以上的因子"><i class="fa fa-check"></i><b>6.3.1</b> 2水平以上的因子</a></li>
<li class="chapter" data-level="6.3.2" data-path="单随机因子线性混合效应模型.html"><a href="单随机因子线性混合效应模型.html#多参数检验"><i class="fa fa-check"></i><b>6.3.2</b> 多参数检验</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html"><i class="fa fa-check"></i><b>7</b> 交叉随机因子线性混合效应模型</a>
<ul>
<li class="chapter" data-level="7.1" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#概括被试和刺激的组合"><i class="fa fa-check"></i><b>7.1</b> 概括被试和刺激的组合</a></li>
<li class="chapter" data-level="7.2" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#lme4语法用于交叉随机因子"><i class="fa fa-check"></i><b>7.2</b> lme4语法用于交叉随机因子</a></li>
<li class="chapter" data-level="7.3" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#指定随机效应"><i class="fa fa-check"></i><b>7.3</b> 指定随机效应</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#为分类因子选择随机效应的规则"><i class="fa fa-check"></i><b>7.3.1</b> 为分类因子选择随机效应的规则</a></li>
<li class="chapter" data-level="7.3.2" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#排除不收敛和畸形拟合singular-fit"><i class="fa fa-check"></i><b>7.3.2</b> 排除不收敛和“畸形拟合(singular fit)”</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#模拟交叉随机因子的数据"><i class="fa fa-check"></i><b>7.4</b> 模拟交叉随机因子的数据</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#设置环境并定义dgp的参数"><i class="fa fa-check"></i><b>7.4.1</b> 设置环境并定义DGP的参数</a></li>
<li class="chapter" data-level="7.4.2" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#生成刺激样本"><i class="fa fa-check"></i><b>7.4.2</b> 生成刺激样本</a></li>
<li class="chapter" data-level="7.4.3" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#生成被试样本"><i class="fa fa-check"></i><b>7.4.3</b> 生成被试样本</a></li>
<li class="chapter" data-level="7.4.4" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#生产试次样本"><i class="fa fa-check"></i><b>7.4.4</b> 生产试次样本</a></li>
<li class="chapter" data-level="7.4.5" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#合并subjectsitems和trials"><i class="fa fa-check"></i><b>7.4.5</b> 合并<code>subjects</code>，<code>items</code>和<code>trials</code></a></li>
<li class="chapter" data-level="7.4.6" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#创建响应变量"><i class="fa fa-check"></i><b>7.4.6</b> 创建响应变量</a></li>
<li class="chapter" data-level="7.4.7" data-path="交叉随机因子线性混合效应模型.html"><a href="交叉随机因子线性混合效应模型.html#拟合模型"><i class="fa fa-check"></i><b>7.4.7</b> 拟合模型</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="广义线性混合效应模型.html"><a href="广义线性混合效应模型.html"><i class="fa fa-check"></i><b>8</b> 广义线性混合效应模型</a>
<ul>
<li class="chapter" data-level="8.1" data-path="广义线性混合效应模型.html"><a href="广义线性混合效应模型.html#离散discrete数据-vs.-连续continuous数据"><i class="fa fa-check"></i><b>8.1</b> 离散(discrete)数据 vs. 连续(continuous)数据</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="广义线性混合效应模型.html"><a href="广义线性混合效应模型.html#为什么不将离散数据建模为连续数据"><i class="fa fa-check"></i><b>8.1.1</b> 为什么不将离散数据建模为连续数据？</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="广义线性混合效应模型.html"><a href="广义线性混合效应模型.html#广义线性模型"><i class="fa fa-check"></i><b>8.2</b> 广义线性模型</a></li>
<li class="chapter" data-level="8.3" data-path="广义线性混合效应模型.html"><a href="广义线性混合效应模型.html#逻辑回归"><i class="fa fa-check"></i><b>8.3</b> 逻辑回归</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="广义线性混合效应模型.html"><a href="广义线性混合效应模型.html#术语"><i class="fa fa-check"></i><b>8.3.1</b> 术语</a></li>
<li class="chapter" data-level="8.3.2" data-path="广义线性混合效应模型.html"><a href="广义线性混合效应模型.html#log-odds的性质"><i class="fa fa-check"></i><b>8.3.2</b> log odds的性质</a></li>
<li class="chapter" data-level="8.3.3" data-path="广义线性混合效应模型.html"><a href="广义线性混合效应模型.html#链接函数和方差函数"><i class="fa fa-check"></i><b>8.3.3</b> 链接函数和方差函数</a></li>
<li class="chapter" data-level="8.3.4" data-path="广义线性混合效应模型.html"><a href="广义线性混合效应模型.html#在r中估计逻辑回归模型"><i class="fa fa-check"></i><b>8.3.4</b> 在R中估计逻辑回归模型</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="参考文献.html"><a href="参考文献.html"><i class="fa fa-check"></i>参考文献</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">学习统计模型——通过R模拟</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="交叉随机因子线性混合效应模型" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">7</span> 交叉随机因子线性混合效应模型<a href="交叉随机因子线性混合效应模型.html#交叉随机因子线性混合效应模型" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="概括被试和刺激的组合" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> 概括被试和刺激的组合<a href="交叉随机因子线性混合效应模型.html#概括被试和刺激的组合" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>心理学实验的一个常见目标是检验关于在特定类型的刺激下行为发生的主张(有时是关于该行为神经基础的结论)。这些刺激可能是单词、图像、声音、视频或故事。你可能想检验的主张的一些例子包括：</p>
<ul>
<li>在听第二语言的单词时，双语者是否会受到母语单词的干扰？</li>
<li>人们在心情好的时候和心情不好的时候对面孔的吸引力评分是否不同？</li>
<li>相对于更中性的图像，观看舒适的图像是否有助于减轻压力?</li>
<li>在阅读模糊描述目标个体的场景时，被潜意识启动后，人们是否更有可能对目标所属的社会群体做出假设?</li>
</ul>
<p>关于所有这些主张需要注意的一点是，它们的形式都是：“当类型为X的个体遇到类型为Y的刺激时，我们的测量结果会发生什么变化”，其中X是从目标被试的总体中抽取的，Y是从目标刺激的总体中抽取的。换句话说，我们试图对涉及被试和刺激的采样单元<strong>相遇</strong>产生的特定类别的<strong>事件</strong>做出可推广的主张<span class="citation">(<a href="#ref-Barr_2017">Barr, 2017</a>)</span>。但就像我们不能从目标被试的总体中采样所有可能的被试一样，我们也不能从目标刺激的总体中采样所有可能的刺激。因此，在做推断时，我们需要考虑由<em>两种</em>采样过程引入的估计不确定性<span class="citation">(<a href="#ref-Clark_1973">Clark, 1973</a>; <a href="#ref-Coleman_1964">Coleman, 1964</a>; <a href="#ref-Judd_Westfall_Kenny_2012">Judd et al., 2012</a>; <a href="#ref-yarkoni_2019">Yarkoni, 2019</a>)</span>。线性混合效应模型通过允许我们的模型公式中有多个随机因子而特别容易做到这一点<span class="citation">(<a href="#ref-Baayen_Davidson_Bates_2008">Baayen et al., 2008</a>)</span>。</p>
<p>这里有一个简单的例子，你感兴趣的是检验人们是否认为猫、狗或日落的图片看起来更舒适。你想对猫、狗和日落这类图片做出一般性陈述，而不是关于你碰巧采样的具体图片。假设你从Google图片中随机为每类选取4张图片(你绝对需要更多的图片才能做出一般性陈述，但我们选择少量图片以使示例简单)。因此，你的刺激表可能如下所示：</p>
<table>
<thead>
<tr class="header">
<th align="right">stimulus_id</th>
<th align="left">category</th>
<th align="left">file</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">cat</td>
<td align="left">cat1.jpg</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">cat</td>
<td align="left">cat2.jpg</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">cat</td>
<td align="left">cat3.jpg</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">cat</td>
<td align="left">cat4.jpg</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">dog</td>
<td align="left">dog1.jpg</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">dog</td>
<td align="left">dog2.jpg</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="left">dog</td>
<td align="left">dog3.jpg</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="left">dog</td>
<td align="left">dog4.jpg</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="left">sunset</td>
<td align="left">sunset1.jpg</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="left">sunset</td>
<td align="left">sunset2.jpg</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">sunset</td>
<td align="left">sunset3.jpg</td>
</tr>
<tr class="even">
<td align="right">12</td>
<td align="left">sunset</td>
<td align="left">sunset4.jpg</td>
</tr>
</tbody>
</table>
<p>然后你抽取了4个被试来进行舒适度评分。再次强调，4个被试对于真实研究来说太少了，但为了便于解释我们保持数据量很小。</p>
<table>
<thead>
<tr class="header">
<th align="right">subject_id</th>
<th align="right">age</th>
<th align="left">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">38</td>
<td align="left">2020-05-04</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">42</td>
<td align="left">2020-05-17</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">46</td>
<td align="left">2020-05-19</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">41</td>
<td align="left">2020-05-26</td>
</tr>
</tbody>
</table>
<p>现在，因为每个受试者对每张图片都进行了“舒适度”评分，所以你会有一个完整的数据集，包含所有的<code>subject_id</code>和<code>stimulus_id</code>组合。这就是我们所说的“交叉随机因子”。你可以使用<code>tidyr</code>(加载<code>tidyverse</code>时会一起加载)中的<code>crossing()</code>函数来创建包含所有这些组合的表。</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="交叉随机因子线性混合效应模型.html#cb200-1" tabindex="-1"></a><span class="fu">crossing</span>(subjects <span class="sc">%&gt;%</span> <span class="fu">select</span>(subject_id),</span>
<span id="cb200-2"><a href="交叉随机因子线性混合效应模型.html#cb200-2" tabindex="-1"></a>         stimuli <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>category)) </span></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">subject_id</th>
<th align="right">stimulus_id</th>
<th align="left">file</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="left">cat1.jpg</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="left">cat2.jpg</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">3</td>
<td align="left">cat3.jpg</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">4</td>
<td align="left">cat4.jpg</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">5</td>
<td align="left">dog1.jpg</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">6</td>
<td align="left">dog2.jpg</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">7</td>
<td align="left">dog3.jpg</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">8</td>
<td align="left">dog4.jpg</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">9</td>
<td align="left">sunset1.jpg</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">10</td>
<td align="left">sunset2.jpg</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">11</td>
<td align="left">sunset3.jpg</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">12</td>
<td align="left">sunset4.jpg</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">1</td>
<td align="left">cat1.jpg</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">2</td>
<td align="left">cat2.jpg</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">3</td>
<td align="left">cat3.jpg</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">4</td>
<td align="left">cat4.jpg</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">5</td>
<td align="left">dog1.jpg</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">6</td>
<td align="left">dog2.jpg</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">7</td>
<td align="left">dog3.jpg</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">8</td>
<td align="left">dog4.jpg</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">9</td>
<td align="left">sunset1.jpg</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">10</td>
<td align="left">sunset2.jpg</td>
</tr>
<tr class="odd">
<td align="right">2</td>
<td align="right">11</td>
<td align="left">sunset3.jpg</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">12</td>
<td align="left">sunset4.jpg</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">1</td>
<td align="left">cat1.jpg</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">2</td>
<td align="left">cat2.jpg</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">3</td>
<td align="left">cat3.jpg</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">4</td>
<td align="left">cat4.jpg</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">5</td>
<td align="left">dog1.jpg</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">6</td>
<td align="left">dog2.jpg</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">7</td>
<td align="left">dog3.jpg</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">8</td>
<td align="left">dog4.jpg</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">9</td>
<td align="left">sunset1.jpg</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">10</td>
<td align="left">sunset2.jpg</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">11</td>
<td align="left">sunset3.jpg</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="right">12</td>
<td align="left">sunset4.jpg</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">1</td>
<td align="left">cat1.jpg</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">2</td>
<td align="left">cat2.jpg</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">3</td>
<td align="left">cat3.jpg</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">4</td>
<td align="left">cat4.jpg</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">5</td>
<td align="left">dog1.jpg</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">6</td>
<td align="left">dog2.jpg</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">7</td>
<td align="left">dog3.jpg</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">8</td>
<td align="left">dog4.jpg</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">9</td>
<td align="left">sunset1.jpg</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">10</td>
<td align="left">sunset2.jpg</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="right">11</td>
<td align="left">sunset3.jpg</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">12</td>
<td align="left">sunset4.jpg</td>
</tr>
</tbody>
</table>
<p>因为4个被试对12个刺激做出反应，所以结果表将有48行。</p>
</div>
<div id="lme4语法用于交叉随机因子" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> lme4语法用于交叉随机因子<a href="交叉随机因子线性混合效应模型.html#lme4语法用于交叉随机因子" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>如何分析这样的数据呢？回忆上一个章节中提到的，在lme4中，表示被试水平上的随机截距和预测变量<code>x</code>的随机斜率的模型的公式语法为<code>y ~ x + (1 + x | subject_id)</code>，其中用包含在括号中的竖线<code>|</code>部分进行了随机效应的指定。竖线右侧的变量<code>subject_id</code>指定了随机因子的水平。括号中竖线左侧的公式<code>1 + x</code>指定了与该因子相关的随机效应，在这种情况下是随机截距和<code>x</code>的随机斜率。最好将这个括号中的部分<code>(1 + x | subject_id)</code>理解为<strong>对<code>lme4::lmer()</code>关于如何构建协方差矩阵以捕捉由随机因子被试引入的方差的指示</strong>。到目前为止，你应该意识到，这个指示将指示一个二维协方差矩阵的估计，一个维度是截距方差，一个是斜率方差。</p>
<p>但我们并不仅局限于估计被试的随机效应；我们还可以通过简单地在公式中添加另一个项来指定刺激的随机效应。例如：</p>
<p><code>y ~ x + (1 + x | subject_id) + (1 + x | stimulus_id)</code>。</p>
<p>这个公式通过<code>x</code>对<code>y</code>进行了回归，包含了被试水平上的随机截距和斜率的随机效应和刺激水平上的随机截距和斜率的随机效应。这样，拟合的模型将捕捉到我们估计中的两种不确定性来源——由被试抽样引入的不确定性以及由(刺激)项目抽样引入的不确定性。我们现在估计的是<strong>两个独立的协方差矩阵</strong>，一个用于被试，一个用于(刺激)项目。在上述例子中，这两个矩阵都将具有相同的2x2结构，但情况未必总是如此。我们可以通过改变每个竖线<code>|</code>符号左侧的公式灵活地更改随机效应结构。例如，如果我们有另一个预测变量<code>w</code>，我们可以有：</p>
<p><code>y ~ x + (x | subject_id) + (x + w | stimulus_id)</code></p>
<p>这将为被试估计相同的2x2矩阵，但(刺激)项目的协方差矩阵现在是一个3x3矩阵(截距、<code>x</code>的斜率和 <code>w</code>的斜率)。虽然这提供了很大的灵活性，但随着随机效应结构变得更加复杂，估计过程变得更加困难，并且不太可能收敛得到结果。</p>
</div>
<div id="指定随机效应" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> 指定随机效应<a href="交叉随机因子线性混合效应模型.html#指定随机效应" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>随机效应结构的选择并不是随着线性混合效应模型而出现的新问题。在使用t检验和ANOVA的传统方法中，当你选择使用何种流程时，你隐含地选择了随机效应结构。如上一章所讨论的，如果你选择配对样本t检验而不是独立样本t检验，这相当于选择拟合<code>lme4::lmer(y ~ x + (1 | subject))</code>而不是<code>lm(y ~ x)</code>。同样地，你可以将混合模型ANOVA运行为<code>aov(y ~ x + Error(subject_id))</code>，这相当于随机截距模型，或者<code>aov(y ~ x + Error(x / subject_id))</code>，这相当于随机斜率模型。心理学中进行验证性分析(confirmatory analyses)的传统是使用<strong>研究设计所证明的最大随机效应结构</strong>。所以，如果你有一个带有假重复的单因素数据，你会使用<code>aov(y ~ x + Error(x / subject_id))</code>而不是<code>aov(y ~ x + Error(subject_id))</code>。类似地，如果你使用线性混合效应模型来分析具有假重复的数据，你应该使用<code>lme4::lmer(y ~ x + (1 + x | subject_id))</code>而不是<code>lme4::lmer(y ~ x + (1 | subject_id))</code>。换句话说，你应该考虑由重复抽样相同被试或刺激引入的所有非独立性来源。这种方法被称为<strong>最大随机效应法(maximal random effects approach)</strong>或<strong>设计驱动法(design-driven approach)</strong>来指定随机效应结构<span class="citation">(<a href="#ref-Barr_et_al_2013">Barr et al., 2013</a>)</span>。未能考虑到设计引入的依赖性可能会导致标准差过小，进而导致p值小于实际值，从而提高假阳性概率(I类错误)。在某些情况下，这可能导致效力降低，从而提高假阴性概率(II类错误)。因此，进行分析时必须密切注意随机效应结构。</p>
<p>线性混合效应模型几乎不可避免地包含所有设计中随机因子的随机截距。因此，如果你的随机因子是由<code>subject_id</code>和<code>stimulus_id</code>标识的被试和刺激，那么至少你的模型语法将包含<code>(1 | subject_id) + (1 | stimulus_id)</code>。但你会在模型中有各种预测变量，因此关键问题是：我应该允许哪些预测变量在什么抽样单位上变化？例如，如果你的模型的固定效应部分是一个2x2因子设计，因子A和B，<code>y ~ a * b + ...</code>，你可能会有各种随机效应结构，包括(但不限于)：</p>
<ol style="list-style-type: decimal">
<li>仅随机截距：<code>y ~ a * b + (1 | subject_id) + (1 | stimulus_id)</code></li>
<li>被试水平上的a随机截距和(刺激)项目水平上的随机截距：<code>y ~ a * b + (a | subject_id) + (1 | stimulus_id)</code></li>
<li>被试水平上的a和b的随机截距和斜率及其交互效应，(刺激)项目水平上的随机截距：<code>y ~ a * b + (a * b | subject_id) + (1 | stimulus_id)</code></li>
<li>被试水平上的a和b的随机截距和斜率及其交互效应，(刺激)项目水平上的a和b的随机截距和斜率及其交互效应：<code>y ~ a * b + (a * b | subject_id) + (a * b | stimulus_id)</code>。</li>
</ol>
<p>有一点需要明确：</p>
<div class="bluebox">
<p>“由设计证明的最大随机效应结构”与“最大可能的随机效应结构”不同；也就是说，它并不意味着自动将所有预测变量的所有随机斜率放入所有随机因子中。你必须遵循下一部分中的随机效应指南，以决定是否应包含某个随机斜率。</p>
</div>
<p>一些作者建议采用“数据驱动”的随机效应结构替代设计驱动的随机效应结构，建议研究者仅在数据进一步证明的情况下才包含设计所证明的随机斜率<span class="citation">(<a href="#ref-Matuschek_et_al_2017">Matuschek et al., 2017</a>)</span>。例如，你可以使用虚无假设检验来确定是否包括一个被试水平上的<code>x</code>随机斜率显著提高了模型拟合，只有在显著提高时才包含该效应。虽然当随机斜率非常小时，这可能会在理论意义上提高检验的效力，但也会增加未知的假阳性风险，因此在检验的情景中是否应该采用这种方法是值得怀疑的。所以，我们不推荐基于数据的方法。</p>
<div id="为分类因子选择随机效应的规则" class="section level3 hasAnchor" number="7.3.1">
<h3><span class="header-section-number">7.3.1</span> 为分类因子选择随机效应的规则<a href="交叉随机因子线性混合效应模型.html#为分类因子选择随机效应的规则" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>线性混合效应模型的随机效应结构——即关于哪些效应在什么抽样单位上变化的假设——对于确保你的参数反映抽样引入的不确定性至关重要<span class="citation">(<a href="#ref-Barr_et_al_2013">Barr et al., 2013</a>)</span>。首先，请注意我们专注于代表<strong>设计变量(design variable)</strong>的预测变量，这些变量具有理论意义，并且你将对其进行推断检验。如果你有代表<strong>控制变量(control variable)</strong>的预测变量，而你不打算对其进行统计检验，那么通常不需要随机斜率。</p>
<p>以下规则源自 <span class="citation">Barr et al. (<a href="#ref-Barr_et_al_2013">2013</a>)</span> 和 <span class="citation">Barr (<a href="#ref-Barr_2013">2013</a>)</span> 。如果你想了解这些指南的更多信息，请参考这些论文。请记住，只有当你有重复测量数据时，你才能使用混合效应模型，这可能是由于假重复和/或存在被试内(或刺激内)因子。在交叉随机因子的情况下，你不可避免地会有假重复——由于多个被试的多个刺激，每个被试的多个观测值，以及多个被试的每个刺激的多个观测值。确定随机效应结构的关键是弄清楚哪些因子是被试内或刺激内，以及设计中的假重复位于何处。你对被试使用一次规则以确定公式<code>(1 + ... | subject_id)</code>部分的形式，并对刺激使用一次规则以确定公式<code>(1 + ... | stimulus_id)</code>部分的形式。以下规则中的“单位”或“抽样单位”一词，根据需要替换为“被试”或“刺激”。</p>
<p>以下是规则：</p>
<ol style="list-style-type: decimal">
<li>如果对抽样单位进行了重复测量，则需要该随机因子的随机截距：<code>(1 | unit_id)</code>；</li>
<li>如果一个因子<code>x</code>是单位间的，则不需要该因子的随机斜率；</li>
<li>确定所考虑的单位的被试内因子的最高阶交互效应。如果在这些组合定义的每个单元内有假重复(即每个单元的多个观测值)，那么对于该单位，你将需要该交互效应的斜率以及所有低阶效应的斜率。如果没有假重复，则不需要任何随机斜率。</li>
</ol>
<p>前两条规则很简单，但第三条需要一些解释。首先问自己：我们怎么知道某个因子是单位间还是单位内的？</p>
<p>一个简单的方法是使用<code>dplyr::count()</code>函数(加载tidyverse时同时加载)，它会提供频率计数。假设你对因子A是否在被试内还是被试者间感兴趣，对下面虚拟的2x2x2因子数据<code>abc_data</code>，其中 <span class="math inline">\(A\)</span>、<span class="math inline">\(B\)</span>和<span class="math inline">\(C\)</span>是你的设计因子。</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="交叉随机因子线性混合效应模型.html#cb201-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb201-2"><a href="交叉随机因子线性混合效应模型.html#cb201-2" tabindex="-1"></a></span>
<span id="cb201-3"><a href="交叉随机因子线性混合效应模型.html#cb201-3" tabindex="-1"></a><span class="do">## 运行代码创建&quot;abc_data&quot;表</span></span>
<span id="cb201-4"><a href="交叉随机因子线性混合效应模型.html#cb201-4" tabindex="-1"></a>abc_subj <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">subject_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb201-5"><a href="交叉随机因子线性混合效应模型.html#cb201-5" tabindex="-1"></a>                   <span class="at">B =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;B1&quot;</span>, <span class="st">&quot;B2&quot;</span>), <span class="at">times =</span> <span class="dv">2</span>))</span>
<span id="cb201-6"><a href="交叉随机因子线性混合效应模型.html#cb201-6" tabindex="-1"></a></span>
<span id="cb201-7"><a href="交叉随机因子线性混合效应模型.html#cb201-7" tabindex="-1"></a>abc_item  <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">stimulus_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb201-8"><a href="交叉随机因子线性混合效应模型.html#cb201-8" tabindex="-1"></a>                    <span class="at">A =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;A1&quot;</span>, <span class="st">&quot;A2&quot;</span>), <span class="at">each =</span> <span class="dv">2</span>),</span>
<span id="cb201-9"><a href="交叉随机因子线性混合效应模型.html#cb201-9" tabindex="-1"></a>                    <span class="at">C =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;C1&quot;</span>, <span class="st">&quot;C2&quot;</span>), <span class="at">times =</span> <span class="dv">2</span>))</span>
<span id="cb201-10"><a href="交叉随机因子线性混合效应模型.html#cb201-10" tabindex="-1"></a></span>
<span id="cb201-11"><a href="交叉随机因子线性混合效应模型.html#cb201-11" tabindex="-1"></a>abc_data <span class="ot">&lt;-</span> <span class="fu">crossing</span>(abc_subj, abc_item) <span class="sc">%&gt;%</span></span>
<span id="cb201-12"><a href="交叉随机因子线性混合效应模型.html#cb201-12" tabindex="-1"></a>  <span class="fu">select</span>(subject_id, stimulus_id, <span class="fu">everything</span>())</span></code></pre></div>
<p>查看<span class="math inline">\(A\)</span>是被试内还是被试间，使用：</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="交叉随机因子线性混合效应模型.html#cb202-1" tabindex="-1"></a>abc_data <span class="sc">%&gt;%</span></span>
<span id="cb202-2"><a href="交叉随机因子线性混合效应模型.html#cb202-2" tabindex="-1"></a>  <span class="fu">count</span>(subject_id, A)</span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##   subject_id A         n
##        &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1          1 A1        2
## 2          1 A2        2
## 3          2 A1        2
## 4          2 A2        2
## 5          3 A1        2
## 6          3 A2        2
## 7          4 A1        2
## 8          4 A2        2</code></pre>
<p>在结果表中，你可以看到每个被试都接受了<span class="math inline">\(A\)</span>的所有水平，说明这是个被试内因子。那么对于<span class="math inline">\(B\)</span>和<span class="math inline">\(C\)</span>呢？</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="交叉随机因子线性混合效应模型.html#cb204-1" tabindex="-1"></a>abc_data <span class="sc">%&gt;%</span></span>
<span id="cb204-2"><a href="交叉随机因子线性混合效应模型.html#cb204-2" tabindex="-1"></a>  <span class="fu">count</span>(subject_id, B)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##   subject_id B         n
##        &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1          1 B1        4
## 2          2 B2        4
## 3          3 B1        4
## 4          4 B2        4</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="交叉随机因子线性混合效应模型.html#cb206-1" tabindex="-1"></a>abc_data <span class="sc">%&gt;%</span></span>
<span id="cb206-2"><a href="交叉随机因子线性混合效应模型.html#cb206-2" tabindex="-1"></a>  <span class="fu">count</span>(subject_id, C)</span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##   subject_id C         n
##        &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1          1 C1        2
## 2          1 C2        2
## 3          2 C1        2
## 4          2 C2        2
## 5          3 C1        2
## 6          3 C2        2
## 7          4 C1        2
## 8          4 C2        2</code></pre>
<p><span class="math inline">\(B\)</span>是被试间(每个被试只接受1个水平)，<span class="math inline">\(C\)</span>是被试内(每个被试接受所有水平)。</p>
<div class="purplebox">
<p><em>练习</em></p>
<p>回答关于<code>abc_data</code>的问题。</p>
<ul>
<li>因子<span class="math inline">\(A\)</span>的水平是在刺激间还是刺激内? <select class='webex-select'><option value='blank'></option><option value='answer'>between</option><option value=''>within</option></select></li>
</ul>
<div class="webex-solution">
<button>
答案
</button>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="交叉随机因子线性混合效应模型.html#cb208-1" tabindex="-1"></a>abc_data <span class="sc">%&gt;%</span></span>
<span id="cb208-2"><a href="交叉随机因子线性混合效应模型.html#cb208-2" tabindex="-1"></a>  <span class="fu">count</span>(stimulus_id, A)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##   stimulus_id A         n
##         &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1           1 A1        4
## 2           2 A1        4
## 3           3 A2        4
## 4           4 A2        4</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="交叉随机因子线性混合效应模型.html#cb210-1" tabindex="-1"></a><span class="co"># between</span></span></code></pre></div>
</div>
<ul>
<li>因子<span class="math inline">\(B\)</span>的水平是在刺激间还是刺激内? <select class='webex-select'><option value='blank'></option><option value=''>between</option><option value='answer'>within</option></select></li>
</ul>
<div class="webex-solution">
<button>
答案
</button>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="交叉随机因子线性混合效应模型.html#cb211-1" tabindex="-1"></a>abc_data <span class="sc">%&gt;%</span></span>
<span id="cb211-2"><a href="交叉随机因子线性混合效应模型.html#cb211-2" tabindex="-1"></a>  <span class="fu">count</span>(stimulus_id, B)</span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##   stimulus_id B         n
##         &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1           1 B1        2
## 2           1 B2        2
## 3           2 B1        2
## 4           2 B2        2
## 5           3 B1        2
## 6           3 B2        2
## 7           4 B1        2
## 8           4 B2        2</code></pre>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="交叉随机因子线性混合效应模型.html#cb213-1" tabindex="-1"></a><span class="co"># within</span></span></code></pre></div>
</div>
<ul>
<li>因子<span class="math inline">\(C\)</span>的水平是在刺激间还是刺激内? <select class='webex-select'><option value='blank'></option><option value='answer'>between</option><option value=''>within</option></select></li>
</ul>
<div class="webex-solution">
<button>
答案
</button>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="交叉随机因子线性混合效应模型.html#cb214-1" tabindex="-1"></a>abc_data <span class="sc">%&gt;%</span></span>
<span id="cb214-2"><a href="交叉随机因子线性混合效应模型.html#cb214-2" tabindex="-1"></a>  <span class="fu">count</span>(stimulus_id, C)</span></code></pre></div>
<pre><code>## # A tibble: 4 × 3
##   stimulus_id C         n
##         &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1           1 C1        4
## 2           2 C2        4
## 3           3 C1        4
## 4           4 C2        4</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="交叉随机因子线性混合效应模型.html#cb216-1" tabindex="-1"></a><span class="co"># between</span></span></code></pre></div>
</div>
</div>
<p>好的，我们已经确定了哪些因子是被试内和哪些被试间，以及哪些因子是刺激内和哪些刺激间。</p>
<p>第二条规则告诉我们，如果一个因子是单位间的，你不需要该因子的随机斜率。事实上，无法估计单位间因子的随机斜率。如果你考虑到随机斜率捕捉效应在单位之间的变化，那么只有当你在该因子的所有水平上测量了你的响应变量时，才能估计出这种变化。例如，如果你有一个名为处理组(实验组、对照组)的2水平因子，除非某个被试经历了该因子的两个水平(即它必须是被试内的)，否则无法估计“治疗”对该被试的效应。</p>
<p>我们现在如何应用第三条规则来确定我们对单位内因子需要哪些随机斜率呢？</p>
<p>考虑到<span class="math inline">\(A\)</span>和<span class="math inline">\(C\)</span>是被试内的，<span class="math inline">\(B\)</span>是被试间的。所以被试内因子的最高阶交互作用是<span class="math inline">\(AC\)</span>。如果我们对每个被试在每个<span class="math inline">\(AC\)</span>组合中有假重复，那么我们将需要<span class="math inline">\(AC\)</span>交互效应的随机斜率以及主效应<span class="math inline">\(A\)</span>和<span class="math inline">\(C\)</span>的随机斜率。我们如何确定这一点呢？</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="交叉随机因子线性混合效应模型.html#cb217-1" tabindex="-1"></a>abc_data <span class="sc">%&gt;%</span></span>
<span id="cb217-2"><a href="交叉随机因子线性混合效应模型.html#cb217-2" tabindex="-1"></a>  <span class="fu">count</span>(subject_id, A, C)</span></code></pre></div>
<pre><code>## # A tibble: 16 × 4
##    subject_id A     C         n
##         &lt;int&gt; &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
##  1          1 A1    C1        1
##  2          1 A1    C2        1
##  3          1 A2    C1        1
##  4          1 A2    C2        1
##  5          2 A1    C1        1
##  6          2 A1    C2        1
##  7          2 A2    C1        1
##  8          2 A2    C2        1
##  9          3 A1    C1        1
## 10          3 A1    C2        1
## 11          3 A2    C1        1
## 12          3 A2    C2        1
## 13          4 A1    C1        1
## 14          4 A1    C2        1
## 15          4 A2    C1        1
## 16          4 A2    C2        1</code></pre>
<p>这向我们展示了对于每个<span class="math inline">\(AC\)</span>组合，只有<em>1</em>个观测值，因此我们不需要<span class="math inline">\(AC\)</span>的随机斜率，也不需要<span class="math inline">\(A\)</span>或<span class="math inline">\(C\)</span>的随机斜率。被试水平上的随机效应公式就是<code>(1 | subject_id)</code>。</p>
<div class="purplebox">
<p>刺激水平上的随机因子需要哪些随机斜率?</p>
<div class="webex-solution">
<button>
答案
</button>
<p>你有1个刺激内因子<span class="math inline">\(B\)</span>，它进行了假重复。</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="交叉随机因子线性混合效应模型.html#cb219-1" tabindex="-1"></a>abc_data <span class="sc">%&gt;%</span></span>
<span id="cb219-2"><a href="交叉随机因子线性混合效应模型.html#cb219-2" tabindex="-1"></a>  <span class="fu">count</span>(stimulus_id, B)</span></code></pre></div>
<pre><code>## # A tibble: 8 × 3
##   stimulus_id B         n
##         &lt;int&gt; &lt;chr&gt; &lt;int&gt;
## 1           1 B1        2
## 2           1 B2        2
## 3           2 B1        2
## 4           2 B2        2
## 5           3 B1        2
## 6           3 B2        2
## 7           4 B1        2
## 8           4 B2        2</code></pre>
<p>因此对于刺激的公式是<code>(B | stimulus_id)</code>, 完整的<code>lme4</code>公式是:</p>
<p><code>y ~ A * B * C + (1 | subject_id) + (B | stimulus_id)</code>.</p>
</div>
</div>
</div>
<div id="排除不收敛和畸形拟合singular-fit" class="section level3 hasAnchor" number="7.3.2">
<h3><span class="header-section-number">7.3.2</span> 排除不收敛和“畸形拟合(singular fit)”<a href="交叉随机因子线性混合效应模型.html#排除不收敛和畸形拟合singular-fit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>当你试图拟合具有最大随机效应的模型时，可能会遇到几个不同的问题。回想一下，线性混合效应模型的估计算法是<em>迭代(iterative)</em>——即拟合算法以逐步的方式搜索使数据最合适的参数值。有时它会一直搜索但找不到，这种情况下，你会收到“收敛警告”。当这种情况发生时，信任未收敛模型的任何估计值都不是一个好主意，你需要简化模型结构然后重试。</p>
<p>另一种情况是你会收到关于“畸形拟合”的信息。当估计过程包含一个或多个随机因子产生的方差-协方差矩阵有(1)完全或近乎完全(1.00，-1.00)的正或负相关，(2)一个或多个方差接近于0，或(3)两者兼有时，会出现这种信息。可能可以忽略此信息，但也有理由简化模型结构直到信息消失。</p>
<p>如何简化模型以处理收敛问题或畸形拟合信息呢？这需要小心操作。我建议以下策略：</p>
<ol style="list-style-type: decimal">
<li>将所有协方差参数约束为0。这可以使用双竖线<code>||</code>语法来完成，例如，将<code>(a * b | subject)</code>更改为<code>(a * b || subject)</code>。如果仍然遇到估计问题，那么：</li>
<li>检查非收敛或畸形模型的参数估计值。是否有任何斜率变量为0或接近于0？删除这些变量并重新拟合模型，重复此步骤直到收敛警告/畸形拟合信息消失。</li>
</ol>
<p>有关收敛问题的更多技术细节以及如何处理，参见<code>?lme4::convergence</code>和<code>?lme4::isSingular</code>。</p>
<p>注：推荐阅读<a href="https://github.com/usplos/Eye-movement-related/blob/master/Linear%20mixed%20model%20(Hierarchical%20linear%20model)%20using%20R%20and%20JAMOVI.md">混合线性模型的实现</a>加深理解。</p>
</div>
</div>
<div id="模拟交叉随机因子的数据" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> 模拟交叉随机因子的数据<a href="交叉随机因子线性混合效应模型.html#模拟交叉随机因子的数据" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>对于这些练习，我们将生成与实验相对应的模拟数据，该实验具有被试内和项目间的单、双水平因子(自变量)。假设实验涉及一组单词的词汇决策(例如，“PINT”是单词还是非单词？)，因变量是反应时(以毫秒为单位)，自变量是词类(名词与动词)。我们想把被试和单词都视为随机因子(以便我们能够推广到被试遇到单词这一事件的总体)。你可以使用<a href="https://rstudio-connect.psy.gla.ac.uk/crossed" target="_blank">网页app</a>进行操作，这允许你操纵数据生成参数并观察其对数据的影响。</p>
<p>到目前为止，你应该已经掌握了模拟具有交叉随机效应的研究数据所需的所有拼图。<span class="citation">DeBruine &amp; Barr (<a href="#ref-Debruine_Barr_2020">2021</a>)</span> 提供了更详细的、逐步的练习演示。</p>
<p>这里是被试<span class="math inline">\(s\)</span>和项目<span class="math inline">\(i\)</span>的反应时<span class="math inline">\(Y_{si}\)</span>的数据生成过程(data generating process，DGP)：</p>
<p><em>第1层:</em></p>
<p><span class="math display">\[\begin{equation}
Y_{si} = \beta_{0s} + \beta_{1} X_{i} + e_{si}
\end{equation}\]</span></p>
<p><em>第2层:</em></p>
<p><span class="math display">\[\begin{equation}
\beta_{0s} = \gamma_{00} + S_{0s} + I_{0i}
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\beta_{1} = \gamma_{10} + S_{1s}
\end{equation}\]</span></p>
<p><em>方差成分:</em></p>
<p><span class="math display">\[\begin{equation}
\langle S_{0s}, S_{1s} \rangle \sim N\left(\langle 0, 0 \rangle, \mathbf{\Sigma}\right)
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
\mathbf{\Sigma} = \left(\begin{array}{cc}{\tau_{00}}^2 &amp; \rho\tau_{00}\tau_{11} \\
         \rho\tau_{00}\tau_{11} &amp; {\tau_{11}}^2 \\
         \end{array}\right)
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
I_{0s} \sim N\left(0, {\omega_{00}}^2\right)
\end{equation}\]</span></p>
<p><span class="math display">\[\begin{equation}
e_{si} \sim N\left(0, \sigma^2\right)
\end{equation}\]</span></p>
<p>在上述等式中，<span class="math inline">\(X_i\)</span>是是一个数值型预测变量编码，它决定项目<span class="math inline">\(i\)</span>所处的条件，如-.5表示名词，.5表示动词。</p>
<p>我们可以化简第1层和第2层为：</p>
<p><span class="math display">\[Y_{si} = \beta_0 + S_{0s} + I_{0i} + (\beta_1 + S_{1s})X_{i} + e_{si}\]</span></p>
<p>其中：</p>
<table>
<colgroup>
<col width="20%" />
<col width="15%" />
<col width="64%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">参数</th>
<th align="left">符号</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(Y_{si}\)</span></td>
<td align="left"><code>Y</code></td>
<td align="left">被试<span class="math inline">\(s\)</span>对于项目<span class="math inline">\(i\)</span>的反应时;</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\beta_0\)</span></td>
<td align="left"><code>b0</code></td>
<td align="left">总均值;</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(S_{0s}\)</span></td>
<td align="left"><code>S_0s</code></td>
<td align="left">被试<span class="math inline">\(s\)</span>的随机截距;</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(I_{0i}\)</span></td>
<td align="left"><code>I_0i</code></td>
<td align="left">项目<span class="math inline">\(i\)</span>的随机截距;</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\beta_1\)</span></td>
<td align="left"><code>b1</code></td>
<td align="left">单词类型的固定效应(斜率);</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(S_{1s}\)</span></td>
<td align="left"><code>S_1s</code></td>
<td align="left">被试水平上的随机斜率;</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(X_{i}\)</span></td>
<td align="left"><code>cond</code></td>
<td align="left">字型的偏差编码预测变量;</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\tau_{00}\)</span></td>
<td align="left"><code>tau_00</code></td>
<td align="left">被试水平上的随机截距标准差</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\tau_{11}\)</span></td>
<td align="left"><code>tau_11</code></td>
<td align="left">被试水平上的随机斜率标准差</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\rho\)</span></td>
<td align="left"><code>rho</code></td>
<td align="left">随机截距与斜率的相关性</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\omega_{00}\)</span></td>
<td align="left"><code>omega_00</code></td>
<td align="left">项目水平上的随机截距标准差</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(e_{si}\)</span></td>
<td align="left"><code>err</code></td>
<td align="left">被试<span class="math inline">\(s\)</span>项目<span class="math inline">\(i\)</span>的误差残差</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\sigma\)</span></td>
<td align="left"><code>sig</code></td>
<td align="left">误差残差标准差</td>
</tr>
</tbody>
</table>
<div id="设置环境并定义dgp的参数" class="section level3 hasAnchor" number="7.4.1">
<h3><span class="header-section-number">7.4.1</span> 设置环境并定义DGP的参数<a href="交叉随机因子线性混合效应模型.html#设置环境并定义dgp的参数" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>如果你想在这个练习中得到和其他人一样的结果，我们都应该为随机数生成器提供相同的值。同时，让我们加载我们需要的包。</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb221-1"><a href="交叉随机因子线性混合效应模型.html#cb221-1" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb221-2"><a href="交叉随机因子线性混合效应模型.html#cb221-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb221-3"><a href="交叉随机因子线性混合效应模型.html#cb221-3" tabindex="-1"></a></span>
<span id="cb221-4"><a href="交叉随机因子线性混合效应模型.html#cb221-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">11709</span>)  </span></code></pre></div>
<p>现在让我们定义DGP参数。</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="交叉随机因子线性混合效应模型.html#cb222-1" tabindex="-1"></a>nsubj <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># 被试数</span></span>
<span id="cb222-2"><a href="交叉随机因子线性混合效应模型.html#cb222-2" tabindex="-1"></a>nitem <span class="ot">&lt;-</span> <span class="dv">50</span>  <span class="co"># 必须是偶数</span></span>
<span id="cb222-3"><a href="交叉随机因子线性混合效应模型.html#cb222-3" tabindex="-1"></a></span>
<span id="cb222-4"><a href="交叉随机因子线性混合效应模型.html#cb222-4" tabindex="-1"></a>b0 <span class="ot">&lt;-</span> <span class="dv">800</span> <span class="co"># 总均值</span></span>
<span id="cb222-5"><a href="交叉随机因子线性混合效应模型.html#cb222-5" tabindex="-1"></a>b1 <span class="ot">&lt;-</span> <span class="dv">80</span> <span class="co"># 80毫秒差异</span></span>
<span id="cb222-6"><a href="交叉随机因子线性混合效应模型.html#cb222-6" tabindex="-1"></a>effc <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, .<span class="dv">5</span>) <span class="co"># 偏差编码</span></span>
<span id="cb222-7"><a href="交叉随机因子线性混合效应模型.html#cb222-7" tabindex="-1"></a></span>
<span id="cb222-8"><a href="交叉随机因子线性混合效应模型.html#cb222-8" tabindex="-1"></a>omega_00 <span class="ot">&lt;-</span> <span class="dv">80</span> <span class="co"># 项目水平上的随机截距标准差(omega_00)</span></span>
<span id="cb222-9"><a href="交叉随机因子线性混合效应模型.html#cb222-9" tabindex="-1"></a></span>
<span id="cb222-10"><a href="交叉随机因子线性混合效应模型.html#cb222-10" tabindex="-1"></a><span class="do">## 被试水平上的方差-协方差矩阵</span></span>
<span id="cb222-11"><a href="交叉随机因子线性混合效应模型.html#cb222-11" tabindex="-1"></a>tau_00 <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># 被试水平上的随机截距标准差</span></span>
<span id="cb222-12"><a href="交叉随机因子线性混合效应模型.html#cb222-12" tabindex="-1"></a>tau_11 <span class="ot">&lt;-</span> <span class="dv">40</span> <span class="co"># 被试水平上的随机斜率标准差</span></span>
<span id="cb222-13"><a href="交叉随机因子线性混合效应模型.html#cb222-13" tabindex="-1"></a>rho <span class="ot">&lt;-</span> .<span class="dv">2</span> <span class="co"># 截距和斜率的相关性</span></span>
<span id="cb222-14"><a href="交叉随机因子线性混合效应模型.html#cb222-14" tabindex="-1"></a></span>
<span id="cb222-15"><a href="交叉随机因子线性混合效应模型.html#cb222-15" tabindex="-1"></a>sig <span class="ot">&lt;-</span> <span class="dv">200</span> <span class="co"># 残差(标准差)</span></span></code></pre></div>
<p>你将创建3个表：</p>
<table>
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>subjects</code></td>
<td align="left">包含<code>subj_id</code>和被试随机效应的被试数据表</td>
</tr>
<tr class="even">
<td align="left"><code>items</code></td>
<td align="left">包含<code>item_id</code>和项目随机效应的刺激数据表</td>
</tr>
<tr class="odd">
<td align="left"><code>trials</code></td>
<td align="left">列举被试/刺激之间组合的试验表</td>
</tr>
</tbody>
</table>
<p>然后将三个表中的信息合并在一起，根据上面的模型公式计算响应变量。</p>
</div>
<div id="生成刺激样本" class="section level3 hasAnchor" number="7.4.2">
<h3><span class="header-section-number">7.4.2</span> 生成刺激样本<a href="交叉随机因子线性混合效应模型.html#生成刺激样本" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>让我们随机生成50项。像下面一样创建一个叫<code>item</code>的表，其中<code>iri</code>是项目水平上的随机截距(提取于方差为<span class="math inline">\(\omega_{00}^2\)</span> = 6400的正态分布)。一半的词形是名词(<code>cond = -.5</code>)，一半的词形是动词(<code>cond = .5</code>)。</p>
<div class="webex-solution">
<button>
点击查看完整表格
</button>
<pre><code>## # A tibble: 50 × 3
##    item_id  cond    I_0i
##      &lt;int&gt; &lt;dbl&gt;   &lt;dbl&gt;
##  1       1  -0.5   14.9 
##  2       2   0.5  -86.3 
##  3       3  -0.5  -12.8 
##  4       4   0.5  -13.9 
##  5       5  -0.5   55.6 
##  6       6   0.5  -45.9 
##  7       7  -0.5  -42.0 
##  8       8   0.5  -87.6 
##  9       9  -0.5  -97.4 
## 10      10   0.5  -85.2 
## 11      11  -0.5  135.  
## 12      12   0.5   83.2 
## 13      13  -0.5  -44.7 
## 14      14   0.5    8.59
## 15      15  -0.5 -156.  
## 16      16   0.5  -57.6 
## 17      17  -0.5  -38.7 
## 18      18   0.5   39.6 
## 19      19  -0.5  105.  
## 20      20   0.5   30.3 
## 21      21  -0.5 -115.  
## 22      22   0.5   -3.40
## 23      23  -0.5 -218.  
## 24      24   0.5   53.0 
## 25      25  -0.5  -86.9 
## 26      26   0.5  -65.4 
## 27      27  -0.5  172.  
## 28      28   0.5 -152.  
## 29      29  -0.5   25.1 
## 30      30   0.5 -156.  
## 31      31  -0.5   47.7 
## 32      32   0.5  -46.3 
## 33      33  -0.5   48.0 
## 34      34   0.5   62.8 
## 35      35  -0.5  -75.4 
## 36      36   0.5  -35.9 
## 37      37  -0.5  -48.5 
## 38      38   0.5   29.3 
## 39      39  -0.5  -55.5 
## 40      40   0.5   69.5 
## 41      41  -0.5  196.  
## 42      42   0.5   77.6 
## 43      43  -0.5  -45.0 
## 44      44   0.5  204.  
## 45      45  -0.5   32.1 
## 46      46   0.5  -63.9 
## 47      47  -0.5  145.  
## 48      48   0.5   66.2 
## 49      49  -0.5  -23.9 
## 50      50   0.5   97.3</code></pre>
</div>
<div class="webex-solution">
<button>
提示：生成cond
</button>
<p><code>rep()</code></p>
</div>
<div class="webex-solution">
<button>
提示：生成项目的随机效应
</button>
<p><code>rnorm()</code></p>
</div>
<div class="webex-solution">
<button>
答案
</button>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="交叉随机因子线性混合效应模型.html#cb224-1" tabindex="-1"></a>items <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">item_id =</span> <span class="dv">1</span><span class="sc">:</span>nitem,</span>
<span id="cb224-2"><a href="交叉随机因子线性混合效应模型.html#cb224-2" tabindex="-1"></a>                <span class="at">cond =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="sc">-</span>.<span class="dv">5</span>, .<span class="dv">5</span>), <span class="at">times =</span> nitem <span class="sc">/</span> <span class="dv">2</span>),</span>
<span id="cb224-3"><a href="交叉随机因子线性混合效应模型.html#cb224-3" tabindex="-1"></a>                <span class="at">I_0i =</span> <span class="fu">rnorm</span>(nitem, <span class="dv">0</span>, <span class="at">sd =</span> omega_00))</span></code></pre></div>
</div>
</div>
<div id="生成被试样本" class="section level3 hasAnchor" number="7.4.3">
<h3><span class="header-section-number">7.4.3</span> 生成被试样本<a href="交叉随机因子线性混合效应模型.html#生成被试样本" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>要生成被试水平上的随机效应，你需要从<em>双变量正态分布</em>中生成数据。为此，我们将使用函数<code>MASS::mvrnorm</code>。</p>
<div class="yellowbox">
<p><strong>记住</strong>：不要仅仅为了获得这个函数而运行<code>library("MASS")</code>，因为<code>MASS</code>包中有一个函数<code>select()</code>会覆盖tidyverse版本的<code>select()</code>。由于我们只需要<code>MASS</code>包中的<code>mvrnorm()</code>函数，我们可以直接通过<code>pkgname::function</code>语法来访问它，即<code>MASS::mvrnorm()</code>。</p>
</div>
<p>你的被试表格应如下所示：</p>
<div class="webex-solution">
<button>
点击查看完整表格
</button>
<pre><code>## # A tibble: 100 × 3
##     subj_id      S_0s     S_1s
##       &lt;int&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##   1       1  -80.0      -0.763
##   2       2   44.6      54.5  
##   3       3    8.74    -20.4  
##   4       4  -38.6     -23.8  
##   5       5  -83.3      29.2  
##   6       6  -70.9     -13.8  
##   7       7  -21.4      46.0  
##   8       8    2.33      8.39 
##   9       9   62.3     -58.2  
##  10      10  238.        7.72 
##  11      11  -92.5       2.14 
##  12      12   58.5     -65.8  
##  13      13 -204.      -38.8  
##  14      14  -91.6       5.46 
##  15      15   51.1     -38.8  
##  16      16  142.      -12.9  
##  17      17   46.0       6.60 
##  18      18  -56.7     -54.8  
##  19      19  -10.1      62.1  
##  20      20 -226.      -19.3  
##  21      21 -158.      -18.5  
##  22      22  102.        8.99 
##  23      23  -12.7     -70.6  
##  24      24  135.       -9.50 
##  25      25   62.0     -52.5  
##  26      26    0.0653   32.8  
##  27      27 -117.       70.8  
##  28      28 -232.        3.43 
##  29      29   70.9      50.8  
##  30      30 -123.       22.8  
##  31      31  268.       30.0  
##  32      32  -18.7     -25.0  
##  33      33   50.8     -31.0  
##  34      34  -43.1     -28.9  
##  35      35  -10.1      28.3  
##  36      36   65.6      18.2  
##  37      37 -123.       -4.63 
##  38      38  -94.8      10.3  
##  39      39   77.7     -22.5  
##  40      40  -59.1      52.4  
##  41      41  -91.2    -103.   
##  42      42  -66.6      -2.14 
##  43      43   -4.40      0.305
##  44      44   69.7      10.2  
##  45      45  -77.5     -10.4  
##  46      46  -17.8     -48.2  
##  47      47 -103.       47.0  
##  48      48   22.8     -39.3  
##  49      49  -31.1     -34.9  
##  50      50  -26.4      40.0  
##  51      51   47.8      26.0  
##  52      52  -93.2     -42.7  
##  53      53   28.9      51.4  
##  54      54  -19.3      11.5  
##  55      55   53.6      21.5  
##  56      56  -27.4     -21.4  
##  57      57  -67.7     -32.1  
##  58      58   59.2      13.4  
##  59      59  -53.1       2.44 
##  60      60  104.        7.41 
##  61      61  -20.7     -78.7  
##  62      62   55.9     -15.7  
##  63      63  114.      -29.1  
##  64      64  -57.7     -34.7  
##  65      65  -38.7      -9.14 
##  66      66 -106.      -58.0  
##  67      67   99.1     -37.6  
##  68      68  -56.9      21.0  
##  69      69  -50.4      -0.407
##  70      70   27.5      -2.69 
##  71      71  139.      -32.2  
##  72      72   44.9       8.53 
##  73      73  -14.8      71.7  
##  74      74   33.7     -52.6  
##  75      75    2.03     27.8  
##  76      76 -134.       37.0  
##  77      77   24.4      20.7  
##  78      78  -60.6     -36.7  
##  79      79   31.1      16.9  
##  80      80  -34.9       9.68 
##  81      81  206.       17.3  
##  82      82   -7.19    -25.4  
##  83      83  182.       46.0  
##  84      84   55.7      21.7  
##  85      85 -149.      -44.0  
##  86      86 -193.      -73.2  
##  87      87  167.       13.9  
##  88      88  160.        3.87 
##  89      89   84.1      82.1  
##  90      90   97.2      -6.55 
##  91      91 -205.     -125.   
##  92      92  -75.1       6.76 
##  93      93  -95.3     -46.5  
##  94      94  106.       38.6  
##  95      95  -42.4      11.3  
##  96      96   74.0     -21.1  
##  97      97 -245.      -25.3  
##  98      98 -113.       -1.88 
##  99      99   68.8      30.6  
## 100     100  136.       44.2</code></pre>
</div>
<div class="webex-solution">
<button>
提示1
</button>
<p>回忆一下：</p>
<ul>
<li><em><code>tau_00</code></em>: 被试水平上随机截距的标准差</li>
<li><em><code>tau_11</code></em>: 被试水平上随机斜率的标准差</li>
<li><em><code>rho</code></em> : 截距和斜率的相关系数</li>
</ul>
</div>
<div class="webex-solution">
<button>
提示2
</button>
<p><code>covariance = rho * tau_00 * tau_11</code></p>
</div>
<div class="webex-solution">
<button>
提示3
</button>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="交叉随机因子线性混合效应模型.html#cb226-1" tabindex="-1"></a><span class="fu">matrix</span>(    tau_00<span class="sc">^</span><span class="dv">2</span>,            rho <span class="sc">*</span> tau_00 <span class="sc">*</span> tau_11,</span>
<span id="cb226-2"><a href="交叉随机因子线性混合效应模型.html#cb226-2" tabindex="-1"></a>        rho <span class="sc">*</span> tau_00 <span class="sc">*</span> tau_11,      tau_11<span class="sc">^</span><span class="dv">2</span>, ...)</span></code></pre></div>
</div>
<div class="webex-solution">
<button>
提示4
</button>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="交叉随机因子线性混合效应模型.html#cb227-1" tabindex="-1"></a><span class="fu">as_tibble</span>(mx) <span class="sc">%&gt;%</span></span>
<span id="cb227-2"><a href="交叉随机因子线性混合效应模型.html#cb227-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subj_id =</span> ...)</span></code></pre></div>
</div>
<div class="webex-solution">
<button>
答案
</button>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="交叉随机因子线性混合效应模型.html#cb228-1" tabindex="-1"></a>cov <span class="ot">&lt;-</span> rho <span class="sc">*</span> tau_00 <span class="sc">*</span> tau_11</span>
<span id="cb228-2"><a href="交叉随机因子线性混合效应模型.html#cb228-2" tabindex="-1"></a></span>
<span id="cb228-3"><a href="交叉随机因子线性混合效应模型.html#cb228-3" tabindex="-1"></a>mx <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(tau_00<span class="sc">^</span><span class="dv">2</span>, cov,</span>
<span id="cb228-4"><a href="交叉随机因子线性混合效应模型.html#cb228-4" tabindex="-1"></a>               cov,      tau_11<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb228-5"><a href="交叉随机因子线性混合效应模型.html#cb228-5" tabindex="-1"></a>             <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb228-6"><a href="交叉随机因子线性混合效应模型.html#cb228-6" tabindex="-1"></a></span>
<span id="cb228-7"><a href="交叉随机因子线性混合效应模型.html#cb228-7" tabindex="-1"></a>by_subj_rfx <span class="ot">&lt;-</span> MASS<span class="sc">::</span><span class="fu">mvrnorm</span>(nsubj, <span class="at">mu =</span> <span class="fu">c</span>(<span class="at">S_0s =</span> <span class="dv">0</span>, <span class="at">S_1s =</span> <span class="dv">0</span>), <span class="at">Sigma =</span> mx)</span>
<span id="cb228-8"><a href="交叉随机因子线性混合效应模型.html#cb228-8" tabindex="-1"></a></span>
<span id="cb228-9"><a href="交叉随机因子线性混合效应模型.html#cb228-9" tabindex="-1"></a>subjects <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(by_subj_rfx) <span class="sc">%&gt;%</span></span>
<span id="cb228-10"><a href="交叉随机因子线性混合效应模型.html#cb228-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subj_id =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb228-11"><a href="交叉随机因子线性混合效应模型.html#cb228-11" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, <span class="fu">everything</span>())</span></code></pre></div>
</div>
</div>
<div id="生产试次样本" class="section level3 hasAnchor" number="7.4.4">
<h3><span class="header-section-number">7.4.4</span> 生产试次样本<a href="交叉随机因子线性混合效应模型.html#生产试次样本" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>每个试次都是独特被试和刺激的<em>相遇</em>，在这个实验中，每个被试都接受了每个刺激。生产一个表<code>trials</code>列出实验中所有的试次。注意：每个被试都会接受每种刺激1次。使用<code>crossing()</code>函数创建所有可能的试次。</p>
<p>现在应用这个示例生成下面的表，其中<code>err</code>是残差项，提取于<span class="math inline">\(N \sim \left(0, \sigma^2\right)\)</span>，<span class="math inline">\(\sigma\)</span>是<code>err_sd</code>。</p>
<pre><code>## # A tibble: 5,000 × 3
##    subj_id item_id    err
##      &lt;int&gt;   &lt;int&gt;  &lt;dbl&gt;
##  1       1       1  382. 
##  2       1       2  283. 
##  3       1       3   30.4
##  4       1       4 -282. 
##  5       1       5 -239. 
##  6       1       6   73.4
##  7       1       7  -98.4
##  8       1       8 -189. 
##  9       1       9 -410. 
## 10       1      10  102. 
## # ℹ 4,990 more rows</code></pre>
<div class="webex-solution">
<button>
答案
</button>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb230-1"><a href="交叉随机因子线性混合效应模型.html#cb230-1" tabindex="-1"></a>trials <span class="ot">&lt;-</span> <span class="fu">crossing</span>(<span class="at">subj_id =</span> subjects <span class="sc">%&gt;%</span> <span class="fu">pull</span>(subj_id),</span>
<span id="cb230-2"><a href="交叉随机因子线性混合效应模型.html#cb230-2" tabindex="-1"></a>                   <span class="at">item_id =</span> items <span class="sc">%&gt;%</span> <span class="fu">pull</span>(item_id)) <span class="sc">%&gt;%</span></span>
<span id="cb230-3"><a href="交叉随机因子线性混合效应模型.html#cb230-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">err =</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(.), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sig))</span></code></pre></div>
</div>
</div>
<div id="合并subjectsitems和trials" class="section level3 hasAnchor" number="7.4.5">
<h3><span class="header-section-number">7.4.5</span> 合并<code>subjects</code>，<code>items</code>和<code>trials</code><a href="交叉随机因子线性混合效应模型.html#合并subjectsitems和trials" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>合并<code>subjects</code>，<code>items</code>和<code>trials</code>中的信息，创建完整的数据集<code>dat_sim</code>，看起来像这样：</p>
<pre><code>## # A tibble: 5,000 × 7
##    subj_id item_id  S_0s  I_0i   S_1s  cond    err
##      &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1       1       1 -80.0  14.9 -0.763  -0.5  382. 
##  2       1       2 -80.0 -86.3 -0.763   0.5  283. 
##  3       1       3 -80.0 -12.8 -0.763  -0.5   30.4
##  4       1       4 -80.0 -13.9 -0.763   0.5 -282. 
##  5       1       5 -80.0  55.6 -0.763  -0.5 -239. 
##  6       1       6 -80.0 -45.9 -0.763   0.5   73.4
##  7       1       7 -80.0 -42.0 -0.763  -0.5  -98.4
##  8       1       8 -80.0 -87.6 -0.763   0.5 -189. 
##  9       1       9 -80.0 -97.4 -0.763  -0.5 -410. 
## 10       1      10 -80.0 -85.2 -0.763   0.5  102. 
## # ℹ 4,990 more rows</code></pre>
<div class="webex-solution">
<button>
提示
</button>
<p><code>inner_join()</code></p>
</div>
<div class="webex-solution">
<button>
答案
</button>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb232-1"><a href="交叉随机因子线性混合效应模型.html#cb232-1" tabindex="-1"></a>dat_sim <span class="ot">&lt;-</span> subjects <span class="sc">%&gt;%</span></span>
<span id="cb232-2"><a href="交叉随机因子线性混合效应模型.html#cb232-2" tabindex="-1"></a>  <span class="fu">inner_join</span>(trials, <span class="st">&quot;subj_id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-3"><a href="交叉随机因子线性混合效应模型.html#cb232-3" tabindex="-1"></a>  <span class="fu">inner_join</span>(items, <span class="st">&quot;item_id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb232-4"><a href="交叉随机因子线性混合效应模型.html#cb232-4" tabindex="-1"></a>  <span class="fu">arrange</span>(subj_id, item_id) <span class="sc">%&gt;%</span></span>
<span id="cb232-5"><a href="交叉随机因子线性混合效应模型.html#cb232-5" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, item_id, S_0s, I_0i, S_1s, cond, err)</span></code></pre></div>
</div>
</div>
<div id="创建响应变量" class="section level3 hasAnchor" number="7.4.6">
<h3><span class="header-section-number">7.4.6</span> 创建响应变量<a href="交叉随机因子线性混合效应模型.html#创建响应变量" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>根据下面的公式模型将响应变量<code>Y</code>添加到数据中：</p>
<p><span class="math display">\[Y_{si} = \beta_0 + S_{0s} + I_{0i} + (\beta_1 + S_{1s})X_{i} + e_{si}\]</span></p>
<p>那么，最终的表(<code>dat_sim2</code>)看起来是这样的：</p>
<pre><code>## # A tibble: 5,000 × 8
##    subj_id item_id     Y  S_0s  I_0i   S_1s  cond    err
##      &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1       1       1 1078. -80.0  14.9 -0.763  -0.5  382. 
##  2       1       2  957. -80.0 -86.3 -0.763   0.5  283. 
##  3       1       3  698. -80.0 -12.8 -0.763  -0.5   30.4
##  4       1       4  464. -80.0 -13.9 -0.763   0.5 -282. 
##  5       1       5  497. -80.0  55.6 -0.763  -0.5 -239. 
##  6       1       6  787. -80.0 -45.9 -0.763   0.5   73.4
##  7       1       7  540. -80.0 -42.0 -0.763  -0.5  -98.4
##  8       1       8  483. -80.0 -87.6 -0.763   0.5 -189. 
##  9       1       9  173. -80.0 -97.4 -0.763  -0.5 -410. 
## 10       1      10  776. -80.0 -85.2 -0.763   0.5  102. 
## # ℹ 4,990 more rows</code></pre>
<p>注意：这是该模型完整的<strong>分解表</strong></p>
<div class="webex-solution">
<button>
提示
</button>
<pre><code>... %&gt;% 
  mutate(Y = ...) %&gt;%
  select(...)</code></pre>
</div>
<div class="webex-solution">
<button>
答案
</button>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="交叉随机因子线性混合效应模型.html#cb235-1" tabindex="-1"></a>dat_sim2 <span class="ot">&lt;-</span> dat_sim <span class="sc">%&gt;%</span></span>
<span id="cb235-2"><a href="交叉随机因子线性混合效应模型.html#cb235-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> b0 <span class="sc">+</span> S_0s <span class="sc">+</span> I_0i <span class="sc">+</span> (S_1s <span class="sc">+</span> b1) <span class="sc">*</span> cond <span class="sc">+</span> err) <span class="sc">%&gt;%</span></span>
<span id="cb235-3"><a href="交叉随机因子线性混合效应模型.html#cb235-3" tabindex="-1"></a>  <span class="fu">select</span>(subj_id, item_id, Y, <span class="fu">everything</span>())</span></code></pre></div>
</div>
</div>
<div id="拟合模型" class="section level3 hasAnchor" number="7.4.7">
<h3><span class="header-section-number">7.4.7</span> 拟合模型<a href="交叉随机因子线性混合效应模型.html#拟合模型" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>现在你创建完了模拟数据，使用<code>lme4::lmer()</code>拟合模型，并运行<code>summary()</code>吧。</p>
<div class="webex-solution">
<button>
答案
</button>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="交叉随机因子线性混合效应模型.html#cb236-1" tabindex="-1"></a>mod_sim <span class="ot">&lt;-</span> <span class="fu">lmer</span>(Y <span class="sc">~</span> cond <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> cond <span class="sc">|</span> subj_id) <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> item_id),</span>
<span id="cb236-2"><a href="交叉随机因子线性混合效应模型.html#cb236-2" tabindex="-1"></a>                dat_sim2, <span class="at">REML =</span> <span class="cn">FALSE</span>)</span>
<span id="cb236-3"><a href="交叉随机因子线性混合效应模型.html#cb236-3" tabindex="-1"></a></span>
<span id="cb236-4"><a href="交叉随机因子线性混合效应模型.html#cb236-4" tabindex="-1"></a><span class="fu">summary</span>(mod_sim, <span class="at">corr =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## Linear mixed model fit by maximum likelihood  [&#39;lmerMod&#39;]
## Formula: Y ~ cond + (1 + cond | subj_id) + (1 | item_id)
##    Data: dat_sim2
## 
##      AIC      BIC   logLik deviance df.resid 
##  67639.4  67685.0 -33812.7  67625.4     4993 
## 
## Scaled residuals: 
##     Min      1Q  Median      3Q     Max 
## -3.6357 -0.6599 -0.0251  0.6767  3.7685 
## 
## Random effects:
##  Groups   Name        Variance Std.Dev. Corr
##  subj_id  (Intercept)  9464.8   97.29       
##           cond          597.7   24.45   0.68
##  item_id  (Intercept)  8087.0   89.93       
##  Residual             40305.0  200.76       
## Number of obs: 5000, groups:  subj_id, 100; item_id, 50
## 
## Fixed effects:
##             Estimate Std. Error t value
## (Intercept)   793.29      16.26  48.782
## cond           77.65      26.18   2.967</code></pre>
</div>
<p>现在看看你能否在<code>summary()</code>的输出结果中识别出数据生成参数。</p>
<p>首先，尝试找到<span class="math inline">\(\beta_0\)</span>和<span class="math inline">\(\beta_1\)</span>。</p>
<div class="webex-solution">
<button>
答案：固定效应
</button>
<table>
<thead>
<tr class="header">
<th align="left">parameter</th>
<th align="left">variable</th>
<th align="right">input</th>
<th align="right">estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(\hat{\beta}_0\)</span></td>
<td align="left"><code>b0</code></td>
<td align="right">800</td>
<td align="right">793.293</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\hat{\beta}_1\)</span></td>
<td align="left"><code>b1</code></td>
<td align="right">80</td>
<td align="right">77.652</td>
</tr>
</tbody>
</table>
</div>
<p>尝试找到随机效应的估计参数<span class="math inline">\(\tau_{00}\)</span>，<span class="math inline">\(\tau_{11}\)</span>，<span class="math inline">\(\rho\)</span>，<span class="math inline">\(\omega_{00}\)</span>和<span class="math inline">\(\sigma\)</span>。</p>
<div class="webex-solution">
<button>
答案：随机效应参数
</button>
<table>
<thead>
<tr class="header">
<th align="left">parameter</th>
<th align="left">variable</th>
<th align="right">input</th>
<th align="right">estimate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><span class="math inline">\(\hat{\tau}_{00}\)</span></td>
<td align="left"><code>tau_00</code></td>
<td align="right">100.0</td>
<td align="right">97.287</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\hat{\tau}_{11}\)</span></td>
<td align="left"><code>tau_11</code></td>
<td align="right">40.0</td>
<td align="right">24.448</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\hat{\rho}\)</span></td>
<td align="left"><code>rho</code></td>
<td align="right">0.2</td>
<td align="right">0.675</td>
</tr>
<tr class="even">
<td align="left"><span class="math inline">\(\hat{\omega}_{00}\)</span></td>
<td align="left"><code>omega_00</code></td>
<td align="right">80.0</td>
<td align="right">89.928</td>
</tr>
<tr class="odd">
<td align="left"><span class="math inline">\(\hat{\sigma}\)</span></td>
<td align="left"><code>sig</code></td>
<td align="right">200.0</td>
<td align="right">200.761</td>
</tr>
</tbody>
</table>
</div>
<p>注：推荐阅读 <span class="citation">Brown (<a href="#ref-Brown_2021">2021</a>)</span></p>

</div>
</div>
</div>
<h3>参考文献<a href="参考文献.html#参考文献" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Baayen_Davidson_Bates_2008" class="csl-entry">
Baayen, R. H., Davidson, D. J., &amp; Bates, D. M. (2008). Mixed-effects modeling with crossed random effects for subjects and items. <em>Journal of Memory and Language</em>, <em>59</em>(4), 390–412. <a href="https://doi.org/10.1016/j.jml.2007.12.005">https://doi.org/10.1016/j.jml.2007.12.005</a>
</div>
<div id="ref-Barr_2013" class="csl-entry">
Barr, D. J. (2013). Random effects structure for testing interactions in linear mixed-effects models. <em>Frontiers in Psychology</em>, <em>4</em>, 328. <a href="https://doi.org/10.3389/fpsyg.2013.00328">https://doi.org/10.3389/fpsyg.2013.00328</a>
</div>
<div id="ref-Barr_2017" class="csl-entry">
Barr, D. J. (2017). <span class="nocase">Generalizing over encounters: Statistical and theoretical considerations</span>. In <em>Oxford handbook of psycholinguistics</em>. Oxford University Press. <a href="https://doi.org/10.1093/oxfordhb/9780198786825.013.39">https://doi.org/10.1093/oxfordhb/9780198786825.013.39</a>
</div>
<div id="ref-Barr_et_al_2013" class="csl-entry">
Barr, D. J., Levy, R., Scheepers, C., &amp; Tily, H. J. (2013). Random effects structure for confirmatory hypothesis testing: Keep it maximal. <em>Journal of Memory and Language</em>, <em>68</em>(3), 255–278. <a href="https://doi.org/10.1016/j.jml.2012.11.001">https://doi.org/10.1016/j.jml.2012.11.001</a>
</div>
<div id="ref-Brown_2021" class="csl-entry">
Brown, V. A. (2021). An introduction to linear mixed-effects modeling in r. <em>Advances in Methods and Practices in Psychological Science</em>, <em>4</em>(1). <a href="https://doi.org/10.1177/2515245920960351">https://doi.org/10.1177/2515245920960351</a>
</div>
<div id="ref-Clark_1973" class="csl-entry">
Clark, H. H. (1973). The language-as-fixed-effect fallacy: A critique of language statistics in psychological research. <em>Journal of Verbal Learning and Verbal Behavior</em>, <em>12</em>(4), 335–359. <a href="https://doi.org/10.1016/S0022-5371(73)80014-3">https://doi.org/10.1016/S0022-5371(73)80014-3</a>
</div>
<div id="ref-Coleman_1964" class="csl-entry">
Coleman, E. B. (1964). Generalizing to a language population. <em>Psychological Reports</em>, <em>14</em>(1), 219–226. <a href="https://doi.org/10.2466/pr0.1964.14.1.219">https://doi.org/10.2466/pr0.1964.14.1.219</a>
</div>
<div id="ref-Debruine_Barr_2020" class="csl-entry">
DeBruine, L., &amp; Barr, D. J. (2021). Understanding mixed effects models through data simulation. <em>Advances in Methods and Practice in Psychological Science</em>, <em>4</em>(1). <a href="https://doi.org/10.1177/2515245920965119">https://doi.org/10.1177/2515245920965119</a>
</div>
<div id="ref-Judd_Westfall_Kenny_2012" class="csl-entry">
Judd, C. M., Westfall, J., &amp; Kenny, D. A. (2012). Treating stimuli as a random factor in social psychology: A new and comprehensive solution to a pervasive but largely ignored problem. <em>Journal of Personality and Social Psychology</em>, <em>103</em>(1), 54–69. <a href="https://doi.org/10.1037/a0028347">https://doi.org/10.1037/a0028347</a>
</div>
<div id="ref-Matuschek_et_al_2017" class="csl-entry">
Matuschek, H., Kliegl, R., Vasishth, S., Baayen, H., &amp; Bates, D. (2017). <span class="nocase">Balancing Type I error and power in linear mixed models</span>. <em><span>Journal of Memory and Language</span></em>, <em>94</em>, 305–315. <a href="https://doi.org/10.1016/j.jml.2017.01.001">https://doi.org/10.1016/j.jml.2017.01.001</a>
</div>
<div id="ref-yarkoni_2019" class="csl-entry">
Yarkoni, T. (2019). <em>The generalizability crisis</em>. <a href="https://doi.org/10.31234/osf.io/jqw35">https://doi.org/10.31234/osf.io/jqw35</a>
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("webex-total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("webex-correct").length + " of " +
      document.getElementsByClassName("webex-solveme").length + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }

  update_total_correct();
}

</script>
<script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );
});
</script>

            </section>

          </div>
        </div>
      </div>
<a href="单随机因子线性混合效应模型.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="广义线性混合效应模型.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CBook.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
