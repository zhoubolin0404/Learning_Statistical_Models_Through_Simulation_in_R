<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 介绍线性混合模型 | 学习统计模型——通过R模拟(施工中)</title>
  <meta name="description" content="5 介绍线性混合模型 | 学习统计模型——通过R模拟(施工中)" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="5 介绍线性混合模型 | 学习统计模型——通过R模拟(施工中)" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 介绍线性混合模型 | 学习统计模型——通过R模拟(施工中)" />
  
  
  

<meta name="author" content="周博霖" />


<meta name="date" content="2024-06-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="交互效应.html"/>
<link rel="next" href="参考文献.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX","output/SVG"],
  extensions: ["tex2jax.js","MathMenu.js","MathZoom.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
  }
});
</script>
<script type="text/javascript"
   src="../../../MathJax/MathJax.js">
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>概述</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#译者按"><i class="fa fa-check"></i>译者按</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#如何引用本书"><i class="fa fa-check"></i>如何引用本书</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#发现问题"><i class="fa fa-check"></i>发现问题？</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#教育者需知"><i class="fa fa-check"></i>教育者需知</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="前言.html"><a href="前言.html"><i class="fa fa-check"></i><b>1</b> 前言</a>
<ul>
<li class="chapter" data-level="1.1" data-path="前言.html"><a href="前言.html#课程目的"><i class="fa fa-check"></i><b>1.1</b> 课程目的</a></li>
<li class="chapter" data-level="1.2" data-path="前言.html"><a href="前言.html#广义线性混合模型generalized-linear-mixed-effects-models-glmms"><i class="fa fa-check"></i><b>1.2</b> 广义线性混合模型(Generalized Linear Mixed-Effects Models, GLMMs)</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="前言.html"><a href="前言.html#线性模型"><i class="fa fa-check"></i><b>1.2.1</b> 线性模型</a></li>
<li class="chapter" data-level="1.2.2" data-path="前言.html"><a href="前言.html#混合模型"><i class="fa fa-check"></i><b>1.2.2</b> 混合模型</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="前言.html"><a href="前言.html#关于可重复性的说明"><i class="fa fa-check"></i><b>1.3</b> 关于可重复性的说明</a></li>
<li class="chapter" data-level="1.4" data-path="前言.html"><a href="前言.html#基于模拟的方法"><i class="fa fa-check"></i><b>1.4</b> 基于模拟的方法</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="相关和回归.html"><a href="相关和回归.html"><i class="fa fa-check"></i><b>2</b> 相关和回归</a>
<ul>
<li class="chapter" data-level="2.1" data-path="相关和回归.html"><a href="相关和回归.html#相关矩阵correlation-matrices"><i class="fa fa-check"></i><b>2.1</b> 相关矩阵(Correlation matrices)</a></li>
<li class="chapter" data-level="2.2" data-path="相关和回归.html"><a href="相关和回归.html#模拟二元数据"><i class="fa fa-check"></i><b>2.2</b> 模拟二元数据</a></li>
<li class="chapter" data-level="2.3" data-path="相关和回归.html"><a href="相关和回归.html#相关和回归的关系"><i class="fa fa-check"></i><b>2.3</b> 相关和回归的关系</a></li>
<li class="chapter" data-level="2.4" data-path="相关和回归.html"><a href="相关和回归.html#练习"><i class="fa fa-check"></i><b>2.4</b> 练习</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="多元回归.html"><a href="多元回归.html"><i class="fa fa-check"></i><b>3</b> 多元回归</a>
<ul>
<li class="chapter" data-level="3.1" data-path="多元回归.html"><a href="多元回归.html#一个例子如何在统计学上取得好成绩"><i class="fa fa-check"></i><b>3.1</b> 一个例子：如何在统计学上取得好成绩</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="多元回归.html"><a href="多元回归.html#数据导入和可视化"><i class="fa fa-check"></i><b>3.1.1</b> 数据导入和可视化</a></li>
<li class="chapter" data-level="3.1.2" data-path="多元回归.html"><a href="多元回归.html#估计和解释"><i class="fa fa-check"></i><b>3.1.2</b> 估计和解释</a></li>
<li class="chapter" data-level="3.1.3" data-path="多元回归.html"><a href="多元回归.html#使用predict通过线性模型进行预测"><i class="fa fa-check"></i><b>3.1.3</b> 使用<code>predict()</code>通过线性模型进行预测</a></li>
<li class="chapter" data-level="3.1.4" data-path="多元回归.html"><a href="多元回归.html#偏效应可视化"><i class="fa fa-check"></i><b>3.1.4</b> 偏效应可视化</a></li>
<li class="chapter" data-level="3.1.5" data-path="多元回归.html"><a href="多元回归.html#标准化系数"><i class="fa fa-check"></i><b>3.1.5</b> 标准化系数</a></li>
<li class="chapter" data-level="3.1.6" data-path="多元回归.html"><a href="多元回归.html#模型比较"><i class="fa fa-check"></i><b>3.1.6</b> 模型比较</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="多元回归.html"><a href="多元回归.html#处理分类预测变量"><i class="fa fa-check"></i><b>3.2</b> 处理分类预测变量</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="多元回归.html"><a href="多元回归.html#虚拟编码又称处理编码"><i class="fa fa-check"></i><b>3.2.1</b> 虚拟编码(又称“处理”编码)</a></li>
<li class="chapter" data-level="3.2.2" data-path="多元回归.html"><a href="多元回归.html#当k-2时的虚拟编码"><i class="fa fa-check"></i><b>3.2.2</b> 当<span class="math inline">\(k &gt; 2\)</span>时的虚拟编码</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="多元回归.html"><a href="多元回归.html#多元回归和单因素方差分析one-way-anova的等价性"><i class="fa fa-check"></i><b>3.3</b> 多元回归和单因素方差分析(one-way ANOVA)的等价性</a></li>
<li class="chapter" data-level="3.4" data-path="多元回归.html"><a href="多元回归.html#练习答案"><i class="fa fa-check"></i><b>3.4</b> 练习答案</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="交互效应.html"><a href="交互效应.html"><i class="fa fa-check"></i><b>4</b> 交互效应</a>
<ul>
<li class="chapter" data-level="4.1" data-path="交互效应.html"><a href="交互效应.html#cont-by-cat"><i class="fa fa-check"></i><b>4.1</b> 连续变量-分类变量交互效应</a></li>
<li class="chapter" data-level="4.2" data-path="交互效应.html"><a href="交互效应.html#分类变量-分类变量交互效应"><i class="fa fa-check"></i><b>4.2</b> 分类变量-分类变量交互效应</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="交互效应.html"><a href="交互效应.html#认知治疗与药物治疗对情绪的影响"><i class="fa fa-check"></i><b>4.2.1</b> 认知治疗与药物治疗对情绪的影响</a></li>
<li class="chapter" data-level="4.2.2" data-path="交互效应.html"><a href="交互效应.html#因子设计中的效应"><i class="fa fa-check"></i><b>4.2.2</b> 因子设计中的效应</a></li>
<li class="chapter" data-level="4.2.3" data-path="交互效应.html"><a href="交互效应.html#高阶设计higher-order-designs"><i class="fa fa-check"></i><b>4.2.3</b> 高阶设计(Higher-order designs)</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="交互效应.html"><a href="交互效应.html#用于因子设计的glm"><i class="fa fa-check"></i><b>4.3</b> 用于因子设计的GLM</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="交互效应.html"><a href="交互效应.html#估计方程estimation-equations"><i class="fa fa-check"></i><b>4.3.1</b> 估计方程(estimation equations)</a></li>
<li class="chapter" data-level="4.3.2" data-path="交互效应.html"><a href="交互效应.html#因子设计app"><i class="fa fa-check"></i><b>4.3.2</b> 因子设计App</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="交互效应.html"><a href="交互效应.html#在因子设计中对分类预测因子进行编码"><i class="fa fa-check"></i><b>4.4</b> 在因子设计中对分类预测因子进行编码</a></li>
<li class="chapter" data-level="4.5" data-path="交互效应.html"><a href="交互效应.html#分类变量的编码方案"><i class="fa fa-check"></i><b>4.5</b> 分类变量的编码方案</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="交互效应.html"><a href="交互效应.html#简单效应-vs.-主效应"><i class="fa fa-check"></i><b>4.5.1</b> 简单效应 vs. 主效应</a></li>
<li class="chapter" data-level="4.5.2" data-path="交互效应.html"><a href="交互效应.html#主要编码方案"><i class="fa fa-check"></i><b>4.5.2</b> 主要编码方案</a></li>
<li class="chapter" data-level="4.5.3" data-path="交互效应.html"><a href="交互效应.html#超过2水平的因子呢"><i class="fa fa-check"></i><b>4.5.3</b> 超过2水平的因子呢？</a></li>
<li class="chapter" data-level="4.5.4" data-path="交互效应.html"><a href="交互效应.html#举例3水平因子"><i class="fa fa-check"></i><b>4.5.4</b> 举例：3水平因子</a></li>
<li class="chapter" data-level="4.5.5" data-path="交互效应.html"><a href="交互效应.html#如何创建你自己的数值型预测变量"><i class="fa fa-check"></i><b>4.5.5</b> 如何创建你自己的数值型预测变量</a></li>
<li class="chapter" data-level="4.5.6" data-path="交互效应.html"><a href="交互效应.html#小结"><i class="fa fa-check"></i><b>4.5.6</b> 小结</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="介绍线性混合模型.html"><a href="介绍线性混合模型.html"><i class="fa fa-check"></i><b>5</b> 介绍线性混合模型</a>
<ul>
<li class="chapter" data-level="5.1" data-path="介绍线性混合模型.html"><a href="介绍线性混合模型.html#多层数据建模"><i class="fa fa-check"></i><b>5.1</b> 多层数据建模</a></li>
<li class="chapter" data-level="5.2" data-path="介绍线性混合模型.html"><a href="介绍线性混合模型.html#如何对这些数据进行建模"><i class="fa fa-check"></i><b>5.2</b> 如何对这些数据进行建模</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="参考文献.html"><a href="参考文献.html"><i class="fa fa-check"></i>参考文献</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">学习统计模型——通过R模拟(施工中)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="介绍线性混合模型" class="section level1 hasAnchor" number="5">
<h1><span class="header-section-number">5</span> 介绍线性混合模型<a href="介绍线性混合模型.html#介绍线性混合模型" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="多层数据建模" class="section level2 hasAnchor" number="5.1">
<h2><span class="header-section-number">5.1</span> 多层数据建模<a href="介绍线性混合模型.html#多层数据建模" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="bluebox">
<p>本章中的一些观点来自 <span class="citation">McElreath (<a href="#ref-McElreath_2020">2020</a>)</span> 的<a href="https://xcelab.net/rm/statistical-rethinking/">《Statistical Rethinking》</a>，还广泛借鉴了Tristan Mahr关于部分混合(partial pooling)的出色<a href="https://www.tjmahr.com/plotting-partial-pooling-in-mixed-effects-models/">博客</a>。</p>
</div>
<p>在本章中，我们将使用一些来自研究睡眠剥夺对心理运动能力(psychomotor performance)影响的真实数据<span class="citation">(<a href="#ref-Belenky_et_al_2003">Belenky et al., 2003</a>)</span>。该研究的数据包含在R的<code>lme4</code>包中的内置数据集<code>sleepstudy</code>中<span class="citation">(<a href="#ref-Bates_et_al_2015">Bates et al., 2015</a>)</span>。</p>
<p>让我们从查看<code>sleepstudy</code>数据集的文档开始。加载<strong><code>lme4</code></strong>包后，你可以在控制台中输入<code>?sleepstudy</code>来访问文档。</p>
<pre><code>注：这是对数据集文档的中文翻译
sleepstudy                package:lme4                 R Documentation

睡眠剥夺研究中的反应时

描述：

     一项睡眠剥夺研究中，被试每天的平均反应时(以毫秒为单位)。
    
     第0-1天为适应和训练阶段(T1/T2)，第2天为基线(B)；睡眠剥夺从第2天开始。
    
格式：

     一个包含180个观测结果的数据框，其中包含以下3个变量：
    
     Reaction：平均反应时(毫秒)
    
     Days：睡眠剥夺的天数
    
     Subject：进行观测的被试编号

详细信息：

     这些数据来自Belenky et al.(2003)描述的研究，针对的是最严重的睡
     眠剥夺组(每天仅睡3小时)和研究的前10天，直到恢复期。原始研究分析
     了速度(1/反应时)，并将天数作为分类而非连续预测变量进行处理。

参考文献：

     Gregory Belenky, Nancy J. Wesensten, David R. Thorne, Maria L.
     Thomas, Helen C. Sing, Daniel P. Redmond, Michael B. Russo and
     Thomas J. Balkin (2003) Patterns of performance degradation and
     restoration during sleep restriction and subsequent recovery: a
     sleep dose-response study. _Journal of Sleep Research_ *12*, 1-12.</code></pre>
<p>这些数据符合我们对多层数据的定义，因为在十天内对同一被试的同一因变量(平均反应时)进行了重复测量。这种类型的多层数据在心理学中非常常见。不幸的是，大多数心理学课程常用的统计教材对多层数据的讨论是不充分的，通常只涉及配对样本t检验和重复测量ANOVA。<code>sleepstudy</code>数据集很有趣，因为它是多层的，但有一个连续的预测变量，因此不适合t检验或ANOVA，因为这两种方法都是针对分类预测变量的。有方法可以让数据适应其中一个框架，但会丢失信息或可能违反假设。</p>
<p>遗憾的是，心理学专业的学生并没有真正学会如何分析多层数据。想想你最近读过的心理学或神经科学的研究。有多少研究是对每个被试只测量一次因变量？很少，如果有的话。几乎所有研究都进行了多次测量，因为以下一种或多种原因：(1)研究者在被试内设计中跨因子多水平测量同一被试；(2)他们有兴趣评估随时间的变化；或(3)他们在测量对多种刺激的反应。多层数据如此常见，以至于多层分析应该作为心理学中的<strong>默认</strong>方法来教授。学习多层分析可能具有挑战性，但你已经通过学习相关和回归掌握了大部分所需的知识。你会发现它只是简单回归的扩展。</p>
<p>让我们更详细地看看<code>sleepstudy</code>数据。该数据集包含来自三小时睡眠情况下的十八位被试。在为期十天的时间里，被试每天进行十分钟的“心理运动警觉性测试(psychomotor vigilance test)”，在每次出现刺激时尽快按下按钮。数据集中的因变量是被试在当天任务中的平均反应时(RT)。</p>
<p>开始分析的一个好方法是绘制数据图。下面是一个被试的数据。</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="介绍线性混合模型.html#cb116-1" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb116-2"><a href="介绍线性混合模型.html#cb116-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb116-3"><a href="介绍线性混合模型.html#cb116-3" tabindex="-1"></a></span>
<span id="cb116-4"><a href="介绍线性混合模型.html#cb116-4" tabindex="-1"></a>just_308 <span class="ot">&lt;-</span> sleepstudy <span class="sc">%&gt;%</span></span>
<span id="cb116-5"><a href="介绍线性混合模型.html#cb116-5" tabindex="-1"></a>  <span class="fu">filter</span>(Subject <span class="sc">==</span> <span class="st">&quot;308&quot;</span>)</span>
<span id="cb116-6"><a href="介绍线性混合模型.html#cb116-6" tabindex="-1"></a></span>
<span id="cb116-7"><a href="介绍线性混合模型.html#cb116-7" tabindex="-1"></a><span class="fu">ggplot</span>(just_308, <span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb116-8"><a href="介绍线性混合模型.html#cb116-8" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb116-9"><a href="介绍线性混合模型.html#cb116-9" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:one-subject"></span>
<img src="05-%E4%BB%8B%E7%BB%8D%E7%BA%BF%E6%80%A7%E6%B7%B7%E5%90%88%E6%A8%A1%E5%9E%8B_files/figure-html/one-subject-1.png" alt="*Belenky et al.(2003)中单个被试的数据*" width="50%" />
<p class="caption">
图5.1: <em>Belenky et al.(2003)中单个被试的数据</em>
</p>
</div>
<div class="purplebox">
<p><strong>练习</strong></p>
<p>使用<code>ggplot</code>重现下面的图，这包含了所有18个被试。</p>
<div class="figure"><span style="display:block;" id="fig:plot-solution0"></span>
<img src="05-%E4%BB%8B%E7%BB%8D%E7%BA%BF%E6%80%A7%E6%B7%B7%E5%90%88%E6%A8%A1%E5%9E%8B_files/figure-html/plot-solution0-1.png" alt="*Belenky et al.(2003)中的数据*" width="672" />
<p class="caption">
图5.2: <em>Belenky et al.(2003)中的数据</em>
</p>
</div>
<p>从第2天开始到第10天，RT似乎随着睡眠剥夺天数的增加而增加。</p>
<div class="webex-solution">
<button>
请提示
</button>
<p>上面给出了绘制单个被试数据的代码。通过去掉<code>filter()</code>语句并添加以<code>facet_</code>开头的<em><code>ggplot2</code></em>函数，将此代码改为显示所有被试的数据。</p>
</div>
<div class="webex-solution">
<button>
展示答案
</button>
<p>和上面一样，只是你要增加一行：<code>facet_wrap(~Subject)</code></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="介绍线性混合模型.html#cb117-1" tabindex="-1"></a><span class="fu">ggplot</span>(sleepstudy, <span class="fu">aes</span>(<span class="at">x =</span> Days, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb117-2"><a href="介绍线性混合模型.html#cb117-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb117-3"><a href="介绍线性混合模型.html#cb117-3" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">9</span>) <span class="sc">+</span></span>
<span id="cb117-4"><a href="介绍线性混合模型.html#cb117-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Subject)</span></code></pre></div>
</div>
</div>
</div>
<div id="如何对这些数据进行建模" class="section level2 hasAnchor" number="5.2">
<h2><span class="header-section-number">5.2</span> 如何对这些数据进行建模<a href="介绍线性混合模型.html#如何对这些数据进行建模" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>要合理地对数据进行建模，我们首先需要了解更多关于设计的信息 <span class="citation">Belenky et al. (<a href="#ref-Belenky_et_al_2003">2003</a>)</span> 在他们的研究中是这样描述的(p. 2)：</p>
<blockquote>
<p>前3天(T1、T2和B)是适应和训练(T1和T2)以及基线(B)，被试要求从23:00到07:00上床睡觉[在床时间(time in bed，TIB)为8小时]。在第3天(B)，进行了基线测量。从第4天开始，连续7天(E1-E7)，被试处于4种睡眠条件之一[TIB为9小时(22:00–07:00)，TIB为7小时(24:00–07:00)，TIB为5小时(02:00–07:00)或TIB为3小时(04:00–07:00)]，实际上是一种睡眠延长条件和三种睡眠限制条件。</p>
</blockquote>
<p>从第3天之后的第1晚开始，有7晚的睡眠限制。前2天，编码为<code>0</code>、<code>1</code>，是适应(adaptation)和训练(training)。编码为<code>2</code>的那天是进行基线测量的时间，应该是我们分析开始的地方。如果我们将<code>0</code>和<code>1</code>两天包含在我们的分析中，可能会偏倚(bias)我们的结果，因为前两天的任何表现变化都与训练有关，而不是与睡眠限制有关。</p>
<div class="purplebox">
<p><strong><em>练习</em></strong></p>
<p>从数据集中删除<code>Days</code>编码为<code>0</code>或<code>1</code>的观察值，然后根据<code>Days</code>变量创建一个新的变量<code>days_deprived</code>，使序列从第2天开始，第2天重新编码为第0天，第3天为第1天，第4天为第2天，依此类推。这个新变量现在追踪睡眠剥夺的天数。将新表存储为<code>sleep2</code>。</p>
<div class="webex-solution">
<button>
展开答案
</button>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="介绍线性混合模型.html#cb118-1" tabindex="-1"></a>sleep2 <span class="ot">&lt;-</span> sleepstudy <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="介绍线性混合模型.html#cb118-2" tabindex="-1"></a>  <span class="fu">filter</span>(Days <span class="sc">&gt;=</span> 2L) <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="介绍线性混合模型.html#cb118-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">days_deprived =</span> Days <span class="sc">-</span> 2L)</span></code></pre></div>
<p>仔细检查代码是否按预期工作总是一个好主意。首先，看看它：</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="介绍线性混合模型.html#cb119-1" tabindex="-1"></a><span class="fu">head</span>(sleep2)</span></code></pre></div>
<pre><code>##   Reaction Days Subject days_deprived
## 1 250.8006    2     308             0
## 2 321.4398    3     308             1
## 3 356.8519    4     308             2
## 4 414.6901    5     308             3
## 5 382.2038    6     308             4
## 6 290.1486    7     308             5</code></pre>
<p>检查<code>Days</code>和<code>days_deprivation</code>是否匹配。</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="介绍线性混合模型.html#cb121-1" tabindex="-1"></a>sleep2 <span class="sc">%&gt;%</span></span>
<span id="cb121-2"><a href="介绍线性混合模型.html#cb121-2" tabindex="-1"></a>  <span class="fu">count</span>(days_deprived, Days)</span></code></pre></div>
<pre><code>##   days_deprived Days  n
## 1             0    2 18
## 2             1    3 18
## 3             2    4 18
## 4             3    5 18
## 5             4    6 18
## 6             5    7 18
## 7             6    8 18
## 8             7    9 18</code></pre>
<p>看起来很好. 请注意，由<code>count()</code>生成的变量<code>n</code>会告诉你<code>Days</code>和<code>days_deprivation</code>的每个唯一组合有多少行。在这种情况下有18行，每个被试1行。</p>
</div>
</div>
<p>现在让我们重新绘制数据，只查看从第0天到第7天的这8个数据点。我们已经从上面的代码中复制了代码，将<code>sleepstudy</code>替换为<code>sleep2</code>，并使用<code>days_deprived</code>作为我们的<code>x</code>变量。</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="介绍线性混合模型.html#cb123-1" tabindex="-1"></a><span class="fu">ggplot</span>(sleep2, <span class="fu">aes</span>(<span class="at">x =</span> days_deprived, <span class="at">y =</span> Reaction)) <span class="sc">+</span></span>
<span id="cb123-2"><a href="介绍线性混合模型.html#cb123-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb123-3"><a href="介绍线性混合模型.html#cb123-3" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb123-4"><a href="介绍线性混合模型.html#cb123-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Subject) <span class="sc">+</span></span>
<span id="cb123-5"><a href="介绍线性混合模型.html#cb123-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;反应时&quot;</span>, <span class="at">x =</span> <span class="st">&quot;被剥夺睡眠的天数(0 = 基线)&quot;</span>)</span></code></pre></div>
<div class="figure"><span style="display:block;" id="fig:plot-solution2"></span>
<img src="05-%E4%BB%8B%E7%BB%8D%E7%BA%BF%E6%80%A7%E6%B7%B7%E5%90%88%E6%A8%A1%E5%9E%8B_files/figure-html/plot-solution2-1.png" alt="*数据来自Belenky et al.(2003)，显示了基线(0天)和每天睡眠剥夺后的反应时*" width="672" />
<p class="caption">
图5.3: <em>数据来自Belenky et al.(2003)，显示了基线(0天)和每天睡眠剥夺后的反应时</em>
</p>
</div>
<p>请稍作思考，我们如何对<code>days_deprived</code>和<code>Reaction</code>之间的关系建模。随着睡眠剥夺的增加，反应时间是增加还是减少？这种关系大致稳定还是随时间变化？</p>
<p>除了一个例外(335号被试)，看起来反应时随着睡眠剥夺的增加而增加。看起来我们可以对每位被试的数据拟合一条直线。回想一下，一条直线的一般方程形式为<strong>y = y轴截距 + 斜率 <span class="math inline">\(\times\)</span> x</strong>。在回归分析中，我们通常用以下公式表示线性关系：</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1 X\]</span></p>
<p>其中<span class="math inline">\(\beta_0\)</span>是y轴截距，<span class="math inline">\(\beta_1\)</span>是斜率，这些参数都是我们从数据中估计而来的。</p>
<p>这些线的截距(剥夺睡眠开始前第0天的平均RT)和斜率(每增加一天的睡眠剥夺后RT的变化)都不同。但我们应该为每个被试拟合同一条线吗？还是每个被试拟合完全不同的线？或者介于两者之间的某种情况？</p>
<p>让我们首先考虑可能用到的三种不同方法。根据McElreath的说法，我们将这些方法称为<strong>完全混合(complete pooling)</strong>、<strong>无混合(no pooling)</strong>和<strong>部分混合(partial pooling)</strong>。</p>

</div>
</div>
<h3>参考文献<a href="参考文献.html#参考文献" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-Bates_et_al_2015" class="csl-entry">
Bates, D., Maechler, M., Bolker, B., &amp; Walker, S. (2015). Fitting linear mixed-effects models using lme4. <em><span>Journal of Statistical Software</span></em>, <em>67</em>, 1–48.
</div>
<div id="ref-Belenky_et_al_2003" class="csl-entry">
Belenky, G., Wesensten, N. J., Thorne, D. R., Thomas, M. L., Sing, H. C., Redmond, D. P., Russo, M. B., &amp; Balkin, T. J. (2003). Patterns of performance degradation and restoration during sleep restriction and subsequent recovery: A sleep dose-response study. <em><span>Journal of Sleep Research</span></em>, <em>12</em>(1), 1–12.
</div>
<div id="ref-McElreath_2020" class="csl-entry">
McElreath, R. (2020). <em><span class="nocase">Statistical Rethinking: A Bayesian course with examples in R and STAN</span></em>. CRC Press.
</div>
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("webex-total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("webex-correct").length + " of " +
      document.getElementsByClassName("webex-solveme").length + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }

  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }
  }

  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }

  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off");
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";

    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;

    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }

  update_total_correct();
}

</script>
<script>
$( document ).ready(function() {
  var cite = ' ';
  var psyteachr = ' <a href="https://psyteachr.github.io/"><img src="images/logos/psyteachr_logo.png" style="height: 31px; color: white;" alt="psyTeachR: Reproducible Research" /></a>';
  var license = ' <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/" target="blank"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/88x31.png"></a>';

  $("footer div.row div:eq(1) p").html(
    psyteachr + license + cite
  );
});
</script>

            </section>

          </div>
        </div>
      </div>
<a href="交互效应.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="参考文献.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CBook.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
